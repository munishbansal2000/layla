(function(se,z){typeof exports=="object"&&typeof module!="undefined"?z(require("vue")):typeof define=="function"&&define.amd?define(["vue"],z):(se=typeof globalThis!="undefined"?globalThis:se||self,z(se.Q))})(this,function(se){"use strict";var Xo=Object.defineProperty,Zo=Object.defineProperties;var er=Object.getOwnPropertyDescriptors;var Zn=Object.getOwnPropertySymbols;var tr=Object.prototype.hasOwnProperty,nr=Object.prototype.propertyIsEnumerable;var Ut=(se,z,ne)=>z in se?Xo(se,z,{enumerable:!0,configurable:!0,writable:!0,value:ne}):se[z]=ne,L=(se,z)=>{for(var ne in z||(z={}))tr.call(z,ne)&&Ut(se,ne,z[ne]);if(Zn)for(var ne of Zn(z))nr.call(z,ne)&&Ut(se,ne,z[ne]);return se},de=(se,z)=>Zo(se,er(z));var j=(se,z,ne)=>Ut(se,typeof z!="symbol"?z+"":z,ne);var K=(se,z,ne)=>new Promise((ft,Se)=>{var Ne=ue=>{try{Y(ne.next(ue))}catch(Me){Se(Me)}},Ze=ue=>{try{Y(ne.throw(ue))}catch(Me){Se(Me)}},Y=ue=>ue.done?ft(ue.value):Promise.resolve(ue.value).then(Ne,Ze);Y((ne=ne.apply(se,z)).next())});var Re;function z(t,e){for(var n=0;n<e.length;n++){const i=e[n];if(typeof i!="string"&&!Array.isArray(i)){for(const s in i)if(s!=="default"&&!(s in t)){const a=Object.getOwnPropertyDescriptor(i,s);a&&Object.defineProperty(t,s,a.get?a:{enumerable:!0,get:()=>i[s]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}var ne=t=>t==null,ft=t=>Object.prototype.toString.call(t),Se=t=>e=>e!==null&&(Array.isArray(t)?t:[t]).some(n=>ft(e)===`[object ${n}]`),Ne=Se("String"),Ze=t=>Se("Boolean")(t),Y=Se(["Function","AsyncFunction","GeneratorFunction"]),ue=Se("Object"),Me=Se("Undefined"),gt=t=>Number.isInteger(t);function ti(t){if(!Y(t))return!1;const e=Function.prototype.toString.call(t);if(/^class[\s{]/.test(e))return!0;const n=e.replace(/^[^{]*\{\s*/,"").replace(/\s*\}[^}]*$/,"");return/classCallCheck\(/.test(n)||/TypeError\("Cannot call a class as a function"\)/.test(n)}function ni(t){return Y(t==null?void 0:t.then)}var _t=["debug","info","warn","error"].reduce((t,e,n,i)=>de(L({},t),{[e]:i.slice(n)}),{});function ii(){return new Date().toLocaleString()}var si=class{constructor(t={}){j(this,"options",{debug:!1,prefix:"Galileo",name:"",colors:{info:"#09f",warn:"#f90",error:"#f66",debug:"#888"}});this.set(t)}set(t={}){const e=L(L({},this.options.colors),t.colors||{});this.options=de(L(L({},this.options),t),{colors:e});const{name:n,prefix:i}=this.options;n&&(this.options.prefix=`${i}[${n}]`)}log(t,...e){const{debug:n,prefix:i,colors:s}=this.options;if(Ze(n)&&n||Ne(n)&&_t[n]&&_t[n].includes(t)){const a=s?s[t]:"#888",r=[`%c ${i} %c ${t.toUpperCase()} %c ${e.length?"%o":""}`,`background: ${a}; border: 1px solid ${a}; padding: 1px; border-radius: 4px 0 0 4px; color: #fff;`,`border: 1px solid ${a}; padding: 1px; border-radius: 0 4px 4px 0; color: ${a};`,"background: transparent"];console.log(...r,ii(),...e)}}info(...t){this.log("info",...t)}debug(...t){this.log("debug",...t)}warn(...t){this.log("warn",...t)}error(...t){this.log("error",...t)}},ai=(t,e)=>new si(L({prefix:t},e)),oi=t=>Ze(t)?t:t?!!_t[t]:!1;function Ve(t,e){if(!e)return t;const n=Object.keys(e);for(let i=0;i<n.length;i++){const s=n[i],a=e[s],r=t[s];Array.isArray(a)?Array.isArray(r)?t[s]=Ve(r,a):t[s]=Ve([],a):ue(a)?ue(r)?t[s]=Ve(r,a):t[s]=Ve({},a):(r===void 0||a!==void 0)&&(t[s]=a)}return t}function ri(t,...e){return e.reduce((n,i)=>Ve(n,i),t)}function li(t){return new Promise(e=>setTimeout(e,t))}function ci(t,e){const{defaultValue:n=null,throw:i}={};try{return JSON.stringify(t)}catch(s){if(i)throw s;return n}}function ui(t,e){const n=Object.keys(t);for(let i=0;i<n.length;i++){const s=n[i],a=t[s];e(a,s,t)}}var Jt=typeof window!="undefined",vt=()=>{const t=window.safari;return!!(typeof t=="object"&&t.pushNotification)},mt=()=>{const t=navigator.userAgent;return/android/i.test(t)},De=t=>{const e=t||navigator.userAgent;return/\(i[^;]+;( U;)? CPU.+Mac OS X/i.test(e)},ye=()=>/klook/i.test(navigator.userAgent),hi=()=>{try{const t="g:__test__";return localStorage.setItem(t,t),localStorage.removeItem(t),!0}catch(t){return console.log("Not support localStorage",t),!1}},di=t=>{const e={cacheVal:null,isCalled:!1};return()=>(e.isCalled||(e.cacheVal=t(),e.isCalled=!0),e.cacheVal)},fi=di(hi),Ht=class{constructor(t){j(this,"_state",[]);j(this,"_options",{max:20});this._options=L(L({},this._options),t)}push(t){const{max:e}=this._options;this._state.length>=e&&this._state.shift(),this._state.push(t)}getLast(t){return this._state.slice(-t)}getState(){return this._state.slice()}},$={HIDDEN:"hidden",VISIBLE:"visible"};function $t(t,e,n){if(t.length!==e.length)return!1;for(let i=0;i<t.length;i++){const s=t[i],a=e[i];if(!n(s,a))return!1}return!0}function gi(t){const e=[{all:[["pagehide",$.VISIBLE],["visibilitychange",$.HIDDEN]],partial:[["visibilitychange",$.HIDDEN],["visibilitychange",$.VISIBLE],["pagehide",$.VISIBLE],["visibilitychange",$.HIDDEN]]},{all:[["beforeunload",$.VISIBLE],["pagehide",$.VISIBLE],["visibilitychange",$.HIDDEN],["unload",$.HIDDEN]],partial:[["visibilitychange",$.HIDDEN],["visibilitychange",$.VISIBLE],["beforeunload",$.VISIBLE],["pagehide",$.VISIBLE],["visibilitychange",$.HIDDEN],["unload",$.HIDDEN]]},{all:[["beforeunload",$.VISIBLE],["pagehide",$.VISIBLE],["visibilitychange",$.HIDDEN]],partial:[["visibilitychange",$.HIDDEN],["visibilitychange",$.VISIBLE],["beforeunload",$.VISIBLE],["pagehide",$.VISIBLE],["visibilitychange",$.HIDDEN]]}],n=s=>s.map(a=>({event_name:a[0],visibility:a[1]}));let i=!1;for(let s=0;s<e.length;s++){const a=e[s],r=t.getState(),{all:l,partial:u}=a,v=n(l),p=(w,y)=>w.event_name===y.event_name&&w.visibility===y.visibility;if($t(r,v,p)){i=!0;break}const f=n(u),m=t.getLast(f.length);if($t(m,f,p)){i=!0;break}}return i}function Fe(t,e){t.push({event_name:e,visibility:document.visibilityState})}function _i(t){const e=[["beforeunload","pagehide","unload"],["beforeunload","unload"],["visibilitychange","pagehide","unload"],["visibilitychange","unload"]],n=t.getLast(4).map(i=>i.event_name);return e.some(i=>i.every(s=>n.includes(s)))}function vi(t){const e={pagehide:$.VISIBLE,unload:$.HIDDEN};return t.getLast(1).every(i=>{const s=i.event_name;return e[s]===i.visibility})}function mi(t){return De()&&ye()?vi(t):vt()?gi(t):_i(t)}function et(t,e){const n=mi(t);e(n)}function pi(t,e){const n=t.getLast(3),i=n.map(s=>s.event_name);if(mt()&&ye()){const s=[{k:"beforeunload",v:$.VISIBLE},{k:"visibilitychange",v:$.HIDDEN}],a=n.slice(-2);s.every((r,l)=>{const{k:u,v}=r,{event_name:p,visibility:f}=a[l]||{};return p===u&&f===v})&&setTimeout(()=>{const[r]=t.getLast(1);if((r==null?void 0:r.event_name)!=="unload")return e()},100);return}i.includes("beforeunload")||e()}var yi=class{constructor(){j(this,"_onBeforeUnload");j(this,"_onPageHide");j(this,"_onPageShow");j(this,"_onPageUnload");j(this,"_onVisibilityChange");j(this,"_subscribers",new Map);j(this,"addListener");j(this,"removeListener");j(this,"states");this.addListener=window.addEventListener.bind(window),this.removeListener=window.removeEventListener.bind(window),this.states=new Ht,this.initCallback()}initCallback(){const{states:t}=this;this._onBeforeUnload=()=>{Fe(t,"beforeunload"),this.onBeforeUnload()},this._onPageHide=e=>{Fe(t,"pagehide"),this.onPageHide()},this._onPageShow=e=>{Fe(t,"pageshow"),this.onPageShow()},this._onVisibilityChange=()=>{Fe(t,"visibilitychange"),this.onVisibilityChange()},this._onPageUnload=()=>{Fe(t,"unload"),this.onPageUnload()}}onPageShow(){}onPageHide(){De()&&ye()&&et(this.states,t=>{t&&this.onPageLeave({leave_type:"close"})})}onBeforeUnload(){}onPageUnload(){const{states:t}=this;et(t,e=>{De()&&ye()&&t.getLast(4).some(i=>i.event_name==="pagehide")||e&&this.onPageLeave({leave_type:"close"})})}onVisibilityChange(){const{states:t}=this;if(document.visibilityState===$.VISIBLE)this.onPageView({view_type:"show"});else if(De()&&ye()){if(t.getLast(4).some(n=>n.event_name==="pagehide"))return;et(t,n=>{this.onPageLeave({leave_type:n?"close":"hide"})})}else vt()?et(t,e=>{this.onPageLeave({leave_type:e?"close":"hide"})}):pi(t,()=>{this.onPageLeave({leave_type:"hide"})})}onPageView(t){this._callSubs("onPageView",t)}onPageLeave(t){this._callSubs("onPageLeave",t)}_callSubs(t,e){const n=this._subscribers.get(t);n==null||n.forEach(i=>i.fn(e))}subscribe(t,e,n){const i=this._subscribers.get(t)||[];Y(n)&&!i.map(s=>s.id).includes(e)&&i.push({id:e,fn:n}),this._subscribers.set(t,i)}unbindEvents(){this.removeListener("pageshow",this._onPageShow),this.removeListener("beforeunload",this._onBeforeUnload),this.removeListener("unload",this._onPageUnload),document.removeEventListener("pagehide",this._onPageHide),document.removeEventListener("visibilitychange",this._onVisibilityChange)}bindEvents(){this.addListener("pageshow",this._onPageShow),this.addListener("beforeunload",this._onBeforeUnload),this.addListener("unload",this._onPageUnload),document.addEventListener("pagehide",this._onPageHide),document.addEventListener("visibilitychange",this._onVisibilityChange)}destroy(){this.unbindEvents(),this._subscribers.clear()}};const oe=[];for(let t=0;t<256;++t)oe.push((t+256).toString(16).slice(1));function bi(t,e=0){return(oe[t[e+0]]+oe[t[e+1]]+oe[t[e+2]]+oe[t[e+3]]+"-"+oe[t[e+4]]+oe[t[e+5]]+"-"+oe[t[e+6]]+oe[t[e+7]]+"-"+oe[t[e+8]]+oe[t[e+9]]+"-"+oe[t[e+10]]+oe[t[e+11]]+oe[t[e+12]]+oe[t[e+13]]+oe[t[e+14]]+oe[t[e+15]]).toLowerCase()}let pt;const wi=new Uint8Array(16);function Si(){if(!pt){if(typeof crypto=="undefined"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");pt=crypto.getRandomValues.bind(crypto)}return pt(wi)}const Vt={randomUUID:typeof crypto!="undefined"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function Ei(t,e,n){if(Vt.randomUUID&&!t)return Vt.randomUUID();t=t||{};const i=t.random||(t.rng||Si)();return i[6]=i[6]&15|64,i[8]=i[8]&63|128,bi(i)}var Oi=Object.defineProperty,ki=(t,e,n)=>e in t?Oi(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,q=(t,e,n)=>ki(t,typeof e!="symbol"?e+"":e,n),Ii="galileo:core",Pi=class{constructor(t){q(this,"_isInit",!1),q(this,"_isReady",!1),q(this,"_seq",0),q(this,"pvid",-1),q(this,"fromPvid",-1),q(this,"log_id",0),q(this,"log_id_prefix",""),q(this,"_page_open_id",""),q(this,"start_time"),q(this,"_subs",[]),q(this,"instanceId",""),q(this,"logger"),this.logger=ai(Ii,{debug:!!(t!=null&&t.is_debug_mode)}),this.start_time=Date.now()}isReady(){return this._isReady}getPageOpenId(){return this._page_open_id||(this._page_open_id=this.getUuid()),this._page_open_id}refreshPageOpenId(){this._page_open_id=this.getUuid()}getInstanceId(){return this.instanceId||(this.instanceId=this.getUuid()),this.instanceId}getUuid(){return Ei()}getSeq(){return this._seq}setSeq(t){this._seq=t}resetSeq(){this._seq=0}getPvid(){return this.pvid}setPvid(t){this.pvid=t}getFromPvid(){return this.fromPvid}setFromPvid(t){this.fromPvid=t}getLogId(){return this.log_id}getLogIdPrefix(){return this.log_id_prefix}setLogIdPrefix(t){this.log_id_prefix=t}getLogIdUid(){return`${this.log_id_prefix}_${this.log_id}`}setLogId(t){ne(t)?this.log_id=this.log_id+1:this.log_id=t}getStartTime(){return this.start_time}},Ge=(t=>(t.onCreateEventData="onCreateEventData",t.onHandleEventData="onHandleEventData",t.onDataEncoding="onDataEncoding",t.onUpdateNewHost="onUpdateNewHost",t.onUpdateNewContext="onUpdateNewContext",t.onLutChange="onLutChange",t.onSend="onSend",t))(Ge||{}),W=(t=>(t.Pageview="$WebPageView",t.Pageleave="$WebPageLeave",t.Click="$Click",t.PopupView="$PopupView",t.PageLoad="$PageLoad",t.Exposure="$Exposure",t.PopupLoad="$PopupLoad",t.BusinessEvent="$BusinessEvent",t))(W||{}),Ft=class{constructor(t){q(this,"_config",{}),q(this,"_subs",[]),this._config=L(L({},this._config),t)}get(t){return this._config[t]}set(t,e){const n=this._config[t];e!==void 0&&(ue(n)?this._config[t]=e:this._config[t]=e,this._subs.forEach(i=>i(this)))}serialize(){return L({},this._config)}toJson(){return JSON.parse(JSON.stringify(this._config))}getConfig(){return this.toJson()}setConfig(t){Object.assign(this._config,t),this._subs.forEach(e=>e(this))}subscribe(t){Y(t)&&!this._subs.includes(t)&&this._subs.push(t)}};q(Ft,"name","configManager");var Gt=(...t)=>ri(t[0],...t.slice(1)),Wt=class{constructor(t){q(this,"app"),q(this,"event",{}),q(this,"context",{}),q(this,"user",{}),q(this,"traffic",{}),q(this,"event_data",{}),q(this,"logger",{}),q(this,"event_name",""),q(this,"schema","com.klook.galileo.web.common:1.1.0"),this.event_data=t,this.event_name=t.event_name}isType(t){return this.event_name===t}getSchema(){return this.schema}setSchema(t){this.schema=t}getEventTime(){const{event_data:t}=this;return(t==null?void 0:t.timestamp)||(t==null?void 0:t.event_time)}setContext(t){this.context=L(L({},this.context),t)}setUser(t){this.user=L(L({},this.user),t)}setEvent(t){this.event=L(L({},this.event),t)}setTraffic(t){this.traffic=L({},t)}init(t){this.app=t}collect(){}compose(){}validate(){}encapsulate(){return this.serialize()}serialize(){const t=de(L({},this.logger),{msg:{schema:this.getSchema(),event:this.event,context:this.context,user:this.user,traffic:this.traffic}});return JSON.parse(JSON.stringify(t))}deserialize(){}},yt="__context_stop__",xi=class{constructor(t,e){q(this,"_context",{}),q(this,"app"),q(this,"event"),q(this,"event_data",{}),q(this,"_error",[]),this.event_data=t,this.event=new Wt(t),this.event.app=e,this.app=e}get(t){return this._context[t]}set(t,e){this._context[t]=e}stop(t){return this._context[yt]={reason:t,stop:!0},this}getStopReason(){var t;return(t=this._context[yt])==null?void 0:t.reason}isStop(){return!!this._context[yt]}getError(){return this._error}error(t,e){this._error.push({type:t,error:e})}},Ci=class extends Pi{constructor(t){super({is_debug_mode:!!(t!=null&&t.is_debug_mode)}),q(this,"version"),q(this,"plugins",[]),q(this,"corePlugins",[]),q(this,"_hookCacheMap",new Map),q(this,"pluginList",[]),q(this,"_schemaMap",new Map),q(this,"_sharedStateMap",new Map),q(this,"configManager"),this.corePlugins=this.corePlugins.concat(t.corePlugins||[]),this.version=t.version,this.configManager=new Ft(L({},t)),this.subscribeConfigChange()}setPluginInstance(t){this.pluginList.includes(t)||this.pluginList.push(t)}subscribeConfigChange(){this.configManager.subscribe(()=>{this.logger.set({debug:this.isDebugMode()})})}setConfig(t){let e=this.configManager.getConfig();e=Gt(e,t),this.configManager.setConfig(e)}getConfig(t){return t?this.configManager.get(t):this.configManager.getConfig()}init(){return K(this,null,function*(){this._isInit||(this._isInit=!0,yield this.initPlugin(),this._isReady=!0,yield this.onReady())})}onReady(){this._subs.forEach(t=>{t(this)}),this._subs.length=0}initPlugin(){return K(this,null,function*(){var t,e;(this.configManager.get("plugins")||[]).forEach(l=>{Y(l)&&this.plugins.push(l)});let i=this.corePlugins;i=[...i,...this.plugins];const s=[],a=i.map(l=>{var u;const v=ti(l)?new l(this):l,p=(u=v.config)==null?void 0:u.bind(v);return Y(p)&&s.push(p),this.setPluginInstance(v),v});let r=this.configManager.getConfig();s.forEach(l=>{const u=l(r);r=Gt(r,u)}),this.configManager.setConfig(r);for(const l of a){const u=l.name;yield(t=l.onInit)==null?void 0:t.call(l,u?this.configManager.get(u):{})}for(const l of a)yield(e=l.onReady)==null?void 0:e.call(l,this)})}runHookSync(t,e,n){const i=this.pluginList;let s=null;for(let a=0;a<i.length;a++){const r=i[a],l=r[t];if(Y(l)&&(Y(l)&&(s=l.call(r,{payload:e,result:s})||s),Y(n)&&n(s)))break}return s}runHooks(t,e,n){let i=this.pluginList,s=!1;const a=`runhooks:${t}`;let r=this._hookCacheMap.get(a);t&&r?(i=r,s=!0):r=[];const l=i.length;if(l===0)return n==null?void 0:n(e);const u=v=>{if(v>=l)return!s&&t&&this._hookCacheMap.set(a,r),n==null?void 0:n(e);const f=i[v];f.context=e;const m=()=>u(v+1),w=f[t];if(Y(w)){const k=w.call(f,e);return s||r==null||r.push(f),k&&Y(k.then)?k.then(()=>m()).catch(S=>(e.error("hooks",S),m())):m()}else return m()};return u(0)}runPluginHookSync(t){const e=this.pluginList;let n=null;for(let i=0;i<e.length;i++){const s=e[i];if(Y(t)&&(n=t(s)),n)break}return n}runPluginHook(t){return K(this,null,function*(){const e=this.pluginList;let n=null;for(let i=0;i<e.length;i++){const s=e[i];if(Y(t)&&(n=yield t(s)),n)break}return n})}registerPlugin(t){this.plugins.push(t)}subscribe(t){if(this.isReady())return t(this);Y(t)&&!this._subs.includes(t)&&this._subs.push(t)}isDebugMode(){return oi(this.getDebugMode())}getDebugMode(){return this.configManager.get("is_debug_mode")}createContext(t){return new xi(t,this)}registerSchema(t,e,n={}){const{force:i}=n;return this._schemaMap.has(t)&&(this.logger.warn("Schema already registered",t),!i)?this:(this._schemaMap.set(t,e),this)}getSchema(t){return this._schemaMap.get(t)}setSharedState(t,e){return this._sharedStateMap.set(t,e),this}getSharedState(t){return this._sharedStateMap.get(t)}removeSharedState(t){this._sharedStateMap.delete(t)}},fe=class{constructor(t){q(this,"app"),q(this,"context"),this.app=t}onInit(){}onReady(){}},Ni=class{constructor(t={}){j(this,"_storage");try{this.createStorage(t)}catch(e){console.error("init localforage error",e)}}createStorage(){return K(this,arguments,function*(t={}){return Promise.resolve().then(()=>Ya).then(e=>{const n=e.default||e;this._storage=n.createInstance({name:t.name||"galileo",storeName:t.storeName||"klook:galileo"})})})}setAsync(t,e){return K(this,null,function*(){if(!this._storage)return!1;try{yield this._storage.setItem(t,e)}catch(n){return console.error("setAsync error",n),!1}return!0})}setJsonAsync(t,e){return K(this,null,function*(){var n;const i=JSON.stringify(e);yield(n=this._storage)==null?void 0:n.setItem(t,i)})}getAsync(t){return K(this,null,function*(){var e;return yield(e=this._storage)==null?void 0:e.getItem(t)})}getListAsync(){return K(this,arguments,function*(t={limit:10}){var e;const{limit:n}=t;try{const i=[];return yield(e=this._storage)==null?void 0:e.iterate((s,a,r)=>{if(r<=n)i.push({key:a,value:s});else return!0}),i}catch(i){console.error("Get Async list error: ",i)}return[]})}keys(){return K(this,null,function*(){var t;try{return yield(t=this._storage)==null?void 0:t.keys()}catch(e){return console.error("keys error",e),[]}})}key(t){return K(this,null,function*(){var e;return(e=this._storage)==null?void 0:e.key(t)})}getJsonAsync(t){return K(this,null,function*(){var e;try{return yield(e=this._storage)==null?void 0:e.getItem(t)}catch(n){return console.error("getJsonAsync error",n),null}})}length(){var t;return(t=this._storage)==null?void 0:t.length()}delete(t){return K(this,null,function*(){var e;yield(e=this._storage)==null?void 0:e.removeItem(t)})}};["debug","info","warn","error"].reduce((t,e,n,i)=>de(L({},t),{[e]:i.slice(n)}),{});var Di=()=>{try{const t="g:__test__";return localStorage.setItem(t,t),localStorage.removeItem(t),!0}catch(t){return console.log("Not support localStorage",t),!1}},Li=t=>{const e={cacheVal:null,isCalled:!1};return()=>(e.isCalled||(e.cacheVal=t(),e.isCalled=!0),e.cacheVal)},Ti=Li(Di),Ai=class{constructor(){j(this,"_storage");Ti()&&(this._storage=localStorage)}clear(){throw new Error("Method not implemented.")}set(t,e){var n;return this._storage?((n=this._storage)==null||n.setItem(t,e),!0):!1}setJson(t,e){var n;if(!this._storage)return!1;const i=JSON.stringify(e);return(n=this._storage)==null||n.setItem(t,i),!0}get(t){return this._storage?this._storage.getItem(t):null}getJson(t){if(!this._storage)return null;const e=this._storage.getItem(t);if(e)try{return JSON.parse(e)}catch(n){return console.log("storage err",n),null}return null}delete(t){return this._storage?(this._storage.removeItem(t),!0):!1}},Ri=class{constructor(t){j(this,"syncStorage");j(this,"asyncStorage");var e,n;this.syncStorage=(e=t==null?void 0:t.syncStorage)!=null?e:new Ai,this.asyncStorage=(n=t==null?void 0:t.asyncStorage)!=null?n:new Ni(t.storageConfig)}},Bi=class extends fe{onInit(){this.app.storage=new Ri({})}},he=(Re=class extends Error{constructor(e,n,i,s,a){super(e);j(this,"config");j(this,"code");j(this,"request");j(this,"response");j(this,"status");j(this,"isAxiosError",!0);this.config=i,n&&(this.code=n),s&&(this.request=s),this.name="GalileoError",Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error("err").stack,a&&(this.response=a,this.status=a.status?a.status:null)}toJSON(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Vi(()=>this.config),code:this.code,status:this.status}}},j(Re,"ERR_BAD_REQUEST","ERR_BAD_REQUEST"),j(Re,"ERR_BAD_RESPONSE","ERR_BAD_RESPONSE"),j(Re,"ECONNABORTED","ECONNABORTED"),j(Re,"ERR_NETWORK","ERR_NETWORK"),j(Re,"ETIMEDOUT","ETIMEDOUT"),Re),Mi=["http","https","file","data"];function ji(t){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(t);return e&&e[1]||""}function qi(t,e,n){const i=n.config.validateStatus;!n.status||!i||i(n.status)?t(n):e(new he(`Request failed with status code ${n.status}`,[he.ERR_BAD_REQUEST,he.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n))}function Ui(t,e){Object.keys(t).forEach(n=>{e(t[n],n)})}var Ji=new Set(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Hi=t=>{const e={};let n,i,s;return t&&t.split(`
`).forEach(a=>{if(s=a.indexOf(":"),n=a.substring(0,s).trim().toLowerCase(),i=a.substring(s+1).trim(),!(!n||e[n]&&Ji.has(n)))if(n==="set-cookie"){const r=e[n];Array.isArray(r)?r.push(i):e[n]=[i]}else e[n]=e[n]?`${e[n]}, ${i}`:i}),e};function $i(t){const{config:e,request:n}=this;try{return JSON.parse(t)}catch(i){const s=i;throw s.name==="SyntaxError"?new he(s==null?void 0:s.message,he.ERR_BAD_RESPONSE,e,n,this):s}}var Vi=t=>{try{return t()}catch(e){return console.error(e),null}},Qt=class ei{constructor(e){j(this,"headers");this.headers=e||{}}set(e,n){this.headers[e]=n}get(e){return this.headers[e]||this.headers[e.toLowerCase()]}delete(e){delete this.headers[e]}getAllHeaders(){return this.headers}clearHeaders(){this.headers={}}setContentType(e){this.headers["Content-Type"]=e}static from(e){const n=Ne(e)?Hi(e):e||{};return new ei(n)}toJSON(){return this.headers}},Fi={method:"GET",timeout:30*1e3,responseType:"json",clarifyTimeoutError:!0,headers:{Accept:"application/json, text/plain, */*","Content-Type":void 0},validateStatus:function(e){return e>=200&&e<300}};function Kt(t){return new Promise((e,n)=>{const i=Object.assign(L({},Fi),t),s=i.data,a=Qt.from(i.headers),{responseType:r}=i;let l=new XMLHttpRequest;l.open(i.method.toUpperCase(),i.url,!0),l.timeout=i.timeout;function u(){if(!l)return;const p=Qt.from("getAllResponseHeaders"in l&&l.getAllResponseHeaders()),f=!r||r==="text"||r==="json"?l.responseText:l.response;let m=null;const w={data:f,responseText:l.responseText,status:l.status,statusText:l.statusText,headers:p,config:t,request:l};r==="json"&&(m=$i.call(w,f),w.data=m),qi(y=>{e(y)},y=>{n(y)},w),l=null}"onloadend"in l?l.onloadend=u:l.onreadystatechange=function(){!l||l.readyState!==4||l.status===0&&!(l.responseURL&&l.responseURL.indexOf("file:")===0)||setTimeout(u)},l.onabort=function(){l&&(n(new he("Request aborted",he.ECONNABORTED,t,l)),l=null)},l.onerror=function(){n(new he("Network Error",he.ERR_NETWORK,t,l)),l=null},l.ontimeout=function(){let f=i.timeout?`timeout of ${i.timeout}ms exceeded`:"timeout exceeded";const m=t.clarifyTimeoutError;i.timeoutErrorMessage&&(f=i.timeoutErrorMessage),n(new he(f,m?he.ETIMEDOUT:he.ECONNABORTED,t,l)),l=null},s===void 0&&a.setContentType(null),"setRequestHeader"in l&&Ui(a.toJSON(),(p,f)=>{l.setRequestHeader(f,p)}),Me(i.withCredentials)||(l.withCredentials=!!i.withCredentials),r&&r!=="json"&&(l.responseType=i.responseType);const v=ji(i.url);if(v&&!Mi.includes(v)){n(new he(`Unsupported protocol ${v}:`,he.ERR_BAD_REQUEST,t));return}l.send(s||null)})}var Gi=t=>Kt(de(L({},t),{method:"POST"})),Wi=class{constructor(t){j(this,"_config",{headers:{"Content-Type":"application/json"}});j(this,"subscribers",[]);this._config=L(L({},this._config),t)}interceptor(t,e){this.subscribers.push([t,e])}success(t){return K(this,null,function*(){for(const[e]of this.subscribers)yield e(t)})}fail(t){return K(this,null,function*(){for(const[,e]of this.subscribers)yield e==null?void 0:e(t)})}onResponse(t){return K(this,null,function*(){if(t.success)yield this.success(t);else{try{yield this.fail(t)}catch(e){console.error("Reuqest Error",e)}return Promise.reject(t)}return t})}encoding(t){return JSON.stringify(t)}buildUrl(t,e){let n=t;const i=e||{};if(typeof URL!="undefined"){const s=new URL(n);Object.keys(i).forEach(a=>{s.searchParams.set(a,i[a])}),n=s.toString()}else{const[s,a]=n.split("?"),r=Object.keys(i).map(u=>`${u}=${i[u]}`),l=[a||"",...r].filter(Boolean).join("&");n=`${s}?${l}`}return n}post(i,s){return K(this,arguments,function*(t,e,n={usingBeacon:!1}){var a,r;const{usingBeacon:l,query:u,headers:v}=n||{},p=this.buildUrl(t,u);try{let f=!1;const m=this.encoding(e),{headers:w}=this._config,y=L(L({},w),v),k=m;if(l&&typeof Blob!="undefined"){const C=new Blob([m],{type:(y==null?void 0:y["Content-Type"])||"application/json"});f=this.sendBeacon(p,C)}let S={success:!!f};if(!f){const C=yield this.fetch(p,k,{headers:y});if(C.status>=200&&C.status<300){const N=(yield C==null?void 0:C.json())||{};S=N.success?{success:!0,result:N.result}:{success:!1,errmsg:(a=N==null?void 0:N.error)==null?void 0:a.message,errcode:(r=N==null?void 0:N.error)==null?void 0:r.code}}if(!S.success){const N=yield this.withFallback({url:p,data:this.encoding(e),headers:L(L({},this._config.headers),n.headers)});S=L({},N)}}return this.onResponse(S)}catch(f){const m=yield this.withFallback({url:p,data:this.encoding(e),headers:L(L({},this._config.headers),n.headers)});return m&&!m.success&&(m.errmsg+=`;Fetch Error: ${f.message}`),this.onResponse(m)}})}withFallback(t){const{url:e,data:n,headers:i}=t;return this.postWithXhr({url:e,data:n,headers:i}).then(s=>{var a,r;const l=s.data||{},u=l.success?{}:{errmsg:`Server Error: ${(a=l.error)==null?void 0:a.message}`,errcode:(r=l.error)==null?void 0:r.code};return L({success:l.success},u)}).catch(s=>{var a;const r=s;if(r.isAxiosError){const l=((a=r.toJSON)==null?void 0:a.call(r))||{};return{success:!1,errmsg:`${l.name}- ${l.message}- ${l.stack}- ${l.status}- ${l.code}`,errcode:r.code}}else return{success:!1,errmsg:`Client Error: ${r.message}`,errcode:r.name}})}fetch(t,e,n){const{headers:i}=this._config;return fetch(t,de(L({method:"POST",keepalive:!0,credentials:"omit",body:e},n),{headers:L(L({},i),n==null?void 0:n.headers)}))}postWithXhr(t){return Gi(t)}sendXhr(t){return Kt(t)}sendBeacon(t,e){let n=!1;try{n=navigator.sendBeacon(t,e)}catch(i){console.error("sendBeacon error",i),n=!1}return n}},Qi=t=>btoa(encodeURIComponent(t).replace(/%([0-9A-F]{2})/g,(e,n)=>String.fromCharCode(+`0x${n}`))),Ki=class extends fe{constructor(){super(...arguments);j(this,"name","galileoRequest")}onInit(){this.app.request=new Wi,this.app.sendDebugData=this.sendDebugData.bind(this)}getDeviceId(){var e;const n=this.app.configManager.get("device_id");if(!n){const s=document.cookie.split(";").find(a=>a.includes("kepler_id"));return((e=s||"")==null?void 0:e.split("=")[1])||s||"device-id-not-in-cookie"}return n}getPlatform(){const e=navigator.userAgent,n=this.app.configManager.get("platform");return n&&["mobile","desktop"].includes(n)?n:e.includes("Android")||e.includes("iPhone")?"mobile":"desktop"}sendDebugData(e){try{this._sendDebugData(e)}catch(n){this.app.logger.error("sendDebugData",n)}}_sendDebugData(e){return K(this,null,function*(){if(!e)return;const{level:n="E"}=e,i=this.getDeviceId(),s=JSON.stringify({system:"optimus",subtype:"galileo-tracker-data",message:L({current_url:window.location.href,url_path:window.location.pathname,kepler_id:i},e)}),a=this.getPlatform(),r={type:5,level:n,time:Date.now(),msg:Qi(s),log_ver:1,uid:"",is_masked:!0,platform:a,device_id:i},l=JSON.stringify({logs:[r]}),v=`https://log.klook.${/\.cn$/.test(window.location.host||"")?"cn":"com"}/v3/frontlogsrv/log/web`,p=()=>{var f;(f=this.app.request.fetch(v,l,{headers:{"X-Platform":a}}))==null||f.catch(m=>{console.error("sendDebugData error",m)})};try{yield this.app.request.sendXhr({url:v,method:"POST",data:l,headers:{"Content-Type":"application/json","X-Platform":a}})}catch(f){console.error("senddebug xhr error",f),p()}})}};class Ee{constructor(e){if(this.is_schema_type=!0,e)for(let n=Object.keys(e),i=0;i<n.length;++i){const s=n[i],a=e[s];a!=null&&e.hasOwnProperty(s)&&(this[s]=a)}}toJSON(){const e={};return this.lib_version!=null&&(e.lib_version=this.lib_version),this.platform!=null&&(e.platform=this.platform),this.user_agent!=null&&(e.user_agent=this.user_agent),this.currency!=null&&(e.currency=this.currency),this.language!=null&&(e.language=this.language),this.site_name!=null&&(e.site_name=this.site_name),this.app_id!=null&&(e.app_id=this.app_id),this.app_version_string!=null&&(e.app_version_string=this.app_version_string),this.app_builder_number!=null&&(e.app_builder_number=this.app_builder_number),this.app_open_id!=null&&(e.app_open_id=this.app_open_id),this.device_id!=null&&(e.device_id=this.device_id),this.carrier!=null&&(e.carrier=this.carrier),this.wifi!=null&&(e.wifi=this.wifi),this.device_region_code!=null&&(e.device_region_code=this.device_region_code),this.manufacture!=null&&(e.manufacture=this.manufacture),this.model!=null&&(e.model=this.model),this.os!=null&&(e.os=this.os),this.os_version!=null&&(e.os_version=this.os_version),this.screen_height!=null&&(e.screen_height=this.screen_height),this.screen_width!=null&&(e.screen_width=this.screen_width),this.device_language!=null&&(e.device_language=this.device_language),this.ios_ifa!=null&&(e.ios_ifa=this.ios_ifa),this.radio!=null&&(e.radio=this.radio),this.android_id!=null&&(e.android_id=this.android_id),this.domain!=null&&(e.domain=this.domain),this.lut!=null&&(e.lut=this.lut),this.ck!=null&&(e.ck=this.ck),this.browser!=null&&(e.browser=this.browser),this.browser_version!=null&&(e.browser_version=this.browser_version),this.current_url!=null&&(e.current_url=this.current_url),this.url_path!=null&&(e.url_path=this.url_path),this.srv_client_time_diff!=null&&(e.srv_client_time_diff=this.srv_client_time_diff),e}static fromObject(e){const n=new this,i=e.lib_version;i!=null&&(n.lib_version=i);const s=e.platform;s!=null&&(n.platform=s);const a=e.user_agent;a!=null&&(n.user_agent=a);const r=e.currency;r!=null&&(n.currency=r);const l=e.language;l!=null&&(n.language=l);const u=e.site_name;u!=null&&(n.site_name=u);const v=e.app_id;v!=null&&(n.app_id=v);const p=e.app_version_string;p!=null&&(n.app_version_string=p);const f=e.app_builder_number;f!=null&&(n.app_builder_number=f);const m=e.app_open_id;m!=null&&(n.app_open_id=m);const w=e.device_id;w!=null&&(n.device_id=w);const y=e.carrier;y!=null&&(n.carrier=y);const k=e.wifi;k!=null&&(n.wifi=k);const S=e.device_region_code;S!=null&&(n.device_region_code=S);const C=e.manufacture;C!=null&&(n.manufacture=C);const N=e.model;N!=null&&(n.model=N);const Z=e.os;Z!=null&&(n.os=Z);const B=e.os_version;B!=null&&(n.os_version=B);const O=e.screen_height;O!=null&&(n.screen_height=O);const A=e.screen_width;A!=null&&(n.screen_width=A);const T=e.device_language;T!=null&&(n.device_language=T);const J=e.ios_ifa;J!=null&&(n.ios_ifa=J);const F=e.radio;F!=null&&(n.radio=F);const Q=e.android_id;Q!=null&&(n.android_id=Q);const ee=e.domain;ee!=null&&(n.domain=ee);const ce=e.lut;ce!=null&&(n.lut=ce);const ve=e.ck;ve!=null&&(n.ck=ve);const Pe=e.browser;Pe!=null&&(n.browser=Pe);const Be=e.browser_version;Be!=null&&(n.browser_version=Be);const He=e.current_url;He!=null&&(n.current_url=He);const be=e.url_path;be!=null&&(n.url_path=be);const ze=e.srv_client_time_diff;return ze!=null&&(n.srv_client_time_diff=ze),n}static toObject(e){return this.fromObject(e).toJSON()}}class Oe{constructor(e){if(this.is_schema_type=!0,e)for(let n=Object.keys(e),i=0;i<n.length;++i){const s=n[i],a=e[s];a!=null&&e.hasOwnProperty(s)&&(this[s]=a)}}toJSON(){const e={};return this.global_id!=null&&(e.global_id=this.global_id),this.assumed_residence!=null&&(e.assumed_residence=this.assumed_residence),this.user_residence!=null&&(e.user_residence=this.user_residence),e}static fromObject(e){const n=new this,i=e.global_id;i!=null&&(n.global_id=i);const s=e.assumed_residence;s!=null&&(n.assumed_residence=s);const a=e.user_residence;return a!=null&&(n.user_residence=a),n}static toObject(e){return this.fromObject(e).toJSON()}}class ke{constructor(e){if(this.is_schema_type=!0,e)for(let n=Object.keys(e),i=0;i<n.length;++i){const s=n[i],a=e[s];a!=null&&e.hasOwnProperty(s)&&(this[s]=a)}}toJSON(){const e={};return this.install_channel!=null&&(e.install_channel=this.install_channel),this.referrer!=null&&(e.referrer=this.referrer),this.referrer_host!=null&&(e.referrer_host=this.referrer_host),e}static fromObject(e){const n=new this,i=e.install_channel;i!=null&&(n.install_channel=i);const s=e.referrer;s!=null&&(n.referrer=s);const a=e.referrer_host;return a!=null&&(n.referrer_host=a),n}static toObject(e){return this.fromObject(e).toJSON()}}var zt;(function(t){t.deeplink="deeplink",t.direct="direct"})(zt||(zt={}));var Yt;(function(t){t.cold_start_to_inactive="cold_start_to_inactive",t.inactive_to_active="inactive_to_active",t.active_to_inactive="active_to_inactive"})(Yt||(Yt={}));class zi{constructor(e){if(this.is_schema_type=!0,e)for(let n=Object.keys(e),i=0;i<n.length;++i){const s=n[i],a=e[s];a!=null&&e.hasOwnProperty(s)&&(this[s]=a)}}toJSON(){const e={};return this.unique_event_id!=null&&(e.unique_event_id=this.unique_event_id),this.event_time!=null&&(e.event_time=this.event_time),this.event_name!=null&&(e.event_name=this.event_name),this.device_time!=null&&(e.device_time=this.device_time),this.spm!=null&&(e.spm=this.spm),this.page_open_id!=null&&(e.page_open_id=this.page_open_id),this.pvid!=null&&(e.pvid=this.pvid),this.from_pvid!=null&&(e.from_pvid=this.from_pvid),this.seq!=null&&(e.seq=this.seq),this.app_open!=null&&(e.app_open=this.app_open),this.navigation_type!=null&&(e.navigation_type=this.navigation_type),this.event_data!=null&&(e.event_data=this.event_data),this.event_data_schema!=null&&(e.event_data_schema=this.event_data_schema),this.page_data!=null&&(e.page_data=this.page_data),this.page_data_schema!=null&&(e.page_data_schema=this.page_data_schema),e}static fromObject(e){const n=new this,i=e.unique_event_id;i!=null&&(n.unique_event_id=i);const s=e.event_time;s!=null&&(n.event_time=s);const a=e.event_name;a!=null&&(n.event_name=a);const r=e.device_time;r!=null&&(n.device_time=r);const l=e.spm;l!=null&&(n.spm=l);const u=e.page_open_id;u!=null&&(n.page_open_id=u);const v=e.pvid;v!=null&&(n.pvid=v);const p=e.from_pvid;p!=null&&(n.from_pvid=p);const f=e.seq;f!=null&&(n.seq=f);const m=e.app_open;m!=null&&(n.app_open=m);const w=e.navigation_type;w!=null&&(n.navigation_type=w);const y=e.event_data;y!=null&&(n.event_data=y);const k=e.event_data_schema;k!=null&&(n.event_data_schema=k);const S=e.page_data;S!=null&&(n.page_data=S);const C=e.page_data_schema;return C!=null&&(n.page_data_schema=C),n}static toObject(e){return this.fromObject(e).toJSON()}}class Yi{constructor(e){if(this.is_schema_type=!0,this.message_schema="com.klook.galileo.BizEventUniversalMessage:1.0.0",e)for(let n=Object.keys(e),i=0;i<n.length;++i){const s=n[i],a=e[s];a!=null&&e.hasOwnProperty(s)&&(this[s]=a)}}toJSON(){const e={};return this.is_debug_mode!=null&&(e.is_debug_mode=this.is_debug_mode),this.log_timestamp!=null&&(e.log_timestamp=this.log_timestamp),this.log_id!=null&&(e.log_id=this.log_id),this.msg!=null&&(e.msg=this.msg),this.log_platform!=null&&(e.log_platform=this.log_platform),this.message_schema!=null&&(e.message_schema=this.message_schema),e}static fromObject(e){const n=new this,i=e.is_debug_mode;i!=null&&(n.is_debug_mode=i);const s=e.log_timestamp;s!=null&&(n.log_timestamp=s);const a=e.log_id;a!=null&&(n.log_id=a);const r=e.msg;if(r!=null){const v=Xi;n.msg=v.fromObject(r).toJSON()}const l=e.log_platform;l!=null&&(n.log_platform=l);const u=e.message_schema;return u!=null&&(n.message_schema=u),n}static toObject(e){return this.fromObject(e).toJSON()}}class Xi{constructor(e){if(this.is_schema_type=!0,this.event_schema="com.klook.galileo.BizEventMessage:1.0.0",e)for(let n=Object.keys(e),i=0;i<n.length;++i){const s=n[i],a=e[s];a!=null&&e.hasOwnProperty(s)&&(this[s]=a)}}toJSON(){const e={};return this.context!=null&&(e.context=this.context),this.user!=null&&(e.user=this.user),this.traffic!=null&&(e.traffic=this.traffic),this.event!=null&&(e.event=this.event),this.event_schema!=null&&(e.event_schema=this.event_schema),e}static fromObject(e){const n=new this,i=e.context;if(i!=null){const u=Ee;n.context=u.fromObject(i).toJSON()}const s=e.user;if(s!=null){const u=Oe;n.user=u.fromObject(s).toJSON()}const a=e.traffic;if(a!=null){const u=ke;n.traffic=u.fromObject(a).toJSON()}const r=e.event;if(r!=null){const u=zi;n.event=u.fromObject(r).toJSON()}const l=e.event_schema;return l!=null&&(n.event_schema=l),n}static toObject(e){return this.fromObject(e).toJSON()}}class Zi{constructor(e){if(this.is_schema_type=!0,e)for(let n=Object.keys(e),i=0;i<n.length;++i){const s=n[i],a=e[s];a!=null&&e.hasOwnProperty(s)&&(this[s]=a)}}toJSON(){const e={};return this.unique_event_id!=null&&(e.unique_event_id=this.unique_event_id),this.event_time!=null&&(e.event_time=this.event_time),this.event_name!=null&&(e.event_name=this.event_name),this.device_time!=null&&(e.device_time=this.device_time),this.spm!=null&&(e.spm=this.spm),this.page_open_id!=null&&(e.page_open_id=this.page_open_id),this.pvid!=null&&(e.pvid=this.pvid),this.from_pvid!=null&&(e.from_pvid=this.from_pvid),this.seq!=null&&(e.seq=this.seq),this.app_open!=null&&(e.app_open=this.app_open),this.navigation_type!=null&&(e.navigation_type=this.navigation_type),this.event_data!=null&&(e.event_data=this.event_data),this.event_data_schema!=null&&(e.event_data_schema=this.event_data_schema),this.component_name!=null&&(e.component_name=this.component_name),this.page_data!=null&&(e.page_data=this.page_data),this.page_data_schema!=null&&(e.page_data_schema=this.page_data_schema),e}static fromObject(e){const n=new this,i=e.unique_event_id;i!=null&&(n.unique_event_id=i);const s=e.event_time;s!=null&&(n.event_time=s);const a=e.event_name;a!=null&&(n.event_name=a);const r=e.device_time;r!=null&&(n.device_time=r);const l=e.spm;l!=null&&(n.spm=l);const u=e.page_open_id;u!=null&&(n.page_open_id=u);const v=e.pvid;v!=null&&(n.pvid=v);const p=e.from_pvid;p!=null&&(n.from_pvid=p);const f=e.seq;f!=null&&(n.seq=f);const m=e.app_open;m!=null&&(n.app_open=m);const w=e.navigation_type;w!=null&&(n.navigation_type=w);const y=e.event_data;y!=null&&(n.event_data=y);const k=e.event_data_schema;k!=null&&(n.event_data_schema=k);const S=e.component_name;S!=null&&(n.component_name=S);const C=e.page_data;C!=null&&(n.page_data=C);const N=e.page_data_schema;return N!=null&&(n.page_data_schema=N),n}static toObject(e){return this.fromObject(e).toJSON()}}class es{constructor(e){if(this.is_schema_type=!0,this.message_schema="com.klook.galileo.ClickUniversalMessage:1.0.0",e)for(let n=Object.keys(e),i=0;i<n.length;++i){const s=n[i],a=e[s];a!=null&&e.hasOwnProperty(s)&&(this[s]=a)}}toJSON(){const e={};return this.is_debug_mode!=null&&(e.is_debug_mode=this.is_debug_mode),this.log_timestamp!=null&&(e.log_timestamp=this.log_timestamp),this.log_id!=null&&(e.log_id=this.log_id),this.msg!=null&&(e.msg=this.msg),this.log_platform!=null&&(e.log_platform=this.log_platform),this.message_schema!=null&&(e.message_schema=this.message_schema),e}static fromObject(e){const n=new this,i=e.is_debug_mode;i!=null&&(n.is_debug_mode=i);const s=e.log_timestamp;s!=null&&(n.log_timestamp=s);const a=e.log_id;a!=null&&(n.log_id=a);const r=e.msg;if(r!=null){const v=ts;n.msg=v.fromObject(r).toJSON()}const l=e.log_platform;l!=null&&(n.log_platform=l);const u=e.message_schema;return u!=null&&(n.message_schema=u),n}static toObject(e){return this.fromObject(e).toJSON()}}class ts{constructor(e){if(this.is_schema_type=!0,this.event_schema="com.klook.galileo.ClickMessage:1.0.0",e)for(let n=Object.keys(e),i=0;i<n.length;++i){const s=n[i],a=e[s];a!=null&&e.hasOwnProperty(s)&&(this[s]=a)}}toJSON(){const e={};return this.context!=null&&(e.context=this.context),this.user!=null&&(e.user=this.user),this.traffic!=null&&(e.traffic=this.traffic),this.event!=null&&(e.event=this.event),this.event_schema!=null&&(e.event_schema=this.event_schema),e}static fromObject(e){const n=new this,i=e.context;if(i!=null){const u=Ee;n.context=u.fromObject(i).toJSON()}const s=e.user;if(s!=null){const u=Oe;n.user=u.fromObject(s).toJSON()}const a=e.traffic;if(a!=null){const u=ke;n.traffic=u.fromObject(a).toJSON()}const r=e.event;if(r!=null){const u=Zi;n.event=u.fromObject(r).toJSON()}const l=e.event_schema;return l!=null&&(n.event_schema=l),n}static toObject(e){return this.fromObject(e).toJSON()}}class ns{constructor(e){if(this.is_schema_type=!0,e)for(let n=Object.keys(e),i=0;i<n.length;++i){const s=n[i],a=e[s];a!=null&&e.hasOwnProperty(s)&&(this[s]=a)}}toJSON(){const e={};return this.unique_event_id!=null&&(e.unique_event_id=this.unique_event_id),this.event_time!=null&&(e.event_time=this.event_time),this.event_name!=null&&(e.event_name=this.event_name),this.device_time!=null&&(e.device_time=this.device_time),this.spm!=null&&(e.spm=this.spm),this.page_open_id!=null&&(e.page_open_id=this.page_open_id),this.pvid!=null&&(e.pvid=this.pvid),this.from_pvid!=null&&(e.from_pvid=this.from_pvid),this.seq!=null&&(e.seq=this.seq),this.app_open!=null&&(e.app_open=this.app_open),this.navigation_type!=null&&(e.navigation_type=this.navigation_type),this.event_data!=null&&(e.event_data=this.event_data),this.event_data_schema!=null&&(e.event_data_schema=this.event_data_schema),this.page_data!=null&&(e.page_data=this.page_data),this.page_data_schema!=null&&(e.page_data_schema=this.page_data_schema),e}static fromObject(e){const n=new this,i=e.unique_event_id;i!=null&&(n.unique_event_id=i);const s=e.event_time;s!=null&&(n.event_time=s);const a=e.event_name;a!=null&&(n.event_name=a);const r=e.device_time;r!=null&&(n.device_time=r);const l=e.spm;l!=null&&(n.spm=l);const u=e.page_open_id;u!=null&&(n.page_open_id=u);const v=e.pvid;v!=null&&(n.pvid=v);const p=e.from_pvid;p!=null&&(n.from_pvid=p);const f=e.seq;f!=null&&(n.seq=f);const m=e.app_open;m!=null&&(n.app_open=m);const w=e.navigation_type;w!=null&&(n.navigation_type=w);const y=e.event_data;y!=null&&(n.event_data=y);const k=e.event_data_schema;k!=null&&(n.event_data_schema=k);const S=e.page_data;S!=null&&(n.page_data=S);const C=e.page_data_schema;return C!=null&&(n.page_data_schema=C),n}static toObject(e){return this.fromObject(e).toJSON()}}class is{constructor(e){if(this.is_schema_type=!0,this.message_schema="com.klook.galileo.ExposureUniversalMessage:1.0.0",e)for(let n=Object.keys(e),i=0;i<n.length;++i){const s=n[i],a=e[s];a!=null&&e.hasOwnProperty(s)&&(this[s]=a)}}toJSON(){const e={};return this.is_debug_mode!=null&&(e.is_debug_mode=this.is_debug_mode),this.log_timestamp!=null&&(e.log_timestamp=this.log_timestamp),this.log_id!=null&&(e.log_id=this.log_id),this.msg!=null&&(e.msg=this.msg),this.log_platform!=null&&(e.log_platform=this.log_platform),this.message_schema!=null&&(e.message_schema=this.message_schema),e}static fromObject(e){const n=new this,i=e.is_debug_mode;i!=null&&(n.is_debug_mode=i);const s=e.log_timestamp;s!=null&&(n.log_timestamp=s);const a=e.log_id;a!=null&&(n.log_id=a);const r=e.msg;if(r!=null){const v=ss;n.msg=v.fromObject(r).toJSON()}const l=e.log_platform;l!=null&&(n.log_platform=l);const u=e.message_schema;return u!=null&&(n.message_schema=u),n}static toObject(e){return this.fromObject(e).toJSON()}}class ss{constructor(e){if(this.is_schema_type=!0,this.event_schema="com.klook.galileo.ExposureMessage:1.0.0",e)for(let n=Object.keys(e),i=0;i<n.length;++i){const s=n[i],a=e[s];a!=null&&e.hasOwnProperty(s)&&(this[s]=a)}}toJSON(){const e={};return this.context!=null&&(e.context=this.context),this.user!=null&&(e.user=this.user),this.traffic!=null&&(e.traffic=this.traffic),this.event!=null&&(e.event=this.event),this.event_schema!=null&&(e.event_schema=this.event_schema),e}static fromObject(e){const n=new this,i=e.context;if(i!=null){const u=Ee;n.context=u.fromObject(i).toJSON()}const s=e.user;if(s!=null){const u=Oe;n.user=u.fromObject(s).toJSON()}const a=e.traffic;if(a!=null){const u=ke;n.traffic=u.fromObject(a).toJSON()}const r=e.event;if(r!=null){const u=ns;n.event=u.fromObject(r).toJSON()}const l=e.event_schema;return l!=null&&(n.event_schema=l),n}static toObject(e){return this.fromObject(e).toJSON()}}var Xt;(function(t){t.close="close",t.hide="hide"})(Xt||(Xt={}));var Zt;(function(t){t.ios="ios",t.android="android",t.desktop="desktop",t.mobile="mobile"})(Zt||(Zt={}));var en;(function(t){t.navigate="navigate",t.reload="reload",t.back_forward="back_forward",t.redirect="redirect",t.other="other",t.prerender="prerender"})(en||(en={}));class as{constructor(e){if(this.is_schema_type=!0,e)for(let n=Object.keys(e),i=0;i<n.length;++i){const s=n[i],a=e[s];a!=null&&e.hasOwnProperty(s)&&(this[s]=a)}}toJSON(){const e={};return this.unique_event_id!=null&&(e.unique_event_id=this.unique_event_id),this.event_time!=null&&(e.event_time=this.event_time),this.event_name!=null&&(e.event_name=this.event_name),this.device_time!=null&&(e.device_time=this.device_time),this.spm!=null&&(e.spm=this.spm),this.page_open_id!=null&&(e.page_open_id=this.page_open_id),this.pvid!=null&&(e.pvid=this.pvid),this.from_pvid!=null&&(e.from_pvid=this.from_pvid),this.seq!=null&&(e.seq=this.seq),this.app_open!=null&&(e.app_open=this.app_open),this.navigation_type!=null&&(e.navigation_type=this.navigation_type),this.page_data!=null&&(e.page_data=this.page_data),this.page_data_schema!=null&&(e.page_data_schema=this.page_data_schema),e}static fromObject(e){const n=new this,i=e.unique_event_id;i!=null&&(n.unique_event_id=i);const s=e.event_time;s!=null&&(n.event_time=s);const a=e.event_name;a!=null&&(n.event_name=a);const r=e.device_time;r!=null&&(n.device_time=r);const l=e.spm;l!=null&&(n.spm=l);const u=e.page_open_id;u!=null&&(n.page_open_id=u);const v=e.pvid;v!=null&&(n.pvid=v);const p=e.from_pvid;p!=null&&(n.from_pvid=p);const f=e.seq;f!=null&&(n.seq=f);const m=e.app_open;m!=null&&(n.app_open=m);const w=e.navigation_type;w!=null&&(n.navigation_type=w);const y=e.page_data;y!=null&&(n.page_data=y);const k=e.page_data_schema;return k!=null&&(n.page_data_schema=k),n}static toObject(e){return this.fromObject(e).toJSON()}}class os{constructor(e){if(this.is_schema_type=!0,this.message_schema="com.klook.galileo.PageLoadUniversalMessage:1.0.0",e)for(let n=Object.keys(e),i=0;i<n.length;++i){const s=n[i],a=e[s];a!=null&&e.hasOwnProperty(s)&&(this[s]=a)}}toJSON(){const e={};return this.is_debug_mode!=null&&(e.is_debug_mode=this.is_debug_mode),this.log_timestamp!=null&&(e.log_timestamp=this.log_timestamp),this.log_id!=null&&(e.log_id=this.log_id),this.msg!=null&&(e.msg=this.msg),this.log_platform!=null&&(e.log_platform=this.log_platform),this.message_schema!=null&&(e.message_schema=this.message_schema),e}static fromObject(e){const n=new this,i=e.is_debug_mode;i!=null&&(n.is_debug_mode=i);const s=e.log_timestamp;s!=null&&(n.log_timestamp=s);const a=e.log_id;a!=null&&(n.log_id=a);const r=e.msg;if(r!=null){const v=rs;n.msg=v.fromObject(r).toJSON()}const l=e.log_platform;l!=null&&(n.log_platform=l);const u=e.message_schema;return u!=null&&(n.message_schema=u),n}static toObject(e){return this.fromObject(e).toJSON()}}class rs{constructor(e){if(this.is_schema_type=!0,this.event_schema="com.klook.galileo.PageLoadMessage:1.0.0",e)for(let n=Object.keys(e),i=0;i<n.length;++i){const s=n[i],a=e[s];a!=null&&e.hasOwnProperty(s)&&(this[s]=a)}}toJSON(){const e={};return this.context!=null&&(e.context=this.context),this.user!=null&&(e.user=this.user),this.traffic!=null&&(e.traffic=this.traffic),this.event!=null&&(e.event=this.event),this.event_schema!=null&&(e.event_schema=this.event_schema),e}static fromObject(e){const n=new this,i=e.context;if(i!=null){const u=Ee;n.context=u.fromObject(i).toJSON()}const s=e.user;if(s!=null){const u=Oe;n.user=u.fromObject(s).toJSON()}const a=e.traffic;if(a!=null){const u=ke;n.traffic=u.fromObject(a).toJSON()}const r=e.event;if(r!=null){const u=as;n.event=u.fromObject(r).toJSON()}const l=e.event_schema;return l!=null&&(n.event_schema=l),n}static toObject(e){return this.fromObject(e).toJSON()}}var tn;(function(t){t.ios="ios",t.android="android",t.desktop="desktop",t.mobile="mobile",t.openharmony_shell="openharmony_shell"})(tn||(tn={}));class ls{constructor(e){if(this.is_schema_type=!0,e)for(let n=Object.keys(e),i=0;i<n.length;++i){const s=n[i],a=e[s];a!=null&&e.hasOwnProperty(s)&&(this[s]=a)}}toJSON(){const e={};return this.unique_event_id!=null&&(e.unique_event_id=this.unique_event_id),this.event_time!=null&&(e.event_time=this.event_time),this.event_name!=null&&(e.event_name=this.event_name),this.device_time!=null&&(e.device_time=this.device_time),this.spm!=null&&(e.spm=this.spm),this.page_open_id!=null&&(e.page_open_id=this.page_open_id),this.pvid!=null&&(e.pvid=this.pvid),this.from_pvid!=null&&(e.from_pvid=this.from_pvid),this.seq!=null&&(e.seq=this.seq),this.app_open!=null&&(e.app_open=this.app_open),this.navigation_type!=null&&(e.navigation_type=this.navigation_type),this.event_data!=null&&(e.event_data=this.event_data),this.event_data_schema!=null&&(e.event_data_schema=this.event_data_schema),this.page_data!=null&&(e.page_data=this.page_data),this.page_data_schema!=null&&(e.page_data_schema=this.page_data_schema),this.popup_open_id!=null&&(e.popup_open_id=this.popup_open_id),e}static fromObject(e){const n=new this,i=e.unique_event_id;i!=null&&(n.unique_event_id=i);const s=e.event_time;s!=null&&(n.event_time=s);const a=e.event_name;a!=null&&(n.event_name=a);const r=e.device_time;r!=null&&(n.device_time=r);const l=e.spm;l!=null&&(n.spm=l);const u=e.page_open_id;u!=null&&(n.page_open_id=u);const v=e.pvid;v!=null&&(n.pvid=v);const p=e.from_pvid;p!=null&&(n.from_pvid=p);const f=e.seq;f!=null&&(n.seq=f);const m=e.app_open;m!=null&&(n.app_open=m);const w=e.navigation_type;w!=null&&(n.navigation_type=w);const y=e.event_data;y!=null&&(n.event_data=y);const k=e.event_data_schema;k!=null&&(n.event_data_schema=k);const S=e.page_data;S!=null&&(n.page_data=S);const C=e.page_data_schema;C!=null&&(n.page_data_schema=C);const N=e.popup_open_id;return N!=null&&(n.popup_open_id=N),n}static toObject(e){return this.fromObject(e).toJSON()}}class cs{constructor(e){if(this.is_schema_type=!0,this.message_schema="com.klook.galileo.PopupLoadUniversalMessage:1.0.0",e)for(let n=Object.keys(e),i=0;i<n.length;++i){const s=n[i],a=e[s];a!=null&&e.hasOwnProperty(s)&&(this[s]=a)}}toJSON(){const e={};return this.is_debug_mode!=null&&(e.is_debug_mode=this.is_debug_mode),this.log_timestamp!=null&&(e.log_timestamp=this.log_timestamp),this.log_id!=null&&(e.log_id=this.log_id),this.msg!=null&&(e.msg=this.msg),this.log_platform!=null&&(e.log_platform=this.log_platform),this.message_schema!=null&&(e.message_schema=this.message_schema),e}static fromObject(e){const n=new this,i=e.is_debug_mode;i!=null&&(n.is_debug_mode=i);const s=e.log_timestamp;s!=null&&(n.log_timestamp=s);const a=e.log_id;a!=null&&(n.log_id=a);const r=e.msg;if(r!=null){const v=us;n.msg=v.fromObject(r).toJSON()}const l=e.log_platform;l!=null&&(n.log_platform=l);const u=e.message_schema;return u!=null&&(n.message_schema=u),n}static toObject(e){return this.fromObject(e).toJSON()}}class us{constructor(e){if(this.is_schema_type=!0,this.event_schema="com.klook.galileo.PopupLoadMessage:1.0.0",e)for(let n=Object.keys(e),i=0;i<n.length;++i){const s=n[i],a=e[s];a!=null&&e.hasOwnProperty(s)&&(this[s]=a)}}toJSON(){const e={};return this.context!=null&&(e.context=this.context),this.user!=null&&(e.user=this.user),this.traffic!=null&&(e.traffic=this.traffic),this.event!=null&&(e.event=this.event),this.event_schema!=null&&(e.event_schema=this.event_schema),e}static fromObject(e){const n=new this,i=e.context;if(i!=null){const u=Ee;n.context=u.fromObject(i).toJSON()}const s=e.user;if(s!=null){const u=Oe;n.user=u.fromObject(s).toJSON()}const a=e.traffic;if(a!=null){const u=ke;n.traffic=u.fromObject(a).toJSON()}const r=e.event;if(r!=null){const u=ls;n.event=u.fromObject(r).toJSON()}const l=e.event_schema;return l!=null&&(n.event_schema=l),n}static toObject(e){return this.fromObject(e).toJSON()}}var nn;(function(t){t.modal="modal",t.bottom_sheet="bottom_sheet",t.popover="popover",t.tooltip="tooltip",t.message_box="message_box",t.notification="notification",t.alert="alert",t.toast="toast",t.drawer="drawer"})(nn||(nn={}));var sn;(function(t){t.webview="webview",t.app="app",t.web="web"})(sn||(sn={}));class hs{constructor(e){if(this.is_schema_type=!0,e)for(let n=Object.keys(e),i=0;i<n.length;++i){const s=n[i],a=e[s];a!=null&&e.hasOwnProperty(s)&&(this[s]=a)}}toJSON(){const e={};return this.unique_event_id!=null&&(e.unique_event_id=this.unique_event_id),this.event_time!=null&&(e.event_time=this.event_time),this.event_name!=null&&(e.event_name=this.event_name),this.device_time!=null&&(e.device_time=this.device_time),this.spm!=null&&(e.spm=this.spm),this.page_open_id!=null&&(e.page_open_id=this.page_open_id),this.pvid!=null&&(e.pvid=this.pvid),this.from_pvid!=null&&(e.from_pvid=this.from_pvid),this.seq!=null&&(e.seq=this.seq),this.app_open!=null&&(e.app_open=this.app_open),this.navigation_type!=null&&(e.navigation_type=this.navigation_type),this.popup_type!=null&&(e.popup_type=this.popup_type),this.popup_style!=null&&(e.popup_style=this.popup_style),this.page_data!=null&&(e.page_data=this.page_data),this.page_data_schema!=null&&(e.page_data_schema=this.page_data_schema),this.popup_open_id!=null&&(e.popup_open_id=this.popup_open_id),e}static fromObject(e){const n=new this,i=e.unique_event_id;i!=null&&(n.unique_event_id=i);const s=e.event_time;s!=null&&(n.event_time=s);const a=e.event_name;a!=null&&(n.event_name=a);const r=e.device_time;r!=null&&(n.device_time=r);const l=e.spm;l!=null&&(n.spm=l);const u=e.page_open_id;u!=null&&(n.page_open_id=u);const v=e.pvid;v!=null&&(n.pvid=v);const p=e.from_pvid;p!=null&&(n.from_pvid=p);const f=e.seq;f!=null&&(n.seq=f);const m=e.app_open;m!=null&&(n.app_open=m);const w=e.navigation_type;w!=null&&(n.navigation_type=w);const y=e.popup_type;y!=null&&(n.popup_type=y);const k=e.popup_style;k!=null&&(n.popup_style=k);const S=e.page_data;S!=null&&(n.page_data=S);const C=e.page_data_schema;C!=null&&(n.page_data_schema=C);const N=e.popup_open_id;return N!=null&&(n.popup_open_id=N),n}static toObject(e){return this.fromObject(e).toJSON()}}class ds{constructor(e){if(this.is_schema_type=!0,this.message_schema="com.klook.galileo.PopupViewUniversalMessage:1.0.0",e)for(let n=Object.keys(e),i=0;i<n.length;++i){const s=n[i],a=e[s];a!=null&&e.hasOwnProperty(s)&&(this[s]=a)}}toJSON(){const e={};return this.is_debug_mode!=null&&(e.is_debug_mode=this.is_debug_mode),this.log_timestamp!=null&&(e.log_timestamp=this.log_timestamp),this.log_id!=null&&(e.log_id=this.log_id),this.msg!=null&&(e.msg=this.msg),this.log_platform!=null&&(e.log_platform=this.log_platform),this.message_schema!=null&&(e.message_schema=this.message_schema),e}static fromObject(e){const n=new this,i=e.is_debug_mode;i!=null&&(n.is_debug_mode=i);const s=e.log_timestamp;s!=null&&(n.log_timestamp=s);const a=e.log_id;a!=null&&(n.log_id=a);const r=e.msg;if(r!=null){const v=fs;n.msg=v.fromObject(r).toJSON()}const l=e.log_platform;l!=null&&(n.log_platform=l);const u=e.message_schema;return u!=null&&(n.message_schema=u),n}static toObject(e){return this.fromObject(e).toJSON()}}class fs{constructor(e){if(this.is_schema_type=!0,this.event_schema="com.klook.galileo.PopupViewMessage:1.1.0",e)for(let n=Object.keys(e),i=0;i<n.length;++i){const s=n[i],a=e[s];a!=null&&e.hasOwnProperty(s)&&(this[s]=a)}}toJSON(){const e={};return this.context!=null&&(e.context=this.context),this.user!=null&&(e.user=this.user),this.traffic!=null&&(e.traffic=this.traffic),this.event!=null&&(e.event=this.event),this.event_schema!=null&&(e.event_schema=this.event_schema),e}static fromObject(e){const n=new this,i=e.context;if(i!=null){const u=Ee;n.context=u.fromObject(i).toJSON()}const s=e.user;if(s!=null){const u=Oe;n.user=u.fromObject(s).toJSON()}const a=e.traffic;if(a!=null){const u=ke;n.traffic=u.fromObject(a).toJSON()}const r=e.event;if(r!=null){const u=hs;n.event=u.fromObject(r).toJSON()}const l=e.event_schema;return l!=null&&(n.event_schema=l),n}static toObject(e){return this.fromObject(e).toJSON()}}var an;(function(t){t.open="open",t.show="show"})(an||(an={}));class gs{constructor(e){if(this.is_schema_type=!0,e)for(let n=Object.keys(e),i=0;i<n.length;++i){const s=n[i],a=e[s];a!=null&&e.hasOwnProperty(s)&&(this[s]=a)}}toJSON(){const e={};return this.unique_event_id!=null&&(e.unique_event_id=this.unique_event_id),this.event_time!=null&&(e.event_time=this.event_time),this.event_name!=null&&(e.event_name=this.event_name),this.device_time!=null&&(e.device_time=this.device_time),this.spm!=null&&(e.spm=this.spm),this.page_open_id!=null&&(e.page_open_id=this.page_open_id),this.pvid!=null&&(e.pvid=this.pvid),this.from_pvid!=null&&(e.from_pvid=this.from_pvid),this.seq!=null&&(e.seq=this.seq),this.event_duration!=null&&(e.event_duration=this.event_duration),this.leave_type!=null&&(e.leave_type=this.leave_type),this.viewport_height!=null&&(e.viewport_height=this.viewport_height),this.viewport_position!=null&&(e.viewport_position=this.viewport_position),this.viewport_width!=null&&(e.viewport_width=this.viewport_width),this.navigation_type!=null&&(e.navigation_type=this.navigation_type),this.page_data!=null&&(e.page_data=this.page_data),this.page_data_schema!=null&&(e.page_data_schema=this.page_data_schema),e}static fromObject(e){const n=new this,i=e.unique_event_id;i!=null&&(n.unique_event_id=i);const s=e.event_time;s!=null&&(n.event_time=s);const a=e.event_name;a!=null&&(n.event_name=a);const r=e.device_time;r!=null&&(n.device_time=r);const l=e.spm;l!=null&&(n.spm=l);const u=e.page_open_id;u!=null&&(n.page_open_id=u);const v=e.pvid;v!=null&&(n.pvid=v);const p=e.from_pvid;p!=null&&(n.from_pvid=p);const f=e.seq;f!=null&&(n.seq=f);const m=e.event_duration;m!=null&&(n.event_duration=m);const w=e.leave_type;w!=null&&(n.leave_type=w);const y=e.viewport_height;y!=null&&(n.viewport_height=y);const k=e.viewport_position;k!=null&&(n.viewport_position=k);const S=e.viewport_width;S!=null&&(n.viewport_width=S);const C=e.navigation_type;C!=null&&(n.navigation_type=C);const N=e.page_data;N!=null&&(n.page_data=N);const Z=e.page_data_schema;return Z!=null&&(n.page_data_schema=Z),n}static toObject(e){return this.fromObject(e).toJSON()}}class _s{constructor(e){if(this.is_schema_type=!0,this.message_schema="com.klook.galileo.WebPageLeaveUniversalMessage:1.0.0",e)for(let n=Object.keys(e),i=0;i<n.length;++i){const s=n[i],a=e[s];a!=null&&e.hasOwnProperty(s)&&(this[s]=a)}}toJSON(){const e={};return this.is_debug_mode!=null&&(e.is_debug_mode=this.is_debug_mode),this.log_timestamp!=null&&(e.log_timestamp=this.log_timestamp),this.log_id!=null&&(e.log_id=this.log_id),this.msg!=null&&(e.msg=this.msg),this.log_platform!=null&&(e.log_platform=this.log_platform),this.message_schema!=null&&(e.message_schema=this.message_schema),e}static fromObject(e){const n=new this,i=e.is_debug_mode;i!=null&&(n.is_debug_mode=i);const s=e.log_timestamp;s!=null&&(n.log_timestamp=s);const a=e.log_id;a!=null&&(n.log_id=a);const r=e.msg;if(r!=null){const v=vs;n.msg=v.fromObject(r).toJSON()}const l=e.log_platform;l!=null&&(n.log_platform=l);const u=e.message_schema;return u!=null&&(n.message_schema=u),n}static toObject(e){return this.fromObject(e).toJSON()}}class vs{constructor(e){if(this.is_schema_type=!0,this.event_schema="com.klook.galileo.WebPageLeaveMessage:1.1.0",e)for(let n=Object.keys(e),i=0;i<n.length;++i){const s=n[i],a=e[s];a!=null&&e.hasOwnProperty(s)&&(this[s]=a)}}toJSON(){const e={};return this.context!=null&&(e.context=this.context),this.user!=null&&(e.user=this.user),this.traffic!=null&&(e.traffic=this.traffic),this.event!=null&&(e.event=this.event),this.event_schema!=null&&(e.event_schema=this.event_schema),e}static fromObject(e){const n=new this,i=e.context;if(i!=null){const u=Ee;n.context=u.fromObject(i).toJSON()}const s=e.user;if(s!=null){const u=Oe;n.user=u.fromObject(s).toJSON()}const a=e.traffic;if(a!=null){const u=ke;n.traffic=u.fromObject(a).toJSON()}const r=e.event;if(r!=null){const u=gs;n.event=u.fromObject(r).toJSON()}const l=e.event_schema;return l!=null&&(n.event_schema=l),n}static toObject(e){return this.fromObject(e).toJSON()}}class ms{constructor(e){if(this.is_schema_type=!0,e)for(let n=Object.keys(e),i=0;i<n.length;++i){const s=n[i],a=e[s];a!=null&&e.hasOwnProperty(s)&&(this[s]=a)}}toJSON(){const e={};return this.unique_event_id!=null&&(e.unique_event_id=this.unique_event_id),this.event_time!=null&&(e.event_time=this.event_time),this.event_name!=null&&(e.event_name=this.event_name),this.device_time!=null&&(e.device_time=this.device_time),this.spm!=null&&(e.spm=this.spm),this.page_open_id!=null&&(e.page_open_id=this.page_open_id),this.pvid!=null&&(e.pvid=this.pvid),this.from_pvid!=null&&(e.from_pvid=this.from_pvid),this.seq!=null&&(e.seq=this.seq),this.view_type!=null&&(e.view_type=this.view_type),this.navigation_type!=null&&(e.navigation_type=this.navigation_type),this.page_data!=null&&(e.page_data=this.page_data),this.page_data_schema!=null&&(e.page_data_schema=this.page_data_schema),e}static fromObject(e){const n=new this,i=e.unique_event_id;i!=null&&(n.unique_event_id=i);const s=e.event_time;s!=null&&(n.event_time=s);const a=e.event_name;a!=null&&(n.event_name=a);const r=e.device_time;r!=null&&(n.device_time=r);const l=e.spm;l!=null&&(n.spm=l);const u=e.page_open_id;u!=null&&(n.page_open_id=u);const v=e.pvid;v!=null&&(n.pvid=v);const p=e.from_pvid;p!=null&&(n.from_pvid=p);const f=e.seq;f!=null&&(n.seq=f);const m=e.view_type;m!=null&&(n.view_type=m);const w=e.navigation_type;w!=null&&(n.navigation_type=w);const y=e.page_data;y!=null&&(n.page_data=y);const k=e.page_data_schema;return k!=null&&(n.page_data_schema=k),n}static toObject(e){return this.fromObject(e).toJSON()}}class ps{constructor(e){if(this.is_schema_type=!0,this.message_schema="com.klook.galileo.WebPageViewUniversalMessage:1.0.0",e)for(let n=Object.keys(e),i=0;i<n.length;++i){const s=n[i],a=e[s];a!=null&&e.hasOwnProperty(s)&&(this[s]=a)}}toJSON(){const e={};return this.is_debug_mode!=null&&(e.is_debug_mode=this.is_debug_mode),this.log_timestamp!=null&&(e.log_timestamp=this.log_timestamp),this.log_id!=null&&(e.log_id=this.log_id),this.msg!=null&&(e.msg=this.msg),this.log_platform!=null&&(e.log_platform=this.log_platform),this.message_schema!=null&&(e.message_schema=this.message_schema),e}static fromObject(e){const n=new this,i=e.is_debug_mode;i!=null&&(n.is_debug_mode=i);const s=e.log_timestamp;s!=null&&(n.log_timestamp=s);const a=e.log_id;a!=null&&(n.log_id=a);const r=e.msg;if(r!=null){const v=ys;n.msg=v.fromObject(r).toJSON()}const l=e.log_platform;l!=null&&(n.log_platform=l);const u=e.message_schema;return u!=null&&(n.message_schema=u),n}static toObject(e){return this.fromObject(e).toJSON()}}class ys{constructor(e){if(this.is_schema_type=!0,this.event_schema="com.klook.galileo.WebPageViewMessage:1.1.0",e)for(let n=Object.keys(e),i=0;i<n.length;++i){const s=n[i],a=e[s];a!=null&&e.hasOwnProperty(s)&&(this[s]=a)}}toJSON(){const e={};return this.context!=null&&(e.context=this.context),this.user!=null&&(e.user=this.user),this.traffic!=null&&(e.traffic=this.traffic),this.event!=null&&(e.event=this.event),this.event_schema!=null&&(e.event_schema=this.event_schema),e}static fromObject(e){const n=new this,i=e.context;if(i!=null){const u=Ee;n.context=u.fromObject(i).toJSON()}const s=e.user;if(s!=null){const u=Oe;n.user=u.fromObject(s).toJSON()}const a=e.traffic;if(a!=null){const u=ke;n.traffic=u.fromObject(a).toJSON()}const r=e.event;if(r!=null){const u=ms;n.event=u.fromObject(r).toJSON()}const l=e.event_schema;return l!=null&&(n.event_schema=l),n}static toObject(e){return this.fromObject(e).toJSON()}}var on;(function(t){t.input="input",t.slide="slide"})(on||(on={}));var rn;(function(t){t.refunded="refunded",t.processing="processing",t.refund_failed="refund_failed"})(rn||(rn={})),window.callbackIds=new Map,window.registerIds=new Map,window.idsTimeOut={};var Ie={default:void 0,call:function(t,e,n,i){const s=String(new Date().valueOf());let a={method:t,callbackId:s,args:e,callTimeOut:i||-1},r={};if(Object.prototype.toString.call(n)==="[object Object]"&&Object.keys(n).length>0)for(let u in n)typeof n[u]=="function"&&(r[u]=n[u]);const l=JSON.stringify(a);return new Promise((u,v)=>{if(window.callbackIds.set(s,{finish:{resolve:u,reject:v},cbs:r}),window&&window.webkit&&window.webkit.messageHandlers&&window.webkit.messageHandlers._klookJSBridge)window.webkit.messageHandlers._klookJSBridge.postMessage({method:"call",args:l}),this.setJSbridgeTimeOut(s,i);else if(window&&window._klookJSBridge)typeof window._klookJSBridge.call=="function"?window._klookJSBridge.call(l):typeof window._klookJSBridge.postMessage=="function"?window._klookJSBridge.postMessage(JSON.stringify({method:"call",args:l})):console.error("[Klook jsBridge]: not support call"),this.setJSbridgeTimeOut(s,i);else{const f=JSON.stringify({callbackId:s,data:{success:!1,type:"finish",error:{msg:"NotImplemented",code:"5001"}}});window.handleNativeResult(f)}})},setResultToNative:function(t){window&&window.webkit&&window.webkit.messageHandlers&&window.webkit.messageHandlers._klookJSBridge?window.webkit.messageHandlers._klookJSBridge.postMessage({method:"setResultToNative",args:JSON.stringify(t)}):window&&window._klookJSBridge&&window._klookJSBridge.setResultToNative(JSON.stringify(t))},setJSbridgeTimeOut:function(t,e){if(typeof e!="number"||e===-1)return;const n={callbackId:t,data:{type:"finish",success:!1,error:{code:5002,msg:"TimeOut"}}};window.idsTimeOut[t]=setTimeout(()=>{const i=JSON.stringify(n);window.handleNativeResult(i)},e)},clearJSbridgeTimeOut:function(t){window.idsTimeOut[t]&&(clearTimeout(window.idsTimeOut[t]),delete window.idsTimeOut[t])},register:function(t,e){window._klookJSBridgeInit||(window._klookJSBridgeInit=!0,setTimeout(function(){Ie.call("klookJSBridge.bridgeReady",{},{},5e3).catch(n=>{})},0)),typeof e=="function"&&window.registerIds.set(t,e)}};(function(){if(!window._klookJSBridgeInit){var t={KlookJSBridge:Ie,handleNativeResult:function(e){const n=JSON.parse(e),i=n.callbackId,s=n.data,a=s.type;if(i&&window.callbackIds.has(i)){Ie.clearJSbridgeTimeOut(i);const r=window.callbackIds.get(i);if(a==="finish")return window.callbackIds.delete(i),s.success?r.finish.resolve(s.result||{}):r.finish.reject(s.error||{});r.cbs[a]&&r.cbs[a](s.result)}},nativeCallJS:function(e){const n=JSON.parse(e);let i={callbackId:n.callbackId};window.registerIds.has(n.method)?window.registerIds.get(n.method)(n.args||{}).then(a=>{i.data={result:a,success:!0},Ie.setResultToNative(i)}).catch(a=>{i.data={success:!1,error:a},Ie.setResultToNative(i)}):(i.data={success:!1,error:{code:5001,msg:"NotImplemented"}},Ie.setResultToNative(i))}};for(let e in t)window[e]=t[e];window._klookJSBridgeInit=!0,setTimeout(function(){Ie.call("klookJSBridge.bridgeReady",{},{},5e3).catch(e=>{})},0)}})();var bs=Object.defineProperty,ws=(t,e,n)=>e in t?bs(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,R=(t,e,n)=>ws(t,typeof e!="symbol"?e+"":e,n),Ss="_galileo_set",ln="send_data",Es="onHandle",Os="onCreate",ks="onBeforeHandle",Is="onRequest",Ps="onBeforeRequest",xs="onComplete",tt="galileo_l_d",Cs=class extends fe{constructor(){super(...arguments),R(this,"_seq_id",1),R(this,"name","senderQueue"),R(this,"urlEventNameMapping",new Map),R(this,"processingQueue",new Map),R(this,"successSet",new Set),R(this,"delayQueue",[]),R(this,"_timer",null),R(this,"url",""),R(this,"_pageStatus",[]),R(this,"penddingIdSet",new Set)}onInit(){this.app.senderQueue=this,this.initTimer();const t=this.app.configManager.get("url"),e=Ne(t)?{default:t}:t;if(!e)throw new Error("url config is required");this.urlEventNameMapping=new Map(Object.entries(e)),this.url=this.urlEventNameMapping.get("default"),this.initRequestInterceptor()}onReady(){this.loadSyncData()}onNetworkOnline(){this.flush()}onRequest(t){const e=t.get(ln);if(!e)return;const{data:n,config:i}=e;this.send(n,i)}send(t,e){return this.enqueue(t,de(L({},e),{uid:this.getSeqId(),type:"new",retry:0}))}loadSyncData(){try{const t=this.app.storage.syncStorage.getJson(tt);t!=null&&t.length&&(this.enDelayQueue(t),this.app.storage.syncStorage.delete(tt))}catch(t){console.error("get local data error",t)}}getSeqId(){return`${this.app.getUuid().slice(-12)||Date.now()}_${this._seq_id++}`}getDeviceId(){return this.app.runHookSync("onGetDeviceId",null,e=>!!e)}getPlatform(){const t="mobile",e="desktop",n=mt()||De()?t:e,i=this.app.configManager.get("platform")||n;return[t,e].includes(i)?i:n}getOnlineStatus(){return this.app.galileoHost.getOnlineStatus()}pageMayLeave(){const t=document.hidden,e=document.visibilityState==="hidden",n=t===!0||e;return this.app.logger.debug("pageWillUnload",t,e,n),this.app.nativeEvent.isPageLeave()||n}pageWillUnload(t){this.app.logger.debug("pageWillUnload",t),(this.pageMayLeave()||(t==null?void 0:t.event_name)==="unload")&&(this.flush({beacon:!0}),this.cacheToLocal())}deduplicateArraysByKey(t,e){const n={};return t.concat(e).filter(s=>{var l;if(!s)return!1;const a=(l=s.opt)==null?void 0:l.uid,r=this.getPayloadUniqueKey(s);return r&&this.successSet.has(r)?!1:a?n[a]?!1:(n[a]=!0,!0):!0})}cacheToLocal(){const{app:t}=this;let e=this.getUnhandleQueue(),n=[];try{n=t.storage.syncStorage.getJson(tt)||[],n=Array.isArray(n)?n:[],e=this.deduplicateArraysByKey(e,n)}catch(i){t.logger.error("get local data error",i)}t.logger.debug("Save data to local: ",e),e=e.filter(i=>!!i),e.length&&t.storage.syncStorage.set(tt,JSON.stringify(e))}checkLastPageStatus(){this.pageMayLeave()&&(this.flush({beacon:!0}),this.cacheToLocal())}getQueueConfig(){return L({duration:1e3,max:5,concurrent:4,maxLength:50},this.app.configManager.get("queue"))}initTimer(){this._timer&&clearInterval(this._timer);const{duration:t=1e3}=this.getQueueConfig();this._timer=setInterval(()=>{this.flush()},t)}loadCacheData(t){return K(this,null,function*(){const{max:e}=this.getQueueConfig();(t==null?void 0:t.type)==="empty"&&this.loadSyncData(),this.delayQueue.length<e*2&&(yield this.loadAsyncData())})}loadAsyncData(){return K(this,null,function*(){const{app:t}=this,{max:e}=this.getQueueConfig(),n=yield t.storage.asyncStorage.getListAsync({limit:(e||5)*2}).catch(i=>(console.error("getListAsync err",i),[]));if(n!=null&&n.length){const i=n.reduce((s,a)=>s.concat(a.value||[]),[]);this.enDelayQueue(i);for(const s of n)yield t.storage.asyncStorage.delete(s.key)}})}initRequestInterceptor(){const{max:t}=this.getQueueConfig();this.app.request.interceptor(e=>K(this,null,function*(){this.delayQueue.length<t*3&&(yield this.loadCacheData())}))}enDelayQueue(t){this.delayQueue=this.delayQueue.concat(t)}enqueue(t,e){const n={payload:t,opt:e},i=this.getQueueConfig();if(!this.getOnlineStatus()||this.delayQueue.length>i.maxLength){const s=this.getSeqId();this.app.storage.asyncStorage.setAsync(s,n).then(a=>{a||this.delayQueue.push(n)});return}this.delayQueue.push(n),this.delayQueue.length>=i.max&&setTimeout(()=>this.flush()),e.eventType==="$Click"&&this.flush({beacon:!0}),this.checkLastPageStatus()}getUnhandleQueue(){const t=Array.from(this.processingQueue).map(([,n])=>n).reduce((n,i)=>(Array.isArray(n)?n:[n]).concat(i),[]);return this.delayQueue.concat(t)}getPayloadUniqueKey(t){var i,s,a;const e=((i=t.opt)==null?void 0:i.uid)||"",n=((a=(s=t.opt)==null?void 0:s.query)==null?void 0:a.log_id)||"";return`${e}${n}`}flush(t={}){const{beacon:e=!1}=t,{concurrent:n}=this.getQueueConfig(),i=this.app.galileoHost.getOnlineStatus();if(this.processingQueue.size>=n||!i)return;const{sendList:s,url:a}=this.prepareSendData(),r=s.filter(S=>{const C=this.getPayloadUniqueKey(S);return C&&(this.penddingIdSet.has(C)||this.successSet.has(C))?!1:!!S.payload});if(r.length&&r.forEach(S=>{const C=this.getPayloadUniqueKey(S);C&&this.penddingIdSet.add(C)}),!r.length){this.loadCacheData({type:"empty"});return}const l=this.getSeqId();this.processingQueue.set(l,r);const u=this.getPlatform(),v=this.getDeviceId(),p=a||this.url,f=String(r.length),m=[];r.forEach(S=>{var N,Z;const C=(Z=(N=S.opt)==null?void 0:N.query)==null?void 0:Z.log_id;C&&m.push(C)});const w=m.join("-"),y={size:f,log_ids:w,device_id:v,platform:u};this.app.logger.debug("Flush url: ",p,e),this.app.logger.debug("Flush data: ",r);const k=Date.now();this.app.request.post(p,{logs:r.map(S=>S.payload)},{query:y,usingBeacon:e}).then(S=>{this.app.logger.debug("Flush success: ",p,S),this.processingQueue.delete(l),r.forEach(C=>{const N=this.getPayloadUniqueKey(C);N&&(this.successSet.add(N),this.penddingIdSet.delete(N))})}).catch(S=>{r.forEach(B=>{const O=this.getPayloadUniqueKey(B);O&&this.penddingIdSet.delete(O)});const C=S==null?void 0:S.errcode;if(this.app.logger.error("Flush error: ",p,S),this.sendDebugData({type:"galileo_flush_error",duration:Date.now()-k,error:`${S.name}: ${S.message}: ${S.code}: ${S.stack}`,log_id_str:w,errcode:C}),C&&C!=="-1000")return;let N=r;const Z=navigator.userAgent||"";/(SamsungBrowser)/i.test(Z)&&(N=N.filter(B=>{var A;return(((A=B.opt)==null?void 0:A.retry)||0)<10}),N=N.map(B=>{var O;if(B.opt){const A=((O=B.opt)==null?void 0:O.retry)||0;B.opt.retry=A+1}return B})),this.enDelayQueue(N),this.processingQueue.delete(l)})}prepareSendData(){var p,f;const{max:t}=this.getQueueConfig(),e=this.delayQueue,n=[],i=e.shift(),s=(p=i==null?void 0:i.opt)==null?void 0:p.eventType,a=this.urlEventNameMapping.has(s),r=this.urlEventNameMapping.get("default"),l=this.urlEventNameMapping.get(s)||r;if(!i)return{sendList:[],url:""};n.push(i);let u=-1;const v=t*3;for(;t>n.length&&u<v&&e.length;){u++;const m=e[u];if(!m)continue;const w=(f=m.opt)==null?void 0:f.eventType;a?s===w&&(n.push(...Array.isArray(m)?m:[m]),e.splice(u--,1)):(!w||!this.urlEventNameMapping.get(w))&&(n.push(...Array.isArray(m)?m:[m]),e.splice(u--,1))}return{sendList:n,url:l}}sendDebugData(t){var e,n;(n=(e=this.app).sendDebugData)==null||n.call(e,t)}},Ns="device_id",Ds="kepler_id",ge="unknown",Ls=class{constructor(t=""){this._userAgent=t,R(this,"getAppOs",()=>ye()?mt()?"android":this.isiOS()?"ios":this.isHosShell()?"openharmony-shell":this.isHos()?"openharmony":"":"")}isHos(){return/OpenHarmony/i.test(this._userAgent)}isHosShell(){return this.isHos()&&/ohos-shell/i.test(this._userAgent)}isiOS(){return De(this._userAgent)}getOS(t){const e=t||this._userAgent;return/Windows/i.test(e)?/Phone/.test(e)||/WPDesktop/.test(e)?"Windows Phone":"Windows":/(iPhone|iPad|iPod)/.test(e)?"iOS":this.isHos()?"OpenHarmony":/Android/i.test(e)?"Android":/(BlackBerry|PlayBook|BB10)/i.test(e)?"BlackBerry":/Mac/i.test(e)?"Mac OS X":/Linux/.test(e)?"Linux":/CrOS/.test(e)?"Chrome OS":""}getOsVersion(t){var s;const e=t||this._userAgent,n=this.getOS(),i=[{reg:"Android",version:/android\s([0-9.]*)/i},{reg:"iOS",version:/OS\s(\d[_0-9]*)/i},{reg:"Mac OS X",version:/Mac OS X\s(\d[_0-9]*)/i},{reg:"Windows",version:/NT\s(\d[.\d]*)/i},{reg:"Chrome OS",version:/CrOS\sx86_64\s(\d[.\d]*)/i},{reg:"OpenHarmony",version:/OpenHarmony\s(\d[.\d]*)/i}];for(const a of i)if(a.reg===n){const l=(s=a.version)==null?void 0:s.exec(e);if(l!=null&&l[1])return l[1]}return""}getBrowser(t){const{userAgent:e,vendor:n,opera:i}=t||{},s=e||this._userAgent,a=n||"";return i||s.includes(" OPR/")?s.includes("Mini")?"Opera Mini":"Opera":/(BlackBerry|PlayBook|BB10)/i.test(s)?"BlackBerry":s.includes("IEMobile")||s.includes("WPDesktop")?"Internet Explorer Mobile":s.includes("SamsungBrowser/")?"Samsung Internet":s.includes("Edge")||s.includes("Edg/")?"Microsoft Edge":/HuaweiBrowser/i.test(s)?"HuaweiBrowser":s.includes("FBIOS")?"Facebook Mobile":s.includes("Chrome")?"Chrome":s.includes("CriOS")?"Chrome iOS":s.includes("UCWEB")||s.includes("UCBrowser")?"UC Browser":s.includes("FxiOS")?"Firefox iOS":a.includes("Apple")?s.includes("Mobile")?"Mobile Safari":"Safari":s.includes("Android")?"Android Mobile":s.includes("Konqueror")?"Konqueror":s.includes("Firefox")?"Firefox":s.includes("MSIE")||s.includes("Trident/")?"Internet Explorer":s.includes("Gecko")?"Mozilla":""}getBrowserVersion(t){const{userAgent:e,vendor:n,opera:i}=t||{},s=e||this._userAgent,a=n||"",r=this.getBrowser({userAgent:s,vendor:a,opera:i}),u={"Internet Explorer Mobile":/rv:(\d+(\.\d+)?)/,"Microsoft Edge":/Edge?\/(\d+(\.\d+)?)/,Chrome:/Chrome\/(\d+(\.\d+)?)/,"Chrome iOS":/CriOS\/(\d+(\.\d+)?)/,"UC Browser":/(UCBrowser|UCWEB)\/(\d+(\.\d+)?)/,Safari:/Version\/(\d+(\.\d+)?)/,"Mobile Safari":/Version\/(\d+(\.\d+)?)/,Opera:/(Opera|OPR)\/(\d+(\.\d+)?)/,"Opera Mini":/Opera Mini\/(\d+(\.\d+)?)/,Firefox:/Firefox\/(\d+(\.\d+)?)/,"Firefox iOS":/FxiOS\/(\d+(\.\d+)?)/,Konqueror:/Konqueror:(\d+(\.\d+)?)/,BlackBerry:/BlackBerry (\d+(\.\d+)?)/,"Android Mobile":/android\s(\d+(\.\d+)?)/,"Samsung Internet":/SamsungBrowser\/(\d+(\.\d+)?)/,"Internet Explorer":/(rv:|MSIE )(\d+(\.\d+)?)/,Mozilla:/rv:(\d+(\.\d+)?)/,HuaweiBrowser:/HuaweiBrowser\/(\d[.\d]*)/}[r];if(u===void 0)return null;const v=s.match(u);return v?v[v.length-2]:null}},Ts=class extends fe{constructor(){super(...arguments),R(this,"name","contextManager"),R(this,"currentContext",{}),R(this,"historyContext",[]),R(this,"lut",-1)}onInit(){this.app.contextManager=this,this.getNewContext()}getLut(){return this.lut}onLutChange({payload:t}){return this.lut=t,this.lut}setHistoryContext(t){this.historyContext.length>=10&&this.historyContext.shift(),this.historyContext.push(t)}getNewContext(){return this.currentContext=L(L({},this.getStaticContext(!0)),this.getDynamic()),this.setHistoryContext(this.currentContext),this.getCurrentContext()}getCurrentContext(){return L({},this.currentContext)}onGetDeviceId(){return this.getDeviceId()}getDeviceId(){const{configManager:t}=this.app;return t.get(Ns)||this.app.cookie.get(Ds)||""}getStaticContext(t){const{galileoHost:e,configManager:n}=this.app,i=t?e.getNewHost():e==null?void 0:e.getHost(),s=i.userAgent||"",a=i.cookie||"",r=new Ls(s);return{lib_version:this.app.version||ge,device_id:this.getDeviceId(),platform:r.getAppOs()||n.get("platform")||ge,user_agent:s||ge,os:i.os||r.getOS()||ge,os_version:i.os_version||r.getOsVersion()||ge,screen_height:i.screen.height,screen_width:i.screen.width,device_language:i.language||ge,lut:Number(this.lut)||-1,ck:`ce:${i.cookieEnable};cl:${a.length};lss:${i.supportLocalStorage}`,browser:r.getBrowser({vendor:i.vendor})||ge,browser_version:r.getBrowserVersion({vendor:i.vendor})||ge,url_path:i.pathname,current_url:i.url,domain:i.domain,site_name:n.get("site_name")||ge}}getDynamic(){const{configManager:t}=this.app;return{currency:t.get("currency")||ge,language:t.get("language")||ge,site_name:t.get("site_name")||ge}}onUpdateNewContext(){this.refreshContext()}refreshContext(){this.getNewContext()}},As=class{constructor(){R(this,"state",{userAgent:"",cookie:"",screen:{width:0,height:0},viewport:{width:0,height:0},viewport_position:{top:0,left:0},language:"",referrer:"",url:"",vendor:"",domain:"",navigationType:"",cookieEnable:!1,os:"",os_version:"",pathname:"",supportLocalStorage:!0}),this.init()}ready(){}getHost(){return L({},this.state)}getNewHost(){return L({},this.getState())}getState(){return this.state}getOnlineStatus(){const t=navigator==null?void 0:navigator.onLine;return typeof t=="boolean"?t:!0}},Rs=class extends As{ready(){return K(this,null,function*(){})}init(){this.getState()}getState(){try{const t={userAgent:navigator.userAgent,cookie:document.cookie,screen:{width:window.screen.width,height:window.screen.height},viewport:{width:window.innerWidth,height:window.innerHeight},viewport_position:{top:window.scrollY||window.pageYOffset,left:window.scrollX||window.pageXOffset},language:navigator.language,referrer:document.referrer,url:window.location.href,pathname:window.location.pathname,vendor:navigator.vendor,domain:location.host,cookieEnable:navigator.cookieEnabled,navigationType:this.getNavigationType(),supportLocalStorage:fi()};Object.assign(this.state,t),this.detectOS()}catch(t){console.error("Get Host error",t)}return this.state}getNavigationType(){var i,s;let t="unknown";const e=["unknown","navigate","reload","redirect","back_forward","prerender","other"];let n=!1;if(performance&&performance.getEntriesByType&&(t=(((s=(i=performance.getEntriesByType)==null?void 0:i.call(performance,"navigation"))==null?void 0:s[0])||{}).type,ne(t)||(n=!0)),!n&&performance&&performance.navigation&&typeof performance.navigation.type!="undefined"){const{type:a,redirectCount:r}=performance.navigation;t={0:"navigate",1:"reload",2:"back_forward"}[a]||t,a===0&&r>0&&(t="redirect"),t==="unknown"&&(t=String(a))}return e.includes(t)?t:"other"}detectOS(){var e;const t=navigator.userAgentData;t&&(this.state.os=t.platform||"",(e=t.getHighEntropyValues)==null||e.call(t,["platformVersion"]).then(n=>{n.platformVersion&&(this.state.os_version=n.platformVersion)}))}},Bs=class extends fe{constructor(){super(...arguments),R(this,"name","galileoHost"),R(this,"host")}onInit(){this.host=new Rs,this.app.galileoHost=this}getHost(){return this.host.getHost()}onUpdateNewHost(){return this.getNewHost()}getNewHost(){return this.host.getNewHost()}getOnlineStatus(){return this.host.getOnlineStatus()}},X="unknown",Ms=1e9,cn="gl_a_d_a",bt="shared_page_data",wt=t=>/^\d+$/.test(t);function js(t,e){const n=e.split(".");if(n.length===0)return null;let i=t;for(let s=0;s<n.length;s++){const a=n[s];if(i=i[a],!i)return null}return i}var qs=()=>class extends Wt{constructor(){super(...arguments),R(this,"event_version","1.0.0"),R(this,"event_version_prefix","com.klook.galileo.web.")}collectLogger(){this.logger=de(L({},this.logger),{log_id:this.app.getLogIdUid(),log_timestamp:Date.now(),is_debug_mode:!!this.app.isDebugMode(),log_platform:this.app.configManager.get("platform")||X})}collectTraffic(){const{galileoHost:t}=this.app,n=t.getHost().referrer;this.setTraffic({referrer:n||X,referrer_host:n?new URL(n).host:X})}collectContext(){const{contextManager:t}=this.app,e=t.getCurrentContext();this.setContext(de(L({},e),{srv_client_time_diff:this.app.timeDiff||0,device_id:e.device_id||X}))}collectUser(){const{configManager:t}=this.app,e=t.get("user");this.setUser({assumed_residence:(e==null?void 0:e.assumed_residence)||X,user_residence:(e==null?void 0:e.user_residence)||X,global_id:(e==null?void 0:e.global_id)||X})}get(t){return js(this,t)}collectCommonEvent(){const{event_data:t,event_name:e,event_version:n,event_version_prefix:i}=this,s=this.app.galileoHost.getHost(),r=`${e.replace(/^[$@_]/,"")}`,l=t.timestamp||Date.now(),u={seq:this.app.getSeq(),pvid:this.app.getPvid(),from_pvid:this.app.getFromPvid(),event_name:this.event_name,event_time:l,device_time:l,unique_event_id:this.app.getUuid(),spm:t.spm||X,page_open_id:this.app.getPageOpenId(),navigation_type:s.navigationType||X,event_schema:`${i}${r}:${n}`};this.setEvent(u)}beforeCollect(){}afterCollect(){}collect(){this.beforeCollect(),this.collectLogger(),this.collectTraffic(),this.collectContext(),this.collectUser(),this.collectCommonEvent(),this.afterCollect()}serialize(){const t=super.serialize(),e=this.app.getSchema(this.event_name);if(!e)throw new Error(`Schema ${this.event_name} is not found!`);const n=e==null?void 0:e.fromObject(t);if(n!=null&&n.is_schema_type)return n.toJSON();throw new Error(`Schema ${this.event_name} is not valid`)}},je=qs(),Us=class extends je{constructor(t){super(t),R(this,"event_name",W.Pageview),R(this,"event",{})}beforeCollect(){const{event_data:t}=this,e={view_type:t.view_type||X};this.setEvent(e)}},Js=class extends je{constructor(t){super(t),R(this,"event_name",W.Pageleave),R(this,"event",{})}beforeCollect(){const t=this.app.galileoHost.getNewHost(),e=t.viewport_position.top,n=Me(e)?X:e,i=this.app.pageview_start||this.app.getStartTime(),s={leave_type:this.event_data.leave_type,viewport_height:t.viewport.height,viewport_width:t.viewport.width,viewport_position:`${n}`,event_duration:Date.now()-i};this.setEvent(s)}},un=class extends je{constructor(t){super(t),R(this,"event_name",W.Click),R(this,"event",{})}afterCollect(){var s;const{event_data:t}=this,e=Ne(t.event_data)?t.event_data:ci(t.event_data||{});let n=t.spm||X;t.forward||(n=`${((s=this.app.dataStream.sharedConfig.latestPageview)==null?void 0:s.get("event.spm"))||X}.${n}`);const i={spm:n,component_name:t.component_name||X,event_data_schema:t.event_data_schema||X,event_data:e};this.setEvent(i)}};R(un,"event_name",W.Click);var hn=class extends je{constructor(t){super(t),R(this,"event_name",W.PopupView),R(this,"event",{})}afterCollect(){var s;const{event_data:t}=this;let e=t.spm||X;e=`${((s=this.app.dataStream.sharedConfig.latestPageview)==null?void 0:s.get("event.spm"))||X}.${e}`;const i={spm:e,popup_type:t.popup_type||X,popup_style:t.popup_style||X,popup_open_id:t.popup_open_id||X};this.setEvent(i)}};R(hn,"event_name",W.PopupView);var Hs=class extends je{constructor(t){super(t),R(this,"event",{})}afterCollect(){var a;const{event_data:t={}}=this;let{spm:e}=t;const n=t.event_data||{},i=((a=this.app.dataStream.sharedConfig.latestPageview)==null?void 0:a.get("event.spm"))||X;e!=null&&(e=e||X,e=`${i}.${e}`);const s={spm:e};ue(n)&&ui(n,(r,l)=>{let u=r;u.is_schema_type?u=u.toJSON():ue(u)&&(u=JSON.stringify(u)),s[l]=u}),this.setEvent(s)}},$s=class extends je{constructor(t){super(t),R(this,"event",{})}beforeCollect(){const{event_data:t}=this,e=t.event_data||{},n={};if(ue(e)){let i=e.page_data_schema;const s=e.page_data;let a="";const r=Ne(s);if(r)Object.assign(n,e);else if(s&&!r){let l=s;s.is_schema_type&&(l=s.toJSON(),l.getSchema&&(i=l.getSchema())),a=JSON.stringify(l),n.page_data=a,n.page_data_schema=i}}this.setEvent(L({},n))}afterCollect(){var e;const t=((e=this.app.dataStream.sharedConfig.latestPageview)==null?void 0:e.get("event.spm"))||X;this.setEvent({spm:t})}},Vs=class extends fe{constructor(){super(...arguments),R(this,"name","dataStream"),R(this,"sharedConfig",{})}onInit(){this.app.dataStream=this,this.registerSchema()}registerSchema(){this.app.registerSchema(W.Pageview,ps),this.app.registerSchema(W.Pageleave,_s),this.app.registerSchema(W.Click,es),this.app.registerSchema(W.PopupView,ds),this.app.registerSchema(W.PageLoad,os),this.app.registerSchema(W.Exposure,is),this.app.registerSchema(W.PopupLoad,cs),this.app.registerSchema(W.BusinessEvent,Yi)}createEventData(t){const{event_name:e}=t;switch(e){case W.Pageview:return new Us(t);case W.Pageleave:return new Js(t);case W.Click:return new un(t);case W.PopupView:return new hn(t);case W.PageLoad:return new $s(t)}return e?new Hs(t):(console.error("event_name is required"),null)}handleEventData(t){return t.init(this.app),t.collect(),t.compose(),this.app.runHookSync(Ge.onDataEncoding,t)}getDeviceId(){const{sharedConfig:t}=this;if(t.device_id)return t.device_id;const e=this.app.runHookSync("onGetDeviceId",null,n=>!!n);return e&&(t.device_id=e,e)}onDataEncoding({payload:t}){return this._handleEncoding(t)}_handleEncoding(t){var n;const e=t.serialize();return this.app.logger.info("Raw Data",t.event_name,e),{type:3,level:"I",time:Date.now(),msg:JSON.stringify(e),log_ver:2,uid:(n=this.app.configManager.get("user"))==null?void 0:n.global_id,is_masked:!0,platform:this.app.configManager.get("platform")||"desktop",device_id:this.getDeviceId()}}_onPageView(t){var n;const{app:e}=this;e.resetSeq(),e.pageview_start=Date.now(),((n=t.event_data)==null?void 0:n.view_type)==="open"&&this._onPageViewOpen(),e.runHookSync(Ge.onUpdateNewHost,null),e.runHookSync(Ge.onUpdateNewContext,null)}_onPageViewOpen(){this.app.refreshPageOpenId()}_initPvid(t){const{app:e}=this,n=t==null?void 0:t.pvid,i=-1,s={pvid:i},a=wt(n)?Number(n):i,r=a+1;e.setFromPvid(a),e.setPvid(r);const l=r>=Ms?i:r;return s.pvid=l,s}_initData(t){const e=t.event,{app:n}=this,i=n.storage.syncStorage.getJson(cn),s=t.get("webview.pvid"),a=i==null?void 0:i.log_id,r=i==null?void 0:i.log_id_prefix,l=s||(i==null?void 0:i.pvid),u=i==null?void 0:i.lut,v={lut:u,pvid:l},f=(wt(a)?Number(a):-1)+1;n.setLogId(f),v.log_id=f;const m=r||n.getUuid().slice(-12);if(n.setLogIdPrefix(m),v.log_id_prefix=m,e.event_name===W.Pageview){const w=wt(u)?Number(u):-1,y=e.getEventTime()||Date.now(),k=w===-1?w:y-w;n.runHookSync(Ge.onLutChange,k);const S=this._initPvid({pvid:l,lut:k});v.pvid=S.pvid}if(e.event_name===W.Pageleave){const w=e.getEventTime()||Date.now();v.lut=w}t.set("event.state",L({},v)),n.storage.syncStorage.setJson(cn,v)}_beforeHandleEventData(t){const{event:e}=t,{app:n}=this;this._initData(t),e.event_name===W.Pageview&&(this.sharedConfig.latestPageview=e,this._onPageView(e)),n.setSeq(n.getSeq()+1)}setSharedPageData(t){const{app:e}=this,{event:n}=t,i=n.get("event.page_data"),s=n.get("event.page_data_schema");i&&e.setSharedState(bt,{page_data:i,page_data_schema:s})}resetSharedPageData(t){const{app:e}=this;e.removeSharedState(bt)}onCreate(t){const e=this.createEventData(t.event_data);t.event=e}onBeforeHandle(t){var i;const{app:e}=this,{event:n}=t;if(!(n.isType(W.Pageview)&&((i=n.event_data)==null?void 0:i.view_type)==="open")){const s=e.getSharedState(bt);s&&n.setEvent(s)}}onHandle(t){var s;const{app:e}=this,{event:n}=t;this._beforeHandleEventData(t),n.isType(W.Pageview)&&(e.runHooks("onPvidUpdate",t),((s=n.event_data)==null?void 0:s.view_type)==="open"&&this.resetSharedPageData(t));const i=this.handleEventData(n);n.isType(W.PageLoad)&&this.setSharedPageData(t),this.app.logger.debug("onHandle",t),t.set(ln,{data:i,config:{eventType:n.event_name,query:{log_id:e.getLogIdUid()}}})}},dn="galileo_debug",fn=`__${dn}`,Fs=class extends fe{constructor(){super(...arguments),R(this,"name","galileoDebug")}onInit(){const{app:t}=this;if(!t.isDebugMode()){let e=t.storage.syncStorage.get(fn);const n=t.cookie.get(dn);e=e||n;const i=e==="true"?!0:e,s=typeof location!="undefined"?location.href:"";t.configManager.set("is_debug_mode",i||new RegExp(`${fn}`).test(s))}}};function gn(t,e,n){if(t.length!==e.length)return!1;for(let i=0;i<t.length;i++){const s=t[i],a=e[i];for(let r=0;r<n.length;r++){const l=n[r];if((s==null?void 0:s[l])!==(a==null?void 0:a[l]))return!1}}return!0}var _n=(t=>(t.beforeunload="beforeunload",t.unload="unload",t.pagehide="pagehide",t.pageshow="pageshow",t.visibilitychange="visibilitychange",t))(_n||{}),Gs={HIDDEN:"hidden",VISIBLE:"visible"},Ws=class extends fe{constructor(){super(...arguments),R(this,"name","galileoNativeEvent"),R(this,"_pageState")}onInit(){this.app.pageState=new Ht,this._pageState=this.app.pageState,this.app.nativeEvent=this}onReady(){document.addEventListener("pagehide",()=>{this._pageWillUnload({event_name:"pagehide"})}),document.addEventListener("visibilitychange",()=>{this._pageWillUnload({event_name:"visibilitychange"})}),window.addEventListener("beforeunload",()=>{this._pageWillUnload({event_name:"beforeunload"})}),window.addEventListener("unload",()=>{this._pageWillUnload({event_name:"unload"})}),window.addEventListener("online",()=>{this._networkOnline()})}_networkOnline(){this.app.runPluginHookSync(t=>{if(Y(t==null?void 0:t.onNetworkOnline))return t==null?void 0:t.onNetworkOnline()})}_pageWillUnload(t){const e=()=>({visibility:document.visibilityState});if(this._pageState.push(L(L({},t),e())),this.app.runPluginHookSync(n=>{if(Y(n==null?void 0:n.pageWillUnload))return n==null?void 0:n.pageWillUnload(t)}),this.app.getDebugMode()==="warn"){const n=JSON.stringify(this._pageState.getState());console.info("pageState",n),this.app.storage.syncStorage.set("pageStatus",n)}}isPageLeave(){return De()&&ye()?this.app.pageState.getLast(3).some(e=>["pagehide","unload"].includes(e.event_name)):vt()?this.safariPageLeave():this.pageLeaveStatus()}pageLeaveStatus(){return!!this.app.pageState.getState().some(e=>["unload","beforeunload"].includes(e==null?void 0:e.event_name))}safariPageLeave(){const{beforeunload:t,pagehide:e,visibilitychange:n,unload:i}=_n,{HIDDEN:s,VISIBLE:a}=Gs,r=[{all:[[e,a],[n,s]],partial:[[n,s],[n,a],[e,a],[n,s]]},{all:[[t,a],[e,a],[n,s],[i,s]],partial:[[n,s],[n,a],[t,a],[e,a],[n,s],[i,s]]},{all:[[t,a],[e,a],[n,s]],partial:[[n,s],[n,a],[t,a],[e,a],[n,s]]}],l=v=>v.map(p=>({event_name:p[0],visibility:p[1]}));let u=!1;for(let v=0;v<r.length;v++){const p=r[v],f=this.app.pageState.getState(),{all:m,partial:w}=p,y=l(m),k=["event_name","visibility"];if(gn(f,y,k)){u=!0;break}const S=l(w),C=this.app.pageState.getLast(S.length);if(gn(C,S,k)){u=!0;break}}return u}};function vn(t,...e){const n=e;for(let i=1;i<n.length;i++){const s=n[i];for(const a in s)t[a]=s[a]}return t}var Qs={read(t){return t[0]==='"'&&(t=t.slice(1,-1)),t.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write(t){return encodeURIComponent(t).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}};function Ks(t,e){function n(s,a,r){if(typeof document=="undefined")return;r=vn({path:"/"},e,r),typeof r.expires=="number"&&(r.expires=new Date(Date.now()+r.expires*864e5)),r.expires&&(r.expires=r.expires.toUTCString()),s=encodeURIComponent(s).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);let l="";for(const u in r)r[u]&&(l+=`; ${u}`,r[u]!==!0&&(l+=`=${r[u].split(";")[0]}`));return document.cookie=`${s}=${t.write(a,s)}${l}`}function i(s){if(typeof document=="undefined"||arguments.length&&!s)return;const a=document.cookie?document.cookie.split("; "):[],r={};for(let l=0;l<a.length;l++){const u=a[l].split("="),v=u.slice(1).join("=");try{const p=decodeURIComponent(u[0]);if(r[p]=t.read(v,p),s===p)break}catch(p){console.error("parse cookie error",p)}}return s?r[s]:r}return Object.create({set:n,get:i,remove(s,a={}){n(s,"",vn({},a,{expires:-1}))}},{})}var zs=Ks(Qs,{path:"/"}),Ys=class extends fe{constructor(){super(...arguments),R(this,"name","webCookie")}onInit(){this.app.cookie=zs}},Xs=200,Zs="galileo:",ea=typeof AbortController=="function",ta=class{constructor(){R(this,"_prefix",Zs),R(this,"_runningState","async")}setRunningState(t){this._runningState=t}request(t,e,n){var a;const i=this._prefix+t;if(((n==null?void 0:n.runningState)||this._runningState)==="sync"||!Y((a=navigator.locks)==null?void 0:a.request)||!ea)return e();{const r=(n==null?void 0:n.timeout)||Xs;try{const l=new AbortController,u=l.signal;return setTimeout(()=>{l.abort()},r),navigator.locks.request(i,{signal:u},v=>K(this,null,function*(){return e()})).catch(v=>e({type:"lock-catch",error:v}))}catch(l){return e({type:"lock-req",error:l})}}}},na=class extends fe{constructor(){super(...arguments),R(this,"name","webLocks")}onInit(){this.app.webLocks=new ta}pageWillUnload(){const{app:t}=this,e=t.pageState.getLast(4).map(n=>n.event_name).join("|");/(beforeunload|unload)/.test(e)&&t.webLocks.setRunningState("sync")}},ia="infra.galileo.get",sa="infra.galileo.set",aa=300,oa=class extends fe{constructor(){super(...arguments),R(this,"name","Webview"),R(this,"isInApp",!1)}onInit(){this.app.webview=this,this.isInApp=ye()}onBeforeHandle(t){if(!this.isInApp)return;const e=this.getGalileoData(["pvid"]);return e==null?void 0:e.then(n=>{const i=n==null?void 0:n.pvid;this.app.logger.info("webview pvid",i),/\d+/.test(i)&&i>=0&&t.set("webview.pvid",Number(i))})}onPvidUpdate(t){if(!this.isInApp)return;const e=t.get("event.state"),n=this.app.getPvid(),i=(e==null?void 0:e.pvid)||n;gt(i)&&i>=0&&(this.app.logger.info("webview pvid update",i),this.setGalileoData({pvid:String(i)}))}getGalileoData(t){if(!this.isInApp)return;const e=this.sendMessage(ia,t);return e?Promise.race([li(aa),e]):null}setGalileoData(t){return this.sendMessage(sa,t)}sendMessage(t,...e){if(!this.isInApp)return;const n=Ie.call(t,...e);if(n&&Y(n.then))return n.catch(i=>(console.error(`JsBridge call ${t} error`,i),null))}},ra="time_diff",mn="k_g__ti_diff",pn=1e3*60*60*24,la="/v3/frontlogsrv/log/servertime",ca="https://log.klook.com",ua="https://log.klook.cn",ha=class extends fe{constructor(){super(...arguments),R(this,"name","syncTime"),R(this,"url","")}onInit(){if(Jt){const t=/\.cn/.test(location.host)?ua:ca;this.url=`${t}${la}`}this.app.syncTime=this}onReady(){var e,n;const{app:t}=this;if(ye())(e=t.webview.getGalileoData([ra]))==null||e.then(i=>{const s=i==null?void 0:i.time_diff;this.setTimeDiff(s||0)}).catch(i=>{console.error("get time diff error",i)});else{const i=t.storage.syncStorage.getJson(mn)||{},{time_diff:s,timestamp:a}=i;gt(s)&&a&&Date.now()-a<pn?this.setTimeDiff(s):(n=this.requestServerTime())==null||n.then(r=>{const l=(r==null?void 0:r.timeDiff)||0;this.setTimeDiff(l);const u=Date.now();t.storage.syncStorage.setJson(mn,{time_diff:l,timestamp:l?u:u-pn/4})})}}setTimeDiff(t){this.app.timeDiff=t}getUrl(){return this.app.configManager.get("syncTimeUrl")||this.url}requestServerTime(){const t=this.getUrl();if(t)return this.app.request.sendXhr({url:t,method:"GET"}).then(e=>K(this,null,function*(){const n=Date.now(),i=e==null?void 0:e.data;let s=i==null?void 0:i.server_time;if(s)return s=gt(s)?s:0,{timeDiff:s?n-s:0}})).catch(e=>{this.app.logger.error("Request server time error: "),this.app.logger.error(e)})}},da=class{constructor(){R(this,"app"),R(this,"corePlugins",[na,Bi,Fs,Ws,Bs,Ts,Cs,Vs,oa,ha]),this.app=new Ci({corePlugins:this.corePlugins,version:"1.5.0"}),this.initInner()}initInner(){const e=[Ys,Ki].map(n=>{const i=new n(this.app);return this.app.setPluginInstance(i),i});e.forEach(n=>{var i;(i=n.onInit)==null||i.call(n)}),e.forEach(n=>{var i;(i=n.onReady)==null||i.call(n)})}},fa=class extends da{constructor(){super(),this.cmdPushCheck(),this.cmdCheck()}cmdPushCheck(){const t=window.k_galileo_queue||[];window.k_galileo_queue=t;const e=t.push;t.push=(...n)=>(setTimeout(()=>{this.cmdCheck()},10),e.apply(t,n)),Jt&&window.addEventListener("load",()=>{this.cmdCheck()})}cmdCheck(){const t=window.k_galileo_queue||[];if(Array.isArray(t)&&t.length>0){const e=t.slice();window.k_galileo_queue.length=0,e.sort((n,i)=>(n==null?void 0:n.type)==="init"&&(i==null?void 0:i.type)==="init"?1:(n==null?void 0:n.type)==="init"?-1:1),this.runSeq(e)}}runSeq(t,e){const n=i=>{if(i>=t.length){e==null||e();return}const s=t[i],a=s==null?void 0:s.fn,r=l=>{const v=l(this);ni(v)?v.then(()=>{n(i+1)}).catch(()=>{n(i+1)}):n(i+1)};Y(a)?r(a):n(i+1)};n(0)}},ga=class extends fa{constructor(){super()}init(t){return K(this,null,function*(){var e,n;try{this.app.setConfig(t),yield this.app.init()}catch(i){const s=i;console.error("Galileo Init Error",s),(n=(e=this.app).sendDebugData)==null||n.call(e,{tag:"galileo-init-error",errmsg:s.message,errcode:s.name,errstack:s.stack})}return this})}set(t,e){this.app.configManager.set(t,e)}login(t){return this.app.configManager.set("user",L({},t))}logout(){return this.app.configManager.set("user",{})}onReady(t){this.app.subscribe(t)}track(t,e){var v,p;if(!this.app.isReady()){this.onReady(()=>this.track(t,e)),console.error("Galileo is not ready or Init failed, Please init first before track"),(p=(v=this.app).sendDebugData)==null||p.call(v,{tag:"galileo-not-ready-track-error",track_message:`eventName: ${t}`});return}const n=de(L({},e),{event_name:t});this.app.logger.info("Raw event Data",t,n);const{app:i}=this,s=i.createContext(n),a=(f,m)=>{var y,k;const w={tag:"galileo-track-cb-error",eventName:t,errtype:f,errmsg:m==null?void 0:m.message,errcode:m==null?void 0:m.name,errstack:m==null?void 0:m.stack};i.logger.error(w),(k=(y=this.app).sendDebugData)==null||k.call(y,w)},r=[f=>i.runHooks(Os,s,f),f=>i.runHooks(ks,s,f),f=>{var y;const m=k=>{const S=k==null?void 0:k.error;return S&&a(k.type||"lock-error",S),i.runHooks(Es,s,f)};let w=W.Click===t?"sync":"async";return((y=s.event_data)==null?void 0:y.leave_type)==="close"&&(w="sync"),i.webLocks.request(Ss,m,{runningState:w})},f=>i.runHooks(Ps,s,f),f=>i.runHooks(Is,s,f),f=>i.runHooks(xs,s,f)],l=()=>{var w;const f=s.getStopReason();f&&i.logger.debug("Complete Error",t,f),i.logger.debug("Complete Event",t,s);const m=s.getError();if(m.length){const y="Collect event error";i.logger.error(y,m),(w=i.sendDebugData)==null||w.call(i,{tag:y,eventName:t,errors:m.map(k=>{const S=k||{};return{errname:S.name,errMsg:S.message,errStack:S.stack}})})}},u=(f=0)=>s.isStop()?l==null?void 0:l():f<r.length?r[f](()=>u(f+1)):l==null?void 0:l();try{const f=u(0);return Y(f==null?void 0:f.then)?f.catch(m=>{a("hook-error",m)}):f}catch(f){a("hook-error",f)}}},_a=Object.defineProperty,va=Object.defineProperties,ma=Object.getOwnPropertyDescriptors,nt=Object.getOwnPropertySymbols,yn=Object.prototype.hasOwnProperty,bn=Object.prototype.propertyIsEnumerable,St=(t,e,n)=>e in t?_a(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,M=(t,e)=>{for(var n in e||(e={}))yn.call(e,n)&&St(t,n,e[n]);if(nt)for(var n of nt(e))bn.call(e,n)&&St(t,n,e[n]);return t},_e=(t,e)=>va(t,ma(e)),pa=(t,e)=>{var n={};for(var i in t)yn.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(t!=null&&nt)for(var i of nt(t))e.indexOf(i)<0&&bn.call(t,i)&&(n[i]=t[i]);return n},re=(t,e,n)=>St(t,typeof e!="symbol"?e+"":e,n),wn=(t,e,n)=>new Promise((i,s)=>{var a=u=>{try{l(n.next(u))}catch(v){s(v)}},r=u=>{try{l(n.throw(u))}catch(v){s(v)}},l=u=>u.done?i(u.value):Promise.resolve(u.value).then(a,r);l((n=n.apply(t,e)).next())}),ya=t=>Object.prototype.toString.call(t),Et=t=>e=>e!==null&&(Array.isArray(t)?t:[t]).some(n=>ya(e)===`[object ${n}]`),it=Et("String"),pe=Et(["Function","AsyncFunction","GeneratorFunction"]),st=Et("Object");["debug","info","warn","error"].reduce((t,e,n,i)=>_e(M({},t),{[e]:i.slice(n)}),{});function at(t,e){const n=Object.keys(t);for(let i=0;i<n.length;i++){const s=n[i],a=t[s];e(a,s,t)}}var ba=(t,e)=>{const{delay:n,maxWait:i=n}=e;let s=null,a=null,r=null;const l=function(...u){const v=Date.now();r===null&&(r=v,a=setTimeout(()=>{s&&(clearTimeout(s),s=null),t.apply(this,u),r=null,a=null},i)),s&&clearTimeout(s),s=setTimeout(()=>{a&&(clearTimeout(a),a=null),t.apply(this,u),s=null,r=null},n)};return l.cancel=()=>{s&&(clearTimeout(s),s=null),a&&(clearTimeout(a),a=null),r=null},l},ae=typeof window!="undefined",Sn=()=>{const t=window.safari;return!!(typeof t=="object"&&t.pushNotification)},wa=()=>{const t=navigator.userAgent;return/android/i.test(t)},ot=t=>{const e=navigator.userAgent;return/\(i[^;]+;( U;)? CPU.+Mac OS X/i.test(e)},We=()=>/klook/i.test(navigator.userAgent),Sa=class{constructor(t){re(this,"_state",[]),re(this,"_options",{max:20}),this._options=M(M({},this._options),t)}push(t){const{max:e}=this._options;this._state.length>=e&&this._state.shift(),this._state.push(t)}getLast(t){return this._state.slice(-t)}getState(){return this._state.slice()}},V={HIDDEN:"hidden",VISIBLE:"visible"};function En(t,e,n){if(t.length!==e.length)return!1;for(let i=0;i<t.length;i++){const s=t[i],a=e[i];if(!n(s,a))return!1}return!0}function Ea(t){const e=[{all:[["pagehide",V.VISIBLE],["visibilitychange",V.HIDDEN]],partial:[["visibilitychange",V.HIDDEN],["visibilitychange",V.VISIBLE],["pagehide",V.VISIBLE],["visibilitychange",V.HIDDEN]]},{all:[["beforeunload",V.VISIBLE],["pagehide",V.VISIBLE],["visibilitychange",V.HIDDEN],["unload",V.HIDDEN]],partial:[["visibilitychange",V.HIDDEN],["visibilitychange",V.VISIBLE],["beforeunload",V.VISIBLE],["pagehide",V.VISIBLE],["visibilitychange",V.HIDDEN],["unload",V.HIDDEN]]},{all:[["beforeunload",V.VISIBLE],["pagehide",V.VISIBLE],["visibilitychange",V.HIDDEN]],partial:[["visibilitychange",V.HIDDEN],["visibilitychange",V.VISIBLE],["beforeunload",V.VISIBLE],["pagehide",V.VISIBLE],["visibilitychange",V.HIDDEN]]}],n=s=>s.map(a=>({event_name:a[0],visibility:a[1]}));let i=!1;for(let s=0;s<e.length;s++){const a=e[s],r=t.getState(),{all:l,partial:u}=a,v=n(l),p=(w,y)=>w.event_name===y.event_name&&w.visibility===y.visibility;if(En(r,v,p)){i=!0;break}const f=n(u),m=t.getLast(f.length);if(En(m,f,p)){i=!0;break}}return i}function Qe(t,e){t.push({event_name:e,visibility:document.visibilityState})}function Oa(t){const e=[["beforeunload","pagehide","unload"],["beforeunload","unload"],["visibilitychange","pagehide","unload"],["visibilitychange","unload"]],n=t.getLast(4).map(i=>i.event_name);return e.some(i=>i.every(s=>n.includes(s)))}function ka(t){const e={pagehide:V.VISIBLE,unload:V.HIDDEN};return t.getLast(1).every(n=>{const i=n.event_name;return e[i]===n.visibility})}function Ia(t){return ot()&&We()?ka(t):Sn()?Ea(t):Oa(t)}function rt(t,e){const n=Ia(t);e(n)}function Pa(t,e){const n=t.getLast(3),i=n.map(s=>s.event_name);if(wa()&&We()){const s=[{k:"beforeunload",v:V.VISIBLE},{k:"visibilitychange",v:V.HIDDEN}],a=n.slice(-2);s.every((r,l)=>{const{k:u,v}=r,{event_name:p,visibility:f}=a[l]||{};return p===u&&f===v})&&setTimeout(()=>{const[r]=t.getLast(1);if((r==null?void 0:r.event_name)!=="unload")return e()},100);return}i.includes("beforeunload")||e()}var xa=class{constructor(){re(this,"_onBeforeUnload"),re(this,"_onPageHide"),re(this,"_onPageShow"),re(this,"_onPageUnload"),re(this,"_onVisibilityChange"),re(this,"_subscribers",new Map),re(this,"addListener"),re(this,"removeListener"),re(this,"states"),this.addListener=window.addEventListener.bind(window),this.removeListener=window.removeEventListener.bind(window),this.states=new Sa,this.initCallback()}initCallback(){const{states:t}=this;this._onBeforeUnload=()=>{Qe(t,"beforeunload"),this.onBeforeUnload()},this._onPageHide=e=>{Qe(t,"pagehide"),this.onPageHide()},this._onPageShow=e=>{Qe(t,"pageshow"),this.onPageShow()},this._onVisibilityChange=()=>{Qe(t,"visibilitychange"),this.onVisibilityChange()},this._onPageUnload=()=>{Qe(t,"unload"),this.onPageUnload()}}onPageShow(){}onPageHide(){ot()&&We()&&rt(this.states,t=>{t&&this.onPageLeave({leave_type:"close"})})}onBeforeUnload(){}onPageUnload(){const{states:t}=this;rt(t,e=>{ot()&&We()&&t.getLast(4).some(n=>n.event_name==="pagehide")||e&&this.onPageLeave({leave_type:"close"})})}onVisibilityChange(){const{states:t}=this;if(document.visibilityState===V.VISIBLE)this.onPageView({view_type:"show"});else if(ot()&&We()){if(t.getLast(4).some(e=>e.event_name==="pagehide"))return;rt(t,e=>{this.onPageLeave({leave_type:e?"close":"hide"})})}else Sn()?rt(t,e=>{this.onPageLeave({leave_type:e?"close":"hide"})}):Pa(t,()=>{this.onPageLeave({leave_type:"hide"})})}onPageView(t){this._callSubs("onPageView",t)}onPageLeave(t){this._callSubs("onPageLeave",t)}_callSubs(t,e){const n=this._subscribers.get(t);n==null||n.forEach(i=>i.fn(e))}subscribe(t,e,n){const i=this._subscribers.get(t)||[];pe(n)&&!i.map(s=>s.id).includes(e)&&i.push({id:e,fn:n}),this._subscribers.set(t,i)}unbindEvents(){this.removeListener("pageshow",this._onPageShow),this.removeListener("beforeunload",this._onBeforeUnload),this.removeListener("unload",this._onPageUnload),document.removeEventListener("pagehide",this._onPageHide),document.removeEventListener("visibilitychange",this._onVisibilityChange)}bindEvents(){this.addListener("pageshow",this._onPageShow),this.addListener("beforeunload",this._onBeforeUnload),this.addListener("unload",this._onPageUnload),document.addEventListener("pagehide",this._onPageHide),document.addEventListener("visibilitychange",this._onVisibilityChange)}destroy(){this.unbindEvents(),this._subscribers.clear()}},Ca=()=>{if(ae){const t=window.scheduler;return t&&typeof t.postTask=="function"}return!1},Na=class{static postTask(t,e){return wn(this,null,function*(){let{delay:n=0,priority:i="user-visible"}=e||{};return new Promise((s,a)=>{if(!pe(t))return console.warn("Scheduler postTask: task is not a function"),s();n=typeof n!="number"||n<0?0:n,Ca()?window.scheduler.postTask(t,{delay:n,priority:i}):setTimeout(()=>wn(this,null,function*(){try{yield t(),s()}catch(r){a(r)}}),n)})})}};const Da=()=>ae?window._galileo||window.Galileo:void 0,La=()=>{const t=window.k_galileo_queue||[],e=Array.isArray(t)?t:[];return window.k_galileo_queue=e,e},qe=(t,e)=>{if(!ae)return;const n=Da();if(n)return pe(n.callSafe)?n.callSafe(()=>t(n)):t(n);La().push({type:e,fn:t})},Ta=()=>{const t=(e,...n)=>{qe(i=>{var s,a;(a=(s=i==null?void 0:i.logger)==null?void 0:s[e])==null||a.call(s,...n)})};return{info(...e){t("info",...e)},error(...e){t("error",...e)},warn(...e){t("warn",...e)}}},Ue=(t,e)=>{try{return t()}catch(n){return console.error("galileo click error",n),e==null||e(n),null}},Je=(t={})=>{ae&&qe(e=>{var n,i;(i=(n=e==null?void 0:e.app)==null?void 0:n.sendDebugData)==null||i.call(n,t)})},Aa=(t="",e="popup")=>{const n=Math.random().toString(36).substring(2,15);return[e,t,n].filter(Boolean).join("-")},Ot="data-spm-",kt={module:`${Ot}module`,item:`${Ot}item`,virtualItem:`${Ot}virtual-item`},Ra=t=>t!=null&&t.getAttribute&&(t.getAttribute(kt.item)||t.getAttribute(kt.virtualItem))||"",On=/^WebClick_\d+$/i;function kn(t){var e;let n=t;const i={item:"",module:""};for(;n;){if(!i.item){const r=Ra(n);if(r){const l=r.split("?")[0];i.item=/(__default|__virtual)/.test(l)?"":l}}const a=(n==null?void 0:n.getAttribute(kt.module))||"";if(a){i.module=a.split("?")[0];break}if(((e=n.tagName)==null?void 0:e.toLowerCase())==="body")break;n=n.parentElement}const s=[i.module,i.item?i.item:""].filter(a=>!!a);return s.length?s.join("."):""}function Ba(){return ae&&typeof document!="undefined"&&(window.__Galileo_Debug_Mode||(document.cookie||"").includes("__galileo_debug"))}const Ma=Ba();function It(t){Ma&&Ue(t)}const ja="galileo_event_data";var Le=(t=>(t.PAGE_OPEN="open",t.PAGE_SHOW="show",t.PAGE_QUERY_CHANGE="query_change",t.PAGE_CLOSE="close",t.PAGE_HIDE="hide",t))(Le||{}),Ke=(t=>(t.Pageview="$WebPageView",t.Pageleave="$WebPageLeave",t.Click="$Click",t.Popup="$PopupView",t.PopupLoad="$PopupLoad",t.PageLoad="$PageLoad",t.Exposure="$Exposure",t.Business="$BusinessEvent",t))(Ke||{});const qa=t=>{try{const{spm:e,data:n,schema:i,timestamp:s=Date.now(),component_name:a}=t,{version:r}=i,l=it(n)?n:JSON.stringify(n);qe(u=>{u==null||u.track(Ke.Click,{spm:e,timestamp:s,component_name:a,event_data_schema:r,event_data:l})})}catch(e){console.log("track error",e)}};var Te=(t=>(t.ENTERING="entering",t.INTERSECTING="intersecting",t.LEAVING="leaving",t.OUT="out",t))(Te||{});const Ua=(t="")=>Aa(t,"exposure"),Pt=t=>(t==null?void 0:t.tagName)!=null;class Ja{constructor(e={}){re(this,"exposureMap",new Map),re(this,"intersectionObserver",null),re(this,"intervalTimer",null),re(this,"options");var n,i,s;this.options={threshold:(n=e.threshold)!=null?n:.8,minDuration:(i=e.minDuration)!=null?i:300,intervalTime:(s=e.intervalTime)!=null?s:300,onExposure:e.onExposure},this.init()}init(){if(typeof IntersectionObserver=="undefined"){console.warn("IntersectionObserver is not supported in this browser.");return}this.intersectionObserver=new IntersectionObserver(this.handleIntersectionChange.bind(this),{threshold:[0,this.options.threshold,1],rootMargin:"0px"}),this.startIntervalCheck()}startIntervalCheck(){this.intervalTimer=setInterval(()=>{this.exposureMap.forEach((e,n)=>{e.eStatus===Te.INTERSECTING&&e.sTime&&Date.now()-e.sTime>=this.options.minDuration&&!e.removed&&(this.triggerExposure(n,e),this.exposureMap.set(n,_e(M({},e),{sTime:Date.now(),removed:!0})))})},this.options.intervalTime)}handleIntersectionChange(e){e.forEach(n=>{var i,s,a;if(n.intersectionRatio<0)return;const r=n.target,l=this.exposureMap.get(r);if(this.exposureMap.has(r)&&l!=null&&l.removed){(i=this.intersectionObserver)==null||i.unobserve(r),this.exposureMap.delete(r);return}if(n.intersectionRatio>=this.options.threshold){if(n.isIntersecting&&(!this.exposureMap.has(r)||!((s=this.exposureMap.get(r))!=null&&s.sTime))){const u=this.exposureMap.get(r),v=(u==null?void 0:u.id)||this.generateExposureId(r);this.exposureMap.set(r,{id:v,sTime:Date.now(),ratio:n.intersectionRatio,removed:!1,onExposure:u==null?void 0:u.onExposure,eStatus:Te.INTERSECTING})}}else if(this.exposureMap.has(r)&&!n.isIntersecting){const u=l;if(this.exposureMap.set(r,_e(M({},u),{eStatus:Te.LEAVING})),Date.now()-u.sTime>=this.options.minDuration){const v=_e(M({},u),{ratio:u.ratio,eStatus:Te.OUT});this.triggerExposure(r,v),this.exposureMap.delete(r),(a=this.intersectionObserver)==null||a.unobserve(r)}else this.exposureMap.set(r,_e(M({},u),{eStatus:Te.OUT,removed:!1}))}})}generateExposureId(e){const n=Date.now(),i=Math.random().toString(36).substr(2,9),s=e.id||"",a=e.className||"";return`exp_${e.tagName.toLowerCase()}_${s}_${a}_${n}_${i}`.replace(/\W/g,"_")}triggerExposure(e,n){try{const i=Date.now()-n.sTime;n.onExposure?n.onExposure(e,M({duration:i},n)):this.options.onExposure&&this.options.onExposure(e,M({duration:i},n))}catch(i){console.warn("Failed to trigger exposure callback:",i)}}getExposureDataById(e){for(const[n,i]of this.exposureMap.entries())if(i.id===e)return{element:n,data:i};return null}updateExposureDataById(e){return!!this.getExposureDataById(e)}manualTriggerExposureById(e){const n=this.getExposureDataById(e);return n?(this.triggerExposure(n.element,n.data),this.exposureMap.set(n.element,_e(M({},n.data),{removed:!0})),!0):!1}manualTriggerExposure(e){const n=this.exposureMap.get(e);return n?(this.triggerExposure(e,n),this.exposureMap.set(e,_e(M({},n),{removed:!0})),!0):!1}observe(e,n){if(this.intersectionObserver){const i=(n==null?void 0:n.customId)||Ua(),{onExposure:s,force:a}=n||{};if(this.exposureMap.has(e)&&!a){const r=this.exposureMap.get(e);this.exposureMap.set(e,_e(M({},r),{id:i||r.id,onExposure:s||r.onExposure}))}else{if(a&&this.unobserve(e),i||s){const r={eStatus:Te.ENTERING};i&&(r.id=i),s&&(r.onExposure=s),this.exposureMap.set(e,r)}this.intersectionObserver.observe(e)}i&&this.setElementData(e,i)}}setElementData(e,n){n&&e.setAttribute("data-exposure-id",n)}unobserve(e){this.intersectionObserver&&(this.intersectionObserver.unobserve(e),this.exposureMap.delete(e))}observeElements(e,n){const{idPrefix:i,onExposure:s}=n||{};document.querySelectorAll(e).forEach((a,r)=>{const l=i?`${i}_${r}`:void 0;this.observe(a,{customId:l,onExposure:s})})}destroy(){this.intervalTimer&&(clearInterval(this.intervalTimer),this.intervalTimer=null),this.intersectionObserver&&(this.intersectionObserver.disconnect(),this.intersectionObserver=null),this.exposureMap.clear()}updateOptions(e){this.options=M(M({},this.options),e)}isObserving(e){return this.exposureMap.has(e)}getObservedElementsCount(){return this.exposureMap.size}cleanupRemovedElements(){const e=[];return this.exposureMap.forEach((n,i)=>{document.contains(i)||e.push(i)}),e.forEach(n=>{var i;this.exposureMap.delete(n),(i=this.intersectionObserver)==null||i.unobserve(n)}),e.length}getElementStatus(e){const n=this.exposureMap.get(e);return(n==null?void 0:n.eStatus)||null}}let xt=null;const Ct=t=>(xt||(xt=new Ja(t)),xt),Ha="galileo_event_data",$a=t=>{try{const{spm:e,data:n,schema:i,timestamp:s=Date.now()}=t,{version:a}=i,r=it(n)?n:JSON.stringify(n),l=()=>qe(u=>{var v;if(((v=u.app)==null?void 0:v.getConfig("enableExposure"))!==!1)return u==null?void 0:u.track(Ke.Exposure,{spm:e,timestamp:s,event_data:{event_data_schema:a,event_data:r}})});return Na.postTask(l,{delay:300})}catch(e){console.log("track error",e)}};function Va(t,e){const{spm:n="",mapData:i=[],schema:s,eventData:a,component_name:r,payload:l={}}=e,u={},v=Date.now();try{Array.isArray(i)?i.forEach(y=>{it(y)?u[y]=t[y]:st(y)?at(y,(k,S)=>{const C=t[S];k&&(u[k]=C)}):pe(y)&&y({inst:t,eventData:u,payload:l})}):st(i)?at(i,(y,k)=>{const S=t[k];y&&(u[y]=S)}):pe(i)&&i({inst:t,eventData:u,payload:l})}catch(y){console.error("mapData error",i,y)}const p=M({},u),f=n||p.spm||"";p.spm&&delete p.spm;const m={};if(a){const y=pe(a)?a(M({payload:l,spm:f},p),t):a;y&&y.is_schema_type&&(m.event_data=y.toJSON(),m.event_data_schema=y.getSchema())}const w={spm:f,data:m.event_data||p,schema:m.event_data_schema?{version:m.event_data_schema}:_e(M({},s),{version:(s==null?void 0:s.version)||"com.klook.galileo.UniversalExposure:1.0.0"}),timestamp:v,component_name:r};$a(w)}function Fa(t){const{value:e,vnode:n,element:i,exposureData:s}=t,{inner:a=!1}=e,r=n.componentInstance,l=n.context,u=a&&r||l,v=(r==null?void 0:r[Ha])||{},p=M(M({},v),e);if(i&&(!p.spm||On.test(p.spm))){const f=kn(i);f&&(p.spm=f)}Va(u,M({},p)),ae&&window.__Galileo_Exposure&&CustomEvent&&window.dispatchEvent(new CustomEvent("galileo-exposure",{detail:{element:i,value:e,exposureData:s}}))}function In(t){ae&&Ue(()=>{Fa(t)},e=>{Je({tag:"galileo-exposure-error",errmsg:e==null?void 0:e.message,errcode:e==null?void 0:e.name,errstack:e==null?void 0:e.stack})})}function Pn(t){var e;const n=Ct();if(!n)return;const{el:i,binding:s,type:a,vnode:r}=t,l=(v,p)=>{In({exposureData:p,element:v,value:s.value,vnode:r})};let u=!1;if(a==="update"){const{value:v,oldValue:p}=s;u=p.spm!==v.spm||p.key!==v.key}n.observe(i,{onExposure:l,customId:(e=s.value)==null?void 0:e.customId,force:u}),It(()=>{i.__galileo_exposure_options=M({},t),i.setAttribute("data-galileo-exposure",`10_${Date.now()}`)})}function xn(t){const e=Ct();if(!e)return;const{el:n,binding:i,type:s,vnode:a}=t,{value:r,oldValue:l,modifiers:u}=i;if(!(u!=null&&u.exposure))return;if((r==null?void 0:r.exposure)===!1){s==="update"&&e.unobserve(n);return}const v=M(M({},r),r.exposure),p=(m,w)=>{In({exposureData:w,element:m,value:v,vnode:a})};let f=!1;if(s==="update"){const m=M({spm:l.spm},l.exposure),w=M({spm:r.spm},r.exposure);f=m.spm!==w.spm||m.key!==w.key}e.observe(n,{onExposure:p,customId:r==null?void 0:r.customId,force:f})}function Cn(t,e){const{spm:n="",propKey:i=ja,mapMethods:s,mapData:a=[],schema:r,eventData:l,component_name:u,nativeEvent:v,autoTrackSpm:p,payload:f={}}=e,m=t[i],w={},y=Date.now(),k=(m==null?void 0:m.eventData)||l;try{Array.isArray(a)?a.forEach(B=>{it(B)?w[B]=t[B]:st(B)?at(B,(O,A)=>{const T=t[A];O&&(w[O]=T)}):pe(B)&&B({inst:t,eventData:w,payload:f})}):st(a)?at(a,(B,O)=>{const A=t[O];B&&(w[B]=A)}):pe(a)&&a({inst:t,eventData:w,payload:f})}catch(B){console.error("mapData error",a,B)}const S=M(M({},w),m);let C=n||S.spm||"";if(S.spm&&delete S.spm,(p||On.test(C))&&v){const B=v.target,O=kn(B);O&&(C=O)}const N={};if(k){const B=pe(k)?k(M({payload:f,spm:C},S),t):k;B&&B.is_schema_type&&(N.event_data=B.toJSON(),N.event_data_schema=B.getSchema())}const Z={spm:C,data:N.event_data||S,schema:N.event_data_schema?{version:N.event_data_schema}:_e(M({},r),{version:(r==null?void 0:r.version)||"com.klook.galileo.UniversalClick:1.0.0"}),timestamp:y,component_name:u};qa(Z)}function Nn(t,e){const{binding:n,vnode:i,bindType:s}=e,{value:a,arg:r,modifiers:l}=n,{mapMethods:u,binding:v=r==null,enforce:p="post",inner:f=!1,enable:m=!0,componentName:w}=a,y=l!=null&&l.capture?!0:p==="pre",k=!!(l!=null&&l.stop),S=!!m,C=i.componentInstance,N=i.context,Z=f&&C||N,B=Z.$options._componentTag,O=w||B||t.tagName||N.name||"Unknown",A=C||N;if(v){const T=Q=>{k&&(Q==null||Q.stopPropagation()),Ue(()=>{Cn(Z,M({bindType:s,nativeEvent:Q,component_name:O},a))},ee=>{Je({tag:"galileo-click-directive-trigger",detail:`name: ${O}`,bindtype:s,errmsg:ee==null?void 0:ee.message,errcode:ee==null?void 0:ee.name,errstack:ee==null?void 0:ee.stack})})},J=t.__galileo_bind_event,F=()=>{J&&(t.removeEventListener("click",J,y),t.__galileo_bind_event=null),S&&(t.addEventListener("click",T,y),t.__galileo_bind_event=T)};s==="update"?(t.___click_timeout_id&&clearTimeout(t.___click_timeout_id),t.___click_timeout_id=setTimeout(F)):F(),It(()=>{t.__galileo_click_options=e,t.setAttribute("data-galileo-click",`1_${Date.now()}`)})}else if(A&&r){const T=`__inst_vue_event_${r}`;if(A[T]&&A.$off(r,A[T]),!S){A[T]=null;return}const J=F=>{Ue(()=>{Cn(Z,M({payload:F,bindType:s,component_name:O},a))},Q=>{Je({tag:"galileo-click-directive-trigger",detail:`name: ${O}`,bindtype:s,errmsg:Q==null?void 0:Q.message,errcode:Q==null?void 0:Q.name,errstack:Q==null?void 0:Q.stack})})};A.$on(r,J),A[T]=J,It(()=>{const F=A.$el;F&&(F.__galileo_click_options=e,F.setAttribute("data-galileo-click","2"))})}else{const T={tag:"galileo-click-directive",errmsg:"No component instance or vueEventName provided for binding",errcode:"NO_COMPONENT_INSTANCE",errstack:new Error("error").stack};Je(T),console.error("Galileo Click Tracker Error:",T)}}M({name:"galileoClickTracker"},{bind(t,e,n){const{value:i}=e;!i||!ae||!t||(Ue(()=>{Nn(t,{binding:e,vnode:n,bindType:"bind"})},s=>{Je({tag:"galileo-click-directive",bindtype:"bind",errmsg:s==null?void 0:s.message,errcode:s==null?void 0:s.name,errstack:s==null?void 0:s.stack})}),xn({el:t,binding:e,vnode:n,type:"bind"}))},update(t,e,n){const{value:i}=e;!i||!ae||!t||(xn({el:t,binding:e,vnode:n,type:"update"}),Ue(()=>{Nn(t,{binding:e,vnode:n,bindType:"update"})},s=>{Je({tag:"galileo-click-directive",errmsg:s==null?void 0:s.message,errcode:s==null?void 0:s.name,errstack:s==null?void 0:s.stack})}))},unbind(t,e,n){t!=null&&t.__galileo_bind_event&&setTimeout(()=>{var i;(i=t.removeEventListener)==null||i.call(t,"click",t.__galileo_bind_event),t.__galileo_bind_event=null},0)}}),M({name:"galileoExposureTracker"},{bind(t,e,n){ae&&Pt(t)&&Pn({el:t,binding:e,vnode:n,type:"bind"})},update(t,e,n){!ae||!Pt(t)||Pn({el:t,binding:e,vnode:n,type:"update"})},unbind(t){if(!ae||!t||!Pt(t))return;const e=Ct();try{e==null||e.unobserve(t)}catch(n){console.error("Failed to unobserve element:",n)}}});const Ga="__galileo_hoc_",lt="onPageView",Nt="triggerQueryChangeEvent",Ae=t=>`${Ga}${t}`,le=(t,e,...n)=>{const i=Ae(e),s=t[i];return pe(s)||console.error("[galileo-vue] no such method: ",i),s==null?void 0:s.apply(t,n)};function Wa(t,e,n){if(!ae)return t;const i=(n==null?void 0:n.Vue)||se;if(!i)return t;const s=i.extend(t),a=e,{ignoreQueryParams:r=[],enableWatchQuery:l=!1,watchQueryCallback:u}=a,v=pa(a,["ignoreQueryParams","enableWatchQuery","watchQueryCallback"]),{spm:p}=v,f=new xa,m=y=>{const k=M({},y);return r.forEach(S=>{delete k[S]}),k},w=Ta();return s.mixin({data(){return{__g_is_deactive:!1}},created(){if(!ae)return;const y=lt;l&&(this._g_debouncedPageView=ba((S,C)=>{if(u!=null&&u(S,C)){le(this,Nt);return}if(this.__g_is_deactive)return;const N=m(C.query||{}),Z=m(S.query||{}),B=JSON.stringify(N),O=JSON.stringify(Z);B!==O&&le(this,Nt)},{delay:300})),f.subscribe(y,y,S=>{le(this,y,M({},S))});const k="onPageLeave";f.subscribe(k,k,S=>{le(this,"onPageLeave",M({},S))})},computed:{_g_isKeepAlive(){var y,k;return(k=(y=this.$vnode)==null?void 0:y.data)==null?void 0:k.keepAlive}},beforeMount(){w.info("beforeMount",v),this._g_isKeepAlive||le(this,"onPageView"),le(this,"bindEvent")},mounted(){ae&&l&&this.$router&&(this._g_routeUnwatch=this.$watch(()=>this.$route,(y,k)=>{var S;y&&k&&y.path===k.path&&((S=this._g_debouncedPageView)==null||S.call(this,k,y))},{immediate:!1,deep:!0}))},beforeDestroy(){ae&&(this._g_isKeepAlive||le(this,"onPageLeave"))},destroyed(){ae&&(w.info("destroyed",v),this._g_routeUnwatch&&this._g_routeUnwatch(),this._g_debouncedPageView&&this._g_debouncedPageView.cancel&&this._g_debouncedPageView.cancel(),le(this,"unbindEvent"),le(this,"unsubInterceptor"))},activated(){ae&&(w.info("activated",v),this.__g_is_deactive=!1,le(this,lt,{view_type:Le.PAGE_OPEN}),le(this,"bindEvent"))},deactivated(){ae&&(w.info("deactivated",v),this.__g_is_deactive=!0,le(this,"onPageLeave",{leave_type:Le.PAGE_CLOSE}),le(this,"unbindEvent"))},methods:{[Ae(lt)](y={}){qe(k=>{k.track(Ke.Pageview,M(_e(M({},v),{view_type:Le.PAGE_OPEN,spm:p,timestamp:Date.now()}),y))})},[Ae("onPageLeave")](y={}){qe(k=>{k.track(Ke.Pageleave,M(_e(M({},v),{leave_type:Le.PAGE_CLOSE,spm:p,timestamp:Date.now()}),y))})},[Ae("unsubInterceptor")](){},[Ae("unbindEvent")](){f.unbindEvents()},[Ae("bindEvent")](){f.bindEvents()},[Ae(Nt)](){le(this,"onPageLeave",{leave_type:Le.PAGE_QUERY_CHANGE}),setTimeout(()=>{le(this,lt,{view_type:Le.PAGE_QUERY_CHANGE})})}}}),s}var Qa=class{constructor(){j(this,"_onBeforeUnload");j(this,"_onPageHide");j(this,"_onPageShow");j(this,"_onVisibilityChange");j(this,"_onPageUnload");j(this,"_pageEvent");j(this,"_isInit",!1);j(this,"_options",{autoTrack:!0})}init(t){Object.assign(this._options,t),this.initCallback(),this._isInit||(this._isInit=!0,this.initTrackEvent())}getGalileo(){return window._galileo}setOption(t){Object.assign(this._options,t)}initTrackEvent(){const{_options:t}=this;t.autoTrack&&this.onDomReady(()=>{this.onPageView({view_type:"open"})})}onDomReady(t){document.readyState!=="loading"?t():window.addEventListener("DOMContentLoaded",t,!1)}initCallback(){var t;(t=this._pageEvent)==null||t.destroy(),this._pageEvent=new yi;const e="onPageView";this._pageEvent.subscribe(e,e,i=>{this.onPageView(L({},i))});const n="onPageLeave";this._pageEvent.subscribe(n,n,i=>{this.onPageLeave(L({},i))}),this._pageEvent.bindEvents()}onPageView(t={}){const e=this._options,n=e.spm,i=this.getGalileo();i==null||i.track("$WebPageView",L(de(L({},e),{view_type:"open",spm:n,timestamp:Date.now()}),t))}onPageLeave(t={}){const e=this._options,n=e.spm,i=this.getGalileo();i==null||i.track("$WebPageLeave",L(de(L({},e),{leave_type:"close",spm:n,timestamp:Date.now()}),t))}destroy(){var t;(t=this._pageEvent)==null||t.destroy()}};function Ka(t){const e=new Qa;return e.init(t),e}if(!window.Galileo){const t=new ga;t.PageTracker=Wa,t.createPageTracker=Ka,window.Galileo=t,window._galileo=t}var ct=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};function za(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function ut(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Dn={exports:{}};/*!
    localForage -- Offline Storage, Improved
    Version 1.10.0
    https://localforage.github.io/localForage
    (c) 2013-2017 Mozilla, Apache License 2.0
*/(function(t,e){(function(n){t.exports=n()})(function(){return function n(i,s,a){function r(v,p){if(!s[v]){if(!i[v]){var f=typeof ut=="function"&&ut;if(!p&&f)return f(v,!0);if(l)return l(v,!0);var m=new Error("Cannot find module '"+v+"'");throw m.code="MODULE_NOT_FOUND",m}var w=s[v]={exports:{}};i[v][0].call(w.exports,function(y){var k=i[v][1][y];return r(k||y)},w,w.exports,n,i,s,a)}return s[v].exports}for(var l=typeof ut=="function"&&ut,u=0;u<a.length;u++)r(a[u]);return r}({1:[function(n,i,s){(function(a){var r=a.MutationObserver||a.WebKitMutationObserver,l;if(r){var u=0,v=new r(y),p=a.document.createTextNode("");v.observe(p,{characterData:!0}),l=function(){p.data=u=++u%2}}else if(!a.setImmediate&&typeof a.MessageChannel!="undefined"){var f=new a.MessageChannel;f.port1.onmessage=y,l=function(){f.port2.postMessage(0)}}else"document"in a&&"onreadystatechange"in a.document.createElement("script")?l=function(){var S=a.document.createElement("script");S.onreadystatechange=function(){y(),S.onreadystatechange=null,S.parentNode.removeChild(S),S=null},a.document.documentElement.appendChild(S)}:l=function(){setTimeout(y,0)};var m,w=[];function y(){m=!0;for(var S,C,N=w.length;N;){for(C=w,w=[],S=-1;++S<N;)C[S]();N=w.length}m=!1}i.exports=k;function k(S){w.push(S)===1&&!m&&l()}}).call(this,typeof ct!="undefined"?ct:typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{}],2:[function(n,i,s){var a=n(1);function r(){}var l={},u=["REJECTED"],v=["FULFILLED"],p=["PENDING"];i.exports=f;function f(O){if(typeof O!="function")throw new TypeError("resolver must be a function");this.state=p,this.queue=[],this.outcome=void 0,O!==r&&k(this,O)}f.prototype.catch=function(O){return this.then(null,O)},f.prototype.then=function(O,A){if(typeof O!="function"&&this.state===v||typeof A!="function"&&this.state===u)return this;var T=new this.constructor(r);if(this.state!==p){var J=this.state===v?O:A;w(T,J,this.outcome)}else this.queue.push(new m(T,O,A));return T};function m(O,A,T){this.promise=O,typeof A=="function"&&(this.onFulfilled=A,this.callFulfilled=this.otherCallFulfilled),typeof T=="function"&&(this.onRejected=T,this.callRejected=this.otherCallRejected)}m.prototype.callFulfilled=function(O){l.resolve(this.promise,O)},m.prototype.otherCallFulfilled=function(O){w(this.promise,this.onFulfilled,O)},m.prototype.callRejected=function(O){l.reject(this.promise,O)},m.prototype.otherCallRejected=function(O){w(this.promise,this.onRejected,O)};function w(O,A,T){a(function(){var J;try{J=A(T)}catch(F){return l.reject(O,F)}J===O?l.reject(O,new TypeError("Cannot resolve promise with itself")):l.resolve(O,J)})}l.resolve=function(O,A){var T=S(y,A);if(T.status==="error")return l.reject(O,T.value);var J=T.value;if(J)k(O,J);else{O.state=v,O.outcome=A;for(var F=-1,Q=O.queue.length;++F<Q;)O.queue[F].callFulfilled(A)}return O},l.reject=function(O,A){O.state=u,O.outcome=A;for(var T=-1,J=O.queue.length;++T<J;)O.queue[T].callRejected(A);return O};function y(O){var A=O&&O.then;if(O&&(typeof O=="object"||typeof O=="function")&&typeof A=="function")return function(){A.apply(O,arguments)}}function k(O,A){var T=!1;function J(ce){T||(T=!0,l.reject(O,ce))}function F(ce){T||(T=!0,l.resolve(O,ce))}function Q(){A(F,J)}var ee=S(Q);ee.status==="error"&&J(ee.value)}function S(O,A){var T={};try{T.value=O(A),T.status="success"}catch(J){T.status="error",T.value=J}return T}f.resolve=C;function C(O){return O instanceof this?O:l.resolve(new this(r),O)}f.reject=N;function N(O){var A=new this(r);return l.reject(A,O)}f.all=Z;function Z(O){var A=this;if(Object.prototype.toString.call(O)!=="[object Array]")return this.reject(new TypeError("must be an array"));var T=O.length,J=!1;if(!T)return this.resolve([]);for(var F=new Array(T),Q=0,ee=-1,ce=new this(r);++ee<T;)ve(O[ee],ee);return ce;function ve(Pe,Be){A.resolve(Pe).then(He,function(be){J||(J=!0,l.reject(ce,be))});function He(be){F[Be]=be,++Q===T&&!J&&(J=!0,l.resolve(ce,F))}}}f.race=B;function B(O){var A=this;if(Object.prototype.toString.call(O)!=="[object Array]")return this.reject(new TypeError("must be an array"));var T=O.length,J=!1;if(!T)return this.resolve([]);for(var F=-1,Q=new this(r);++F<T;)ee(O[F]);return Q;function ee(ce){A.resolve(ce).then(function(ve){J||(J=!0,l.resolve(Q,ve))},function(ve){J||(J=!0,l.reject(Q,ve))})}}},{1:1}],3:[function(n,i,s){(function(a){typeof a.Promise!="function"&&(a.Promise=n(2))}).call(this,typeof ct!="undefined"?ct:typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{2:2}],4:[function(n,i,s){var a=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(o){return typeof o}:function(o){return o&&typeof Symbol=="function"&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o};function r(o,h){if(!(o instanceof h))throw new TypeError("Cannot call a class as a function")}function l(){try{if(typeof indexedDB!="undefined")return indexedDB;if(typeof webkitIndexedDB!="undefined")return webkitIndexedDB;if(typeof mozIndexedDB!="undefined")return mozIndexedDB;if(typeof OIndexedDB!="undefined")return OIndexedDB;if(typeof msIndexedDB!="undefined")return msIndexedDB}catch(o){return}}var u=l();function v(){try{if(!u||!u.open)return!1;var o=typeof openDatabase!="undefined"&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),h=typeof fetch=="function"&&fetch.toString().indexOf("[native code")!==-1;return(!o||h)&&typeof indexedDB!="undefined"&&typeof IDBKeyRange!="undefined"}catch(c){return!1}}function p(o,h){o=o||[],h=h||{};try{return new Blob(o,h)}catch(d){if(d.name!=="TypeError")throw d;for(var c=typeof BlobBuilder!="undefined"?BlobBuilder:typeof MSBlobBuilder!="undefined"?MSBlobBuilder:typeof MozBlobBuilder!="undefined"?MozBlobBuilder:WebKitBlobBuilder,g=new c,_=0;_<o.length;_+=1)g.append(o[_]);return g.getBlob(h.type)}}typeof Promise=="undefined"&&n(3);var f=Promise;function m(o,h){h&&o.then(function(c){h(null,c)},function(c){h(c)})}function w(o,h,c){typeof h=="function"&&o.then(h),typeof c=="function"&&o.catch(c)}function y(o){return typeof o!="string"&&(console.warn(o+" used as a key, but it is not a string."),o=String(o)),o}function k(){if(arguments.length&&typeof arguments[arguments.length-1]=="function")return arguments[arguments.length-1]}var S="local-forage-detect-blob-support",C=void 0,N={},Z=Object.prototype.toString,B="readonly",O="readwrite";function A(o){for(var h=o.length,c=new ArrayBuffer(h),g=new Uint8Array(c),_=0;_<h;_++)g[_]=o.charCodeAt(_);return c}function T(o){return new f(function(h){var c=o.transaction(S,O),g=p([""]);c.objectStore(S).put(g,"key"),c.onabort=function(_){_.preventDefault(),_.stopPropagation(),h(!1)},c.oncomplete=function(){var _=navigator.userAgent.match(/Chrome\/(\d+)/),d=navigator.userAgent.match(/Edge\//);h(d||!_||parseInt(_[1],10)>=43)}}).catch(function(){return!1})}function J(o){return typeof C=="boolean"?f.resolve(C):T(o).then(function(h){return C=h,C})}function F(o){var h=N[o.name],c={};c.promise=new f(function(g,_){c.resolve=g,c.reject=_}),h.deferredOperations.push(c),h.dbReady?h.dbReady=h.dbReady.then(function(){return c.promise}):h.dbReady=c.promise}function Q(o){var h=N[o.name],c=h.deferredOperations.pop();if(c)return c.resolve(),c.promise}function ee(o,h){var c=N[o.name],g=c.deferredOperations.pop();if(g)return g.reject(h),g.promise}function ce(o,h){return new f(function(c,g){if(N[o.name]=N[o.name]||Tn(),o.db)if(h)F(o),o.db.close();else return c(o.db);var _=[o.name];h&&_.push(o.version);var d=u.open.apply(u,_);h&&(d.onupgradeneeded=function(b){var E=d.result;try{E.createObjectStore(o.storeName),b.oldVersion<=1&&E.createObjectStore(S)}catch(I){if(I.name==="ConstraintError")console.warn('The database "'+o.name+'" has been upgraded from version '+b.oldVersion+" to version "+b.newVersion+', but the storage "'+o.storeName+'" already exists.');else throw I}}),d.onerror=function(b){b.preventDefault(),g(d.error)},d.onsuccess=function(){var b=d.result;b.onversionchange=function(E){E.target.close()},c(b),Q(o)}})}function ve(o){return ce(o,!1)}function Pe(o){return ce(o,!0)}function Be(o,h){if(!o.db)return!0;var c=!o.db.objectStoreNames.contains(o.storeName),g=o.version<o.db.version,_=o.version>o.db.version;if(g&&(o.version!==h&&console.warn('The database "'+o.name+`" can't be downgraded from version `+o.db.version+" to version "+o.version+"."),o.version=o.db.version),_||c){if(c){var d=o.db.version+1;d>o.version&&(o.version=d)}return!0}return!1}function He(o){return new f(function(h,c){var g=new FileReader;g.onerror=c,g.onloadend=function(_){var d=btoa(_.target.result||"");h({__local_forage_encoded_blob:!0,data:d,type:o.type})},g.readAsBinaryString(o)})}function be(o){var h=A(atob(o.data));return p([h],{type:o.type})}function ze(o){return o&&o.__local_forage_encoded_blob}function Xa(o){var h=this,c=h._initReady().then(function(){var g=N[h._dbInfo.name];if(g&&g.dbReady)return g.dbReady});return w(c,o,o),c}function Za(o){F(o);for(var h=N[o.name],c=h.forages,g=0;g<c.length;g++){var _=c[g];_._dbInfo.db&&(_._dbInfo.db.close(),_._dbInfo.db=null)}return o.db=null,ve(o).then(function(d){return o.db=d,Be(o)?Pe(o):d}).then(function(d){o.db=h.db=d;for(var b=0;b<c.length;b++)c[b]._dbInfo.db=d}).catch(function(d){throw ee(o,d),d})}function we(o,h,c,g){g===void 0&&(g=1);try{var _=o.db.transaction(o.storeName,h);c(null,_)}catch(d){if(g>0&&(!o.db||d.name==="InvalidStateError"||d.name==="NotFoundError"))return f.resolve().then(function(){if(!o.db||d.name==="NotFoundError"&&!o.db.objectStoreNames.contains(o.storeName)&&o.version<=o.db.version)return o.db&&(o.version=o.db.version+1),Pe(o)}).then(function(){return Za(o).then(function(){we(o,h,c,g-1)})}).catch(c);c(d)}}function Tn(){return{forages:[],db:null,dbReady:null,deferredOperations:[]}}function eo(o){var h=this,c={db:null};if(o)for(var g in o)c[g]=o[g];var _=N[c.name];_||(_=Tn(),N[c.name]=_),_.forages.push(h),h._initReady||(h._initReady=h.ready,h.ready=Xa);var d=[];function b(){return f.resolve()}for(var E=0;E<_.forages.length;E++){var I=_.forages[E];I!==h&&d.push(I._initReady().catch(b))}var P=_.forages.slice(0);return f.all(d).then(function(){return c.db=_.db,ve(c)}).then(function(x){return c.db=x,Be(c,h._defaultConfig.version)?Pe(c):x}).then(function(x){c.db=_.db=x,h._dbInfo=c;for(var D=0;D<P.length;D++){var U=P[D];U!==h&&(U._dbInfo.db=c.db,U._dbInfo.version=c.version)}})}function to(o,h){var c=this;o=y(o);var g=new f(function(_,d){c.ready().then(function(){we(c._dbInfo,B,function(b,E){if(b)return d(b);try{var I=E.objectStore(c._dbInfo.storeName),P=I.get(o);P.onsuccess=function(){var x=P.result;x===void 0&&(x=null),ze(x)&&(x=be(x)),_(x)},P.onerror=function(){d(P.error)}}catch(x){d(x)}})}).catch(d)});return m(g,h),g}function no(o,h){var c=this,g=new f(function(_,d){c.ready().then(function(){we(c._dbInfo,B,function(b,E){if(b)return d(b);try{var I=E.objectStore(c._dbInfo.storeName),P=I.openCursor(),x=1;P.onsuccess=function(){var D=P.result;if(D){var U=D.value;ze(U)&&(U=be(U));var H=o(U,D.key,x++);H!==void 0?_(H):D.continue()}else _()},P.onerror=function(){d(P.error)}}catch(D){d(D)}})}).catch(d)});return m(g,h),g}function io(o,h,c){var g=this;o=y(o);var _=new f(function(d,b){var E;g.ready().then(function(){return E=g._dbInfo,Z.call(h)==="[object Blob]"?J(E.db).then(function(I){return I?h:He(h)}):h}).then(function(I){we(g._dbInfo,O,function(P,x){if(P)return b(P);try{var D=x.objectStore(g._dbInfo.storeName);I===null&&(I=void 0);var U=D.put(I,o);x.oncomplete=function(){I===void 0&&(I=null),d(I)},x.onabort=x.onerror=function(){var H=U.error?U.error:U.transaction.error;b(H)}}catch(H){b(H)}})}).catch(b)});return m(_,c),_}function so(o,h){var c=this;o=y(o);var g=new f(function(_,d){c.ready().then(function(){we(c._dbInfo,O,function(b,E){if(b)return d(b);try{var I=E.objectStore(c._dbInfo.storeName),P=I.delete(o);E.oncomplete=function(){_()},E.onerror=function(){d(P.error)},E.onabort=function(){var x=P.error?P.error:P.transaction.error;d(x)}}catch(x){d(x)}})}).catch(d)});return m(g,h),g}function ao(o){var h=this,c=new f(function(g,_){h.ready().then(function(){we(h._dbInfo,O,function(d,b){if(d)return _(d);try{var E=b.objectStore(h._dbInfo.storeName),I=E.clear();b.oncomplete=function(){g()},b.onabort=b.onerror=function(){var P=I.error?I.error:I.transaction.error;_(P)}}catch(P){_(P)}})}).catch(_)});return m(c,o),c}function oo(o){var h=this,c=new f(function(g,_){h.ready().then(function(){we(h._dbInfo,B,function(d,b){if(d)return _(d);try{var E=b.objectStore(h._dbInfo.storeName),I=E.count();I.onsuccess=function(){g(I.result)},I.onerror=function(){_(I.error)}}catch(P){_(P)}})}).catch(_)});return m(c,o),c}function ro(o,h){var c=this,g=new f(function(_,d){if(o<0){_(null);return}c.ready().then(function(){we(c._dbInfo,B,function(b,E){if(b)return d(b);try{var I=E.objectStore(c._dbInfo.storeName),P=!1,x=I.openKeyCursor();x.onsuccess=function(){var D=x.result;if(!D){_(null);return}o===0||P?_(D.key):(P=!0,D.advance(o))},x.onerror=function(){d(x.error)}}catch(D){d(D)}})}).catch(d)});return m(g,h),g}function lo(o){var h=this,c=new f(function(g,_){h.ready().then(function(){we(h._dbInfo,B,function(d,b){if(d)return _(d);try{var E=b.objectStore(h._dbInfo.storeName),I=E.openKeyCursor(),P=[];I.onsuccess=function(){var x=I.result;if(!x){g(P);return}P.push(x.key),x.continue()},I.onerror=function(){_(I.error)}}catch(x){_(x)}})}).catch(_)});return m(c,o),c}function co(o,h){h=k.apply(this,arguments);var c=this.config();o=typeof o!="function"&&o||{},o.name||(o.name=o.name||c.name,o.storeName=o.storeName||c.storeName);var g=this,_;if(!o.name)_=f.reject("Invalid arguments");else{var d=o.name===c.name&&g._dbInfo.db,b=d?f.resolve(g._dbInfo.db):ve(o).then(function(E){var I=N[o.name],P=I.forages;I.db=E;for(var x=0;x<P.length;x++)P[x]._dbInfo.db=E;return E});o.storeName?_=b.then(function(E){if(E.objectStoreNames.contains(o.storeName)){var I=E.version+1;F(o);var P=N[o.name],x=P.forages;E.close();for(var D=0;D<x.length;D++){var U=x[D];U._dbInfo.db=null,U._dbInfo.version=I}var H=new f(function(G,ie){var te=u.open(o.name,I);te.onerror=function(me){var Xe=te.result;Xe.close(),ie(me)},te.onupgradeneeded=function(){var me=te.result;me.deleteObjectStore(o.storeName)},te.onsuccess=function(){var me=te.result;me.close(),G(me)}});return H.then(function(G){P.db=G;for(var ie=0;ie<x.length;ie++){var te=x[ie];te._dbInfo.db=G,Q(te._dbInfo)}}).catch(function(G){throw(ee(o,G)||f.resolve()).catch(function(){}),G})}}):_=b.then(function(E){F(o);var I=N[o.name],P=I.forages;E.close();for(var x=0;x<P.length;x++){var D=P[x];D._dbInfo.db=null}var U=new f(function(H,G){var ie=u.deleteDatabase(o.name);ie.onerror=function(){var te=ie.result;te&&te.close(),G(ie.error)},ie.onblocked=function(){console.warn('dropInstance blocked for database "'+o.name+'" until all open connections are closed')},ie.onsuccess=function(){var te=ie.result;te&&te.close(),H(te)}});return U.then(function(H){I.db=H;for(var G=0;G<P.length;G++){var ie=P[G];Q(ie._dbInfo)}}).catch(function(H){throw(ee(o,H)||f.resolve()).catch(function(){}),H})})}return m(_,h),_}var uo={_driver:"asyncStorage",_initStorage:eo,_support:v(),iterate:no,getItem:to,setItem:io,removeItem:so,clear:ao,length:oo,key:ro,keys:lo,dropInstance:co};function ho(){return typeof openDatabase=="function"}var xe="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",fo="~~local_forage_type~",An=/^~~local_forage_type~([^~]+)~/,ht="__lfsc__:",Dt=ht.length,Lt="arbf",Tt="blob",Rn="si08",Bn="ui08",Mn="uic8",jn="si16",qn="si32",Un="ur16",Jn="ui32",Hn="fl32",$n="fl64",Vn=Dt+Lt.length,Fn=Object.prototype.toString;function Gn(o){var h=o.length*.75,c=o.length,g,_=0,d,b,E,I;o[o.length-1]==="="&&(h--,o[o.length-2]==="="&&h--);var P=new ArrayBuffer(h),x=new Uint8Array(P);for(g=0;g<c;g+=4)d=xe.indexOf(o[g]),b=xe.indexOf(o[g+1]),E=xe.indexOf(o[g+2]),I=xe.indexOf(o[g+3]),x[_++]=d<<2|b>>4,x[_++]=(b&15)<<4|E>>2,x[_++]=(E&3)<<6|I&63;return P}function At(o){var h=new Uint8Array(o),c="",g;for(g=0;g<h.length;g+=3)c+=xe[h[g]>>2],c+=xe[(h[g]&3)<<4|h[g+1]>>4],c+=xe[(h[g+1]&15)<<2|h[g+2]>>6],c+=xe[h[g+2]&63];return h.length%3===2?c=c.substring(0,c.length-1)+"=":h.length%3===1&&(c=c.substring(0,c.length-2)+"=="),c}function go(o,h){var c="";if(o&&(c=Fn.call(o)),o&&(c==="[object ArrayBuffer]"||o.buffer&&Fn.call(o.buffer)==="[object ArrayBuffer]")){var g,_=ht;o instanceof ArrayBuffer?(g=o,_+=Lt):(g=o.buffer,c==="[object Int8Array]"?_+=Rn:c==="[object Uint8Array]"?_+=Bn:c==="[object Uint8ClampedArray]"?_+=Mn:c==="[object Int16Array]"?_+=jn:c==="[object Uint16Array]"?_+=Un:c==="[object Int32Array]"?_+=qn:c==="[object Uint32Array]"?_+=Jn:c==="[object Float32Array]"?_+=Hn:c==="[object Float64Array]"?_+=$n:h(new Error("Failed to get type for BinaryArray"))),h(_+At(g))}else if(c==="[object Blob]"){var d=new FileReader;d.onload=function(){var b=fo+o.type+"~"+At(this.result);h(ht+Tt+b)},d.readAsArrayBuffer(o)}else try{h(JSON.stringify(o))}catch(b){console.error("Couldn't convert value into a JSON string: ",o),h(null,b)}}function _o(o){if(o.substring(0,Dt)!==ht)return JSON.parse(o);var h=o.substring(Vn),c=o.substring(Dt,Vn),g;if(c===Tt&&An.test(h)){var _=h.match(An);g=_[1],h=h.substring(_[0].length)}var d=Gn(h);switch(c){case Lt:return d;case Tt:return p([d],{type:g});case Rn:return new Int8Array(d);case Bn:return new Uint8Array(d);case Mn:return new Uint8ClampedArray(d);case jn:return new Int16Array(d);case Un:return new Uint16Array(d);case qn:return new Int32Array(d);case Jn:return new Uint32Array(d);case Hn:return new Float32Array(d);case $n:return new Float64Array(d);default:throw new Error("Unkown type: "+c)}}var Rt={serialize:go,deserialize:_o,stringToBuffer:Gn,bufferToString:At};function Wn(o,h,c,g){o.executeSql("CREATE TABLE IF NOT EXISTS "+h.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],c,g)}function vo(o){var h=this,c={db:null};if(o)for(var g in o)c[g]=typeof o[g]!="string"?o[g].toString():o[g];var _=new f(function(d,b){try{c.db=openDatabase(c.name,String(c.version),c.description,c.size)}catch(E){return b(E)}c.db.transaction(function(E){Wn(E,c,function(){h._dbInfo=c,d()},function(I,P){b(P)})},b)});return c.serializer=Rt,_}function Ce(o,h,c,g,_,d){o.executeSql(c,g,_,function(b,E){E.code===E.SYNTAX_ERR?b.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[h.storeName],function(I,P){P.rows.length?d(I,E):Wn(I,h,function(){I.executeSql(c,g,_,d)},d)},d):d(b,E)},d)}function mo(o,h){var c=this;o=y(o);var g=new f(function(_,d){c.ready().then(function(){var b=c._dbInfo;b.db.transaction(function(E){Ce(E,b,"SELECT * FROM "+b.storeName+" WHERE key = ? LIMIT 1",[o],function(I,P){var x=P.rows.length?P.rows.item(0).value:null;x&&(x=b.serializer.deserialize(x)),_(x)},function(I,P){d(P)})})}).catch(d)});return m(g,h),g}function po(o,h){var c=this,g=new f(function(_,d){c.ready().then(function(){var b=c._dbInfo;b.db.transaction(function(E){Ce(E,b,"SELECT * FROM "+b.storeName,[],function(I,P){for(var x=P.rows,D=x.length,U=0;U<D;U++){var H=x.item(U),G=H.value;if(G&&(G=b.serializer.deserialize(G)),G=o(G,H.key,U+1),G!==void 0){_(G);return}}_()},function(I,P){d(P)})})}).catch(d)});return m(g,h),g}function Qn(o,h,c,g){var _=this;o=y(o);var d=new f(function(b,E){_.ready().then(function(){h===void 0&&(h=null);var I=h,P=_._dbInfo;P.serializer.serialize(h,function(x,D){D?E(D):P.db.transaction(function(U){Ce(U,P,"INSERT OR REPLACE INTO "+P.storeName+" (key, value) VALUES (?, ?)",[o,x],function(){b(I)},function(H,G){E(G)})},function(U){if(U.code===U.QUOTA_ERR){if(g>0){b(Qn.apply(_,[o,I,c,g-1]));return}E(U)}})})}).catch(E)});return m(d,c),d}function yo(o,h,c){return Qn.apply(this,[o,h,c,1])}function bo(o,h){var c=this;o=y(o);var g=new f(function(_,d){c.ready().then(function(){var b=c._dbInfo;b.db.transaction(function(E){Ce(E,b,"DELETE FROM "+b.storeName+" WHERE key = ?",[o],function(){_()},function(I,P){d(P)})})}).catch(d)});return m(g,h),g}function wo(o){var h=this,c=new f(function(g,_){h.ready().then(function(){var d=h._dbInfo;d.db.transaction(function(b){Ce(b,d,"DELETE FROM "+d.storeName,[],function(){g()},function(E,I){_(I)})})}).catch(_)});return m(c,o),c}function So(o){var h=this,c=new f(function(g,_){h.ready().then(function(){var d=h._dbInfo;d.db.transaction(function(b){Ce(b,d,"SELECT COUNT(key) as c FROM "+d.storeName,[],function(E,I){var P=I.rows.item(0).c;g(P)},function(E,I){_(I)})})}).catch(_)});return m(c,o),c}function Eo(o,h){var c=this,g=new f(function(_,d){c.ready().then(function(){var b=c._dbInfo;b.db.transaction(function(E){Ce(E,b,"SELECT key FROM "+b.storeName+" WHERE id = ? LIMIT 1",[o+1],function(I,P){var x=P.rows.length?P.rows.item(0).key:null;_(x)},function(I,P){d(P)})})}).catch(d)});return m(g,h),g}function Oo(o){var h=this,c=new f(function(g,_){h.ready().then(function(){var d=h._dbInfo;d.db.transaction(function(b){Ce(b,d,"SELECT key FROM "+d.storeName,[],function(E,I){for(var P=[],x=0;x<I.rows.length;x++)P.push(I.rows.item(x).key);g(P)},function(E,I){_(I)})})}).catch(_)});return m(c,o),c}function ko(o){return new f(function(h,c){o.transaction(function(g){g.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],function(_,d){for(var b=[],E=0;E<d.rows.length;E++)b.push(d.rows.item(E).name);h({db:o,storeNames:b})},function(_,d){c(d)})},function(g){c(g)})})}function Io(o,h){h=k.apply(this,arguments);var c=this.config();o=typeof o!="function"&&o||{},o.name||(o.name=o.name||c.name,o.storeName=o.storeName||c.storeName);var g=this,_;return o.name?_=new f(function(d){var b;o.name===c.name?b=g._dbInfo.db:b=openDatabase(o.name,"","",0),o.storeName?d({db:b,storeNames:[o.storeName]}):d(ko(b))}).then(function(d){return new f(function(b,E){d.db.transaction(function(I){function P(H){return new f(function(G,ie){I.executeSql("DROP TABLE IF EXISTS "+H,[],function(){G()},function(te,me){ie(me)})})}for(var x=[],D=0,U=d.storeNames.length;D<U;D++)x.push(P(d.storeNames[D]));f.all(x).then(function(){b()}).catch(function(H){E(H)})},function(I){E(I)})})}):_=f.reject("Invalid arguments"),m(_,h),_}var Po={_driver:"webSQLStorage",_initStorage:vo,_support:ho(),iterate:po,getItem:mo,setItem:yo,removeItem:bo,clear:wo,length:So,key:Eo,keys:Oo,dropInstance:Io};function xo(){try{return typeof localStorage!="undefined"&&"setItem"in localStorage&&!!localStorage.setItem}catch(o){return!1}}function Kn(o,h){var c=o.name+"/";return o.storeName!==h.storeName&&(c+=o.storeName+"/"),c}function Co(){var o="_localforage_support_test";try{return localStorage.setItem(o,!0),localStorage.removeItem(o),!1}catch(h){return!0}}function No(){return!Co()||localStorage.length>0}function Do(o){var h=this,c={};if(o)for(var g in o)c[g]=o[g];return c.keyPrefix=Kn(o,h._defaultConfig),No()?(h._dbInfo=c,c.serializer=Rt,f.resolve()):f.reject()}function Lo(o){var h=this,c=h.ready().then(function(){for(var g=h._dbInfo.keyPrefix,_=localStorage.length-1;_>=0;_--){var d=localStorage.key(_);d.indexOf(g)===0&&localStorage.removeItem(d)}});return m(c,o),c}function To(o,h){var c=this;o=y(o);var g=c.ready().then(function(){var _=c._dbInfo,d=localStorage.getItem(_.keyPrefix+o);return d&&(d=_.serializer.deserialize(d)),d});return m(g,h),g}function Ao(o,h){var c=this,g=c.ready().then(function(){for(var _=c._dbInfo,d=_.keyPrefix,b=d.length,E=localStorage.length,I=1,P=0;P<E;P++){var x=localStorage.key(P);if(x.indexOf(d)===0){var D=localStorage.getItem(x);if(D&&(D=_.serializer.deserialize(D)),D=o(D,x.substring(b),I++),D!==void 0)return D}}});return m(g,h),g}function Ro(o,h){var c=this,g=c.ready().then(function(){var _=c._dbInfo,d;try{d=localStorage.key(o)}catch(b){d=null}return d&&(d=d.substring(_.keyPrefix.length)),d});return m(g,h),g}function Bo(o){var h=this,c=h.ready().then(function(){for(var g=h._dbInfo,_=localStorage.length,d=[],b=0;b<_;b++){var E=localStorage.key(b);E.indexOf(g.keyPrefix)===0&&d.push(E.substring(g.keyPrefix.length))}return d});return m(c,o),c}function Mo(o){var h=this,c=h.keys().then(function(g){return g.length});return m(c,o),c}function jo(o,h){var c=this;o=y(o);var g=c.ready().then(function(){var _=c._dbInfo;localStorage.removeItem(_.keyPrefix+o)});return m(g,h),g}function qo(o,h,c){var g=this;o=y(o);var _=g.ready().then(function(){h===void 0&&(h=null);var d=h;return new f(function(b,E){var I=g._dbInfo;I.serializer.serialize(h,function(P,x){if(x)E(x);else try{localStorage.setItem(I.keyPrefix+o,P),b(d)}catch(D){(D.name==="QuotaExceededError"||D.name==="NS_ERROR_DOM_QUOTA_REACHED")&&E(D),E(D)}})})});return m(_,c),_}function Uo(o,h){if(h=k.apply(this,arguments),o=typeof o!="function"&&o||{},!o.name){var c=this.config();o.name=o.name||c.name,o.storeName=o.storeName||c.storeName}var g=this,_;return o.name?_=new f(function(d){o.storeName?d(Kn(o,g._defaultConfig)):d(o.name+"/")}).then(function(d){for(var b=localStorage.length-1;b>=0;b--){var E=localStorage.key(b);E.indexOf(d)===0&&localStorage.removeItem(E)}}):_=f.reject("Invalid arguments"),m(_,h),_}var Jo={_driver:"localStorageWrapper",_initStorage:Do,_support:xo(),iterate:Ao,getItem:To,setItem:qo,removeItem:jo,clear:Lo,length:Mo,key:Ro,keys:Bo,dropInstance:Uo},Ho=function(h,c){return h===c||typeof h=="number"&&typeof c=="number"&&isNaN(h)&&isNaN(c)},$o=function(h,c){for(var g=h.length,_=0;_<g;){if(Ho(h[_],c))return!0;_++}return!1},zn=Array.isArray||function(o){return Object.prototype.toString.call(o)==="[object Array]"},Ye={},Yn={},$e={INDEXEDDB:uo,WEBSQL:Po,LOCALSTORAGE:Jo},Vo=[$e.INDEXEDDB._driver,$e.WEBSQL._driver,$e.LOCALSTORAGE._driver],dt=["dropInstance"],Bt=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(dt),Fo={description:"",driver:Vo.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function Go(o,h){o[h]=function(){var c=arguments;return o.ready().then(function(){return o[h].apply(o,c)})}}function Mt(){for(var o=1;o<arguments.length;o++){var h=arguments[o];if(h)for(var c in h)h.hasOwnProperty(c)&&(zn(h[c])?arguments[0][c]=h[c].slice():arguments[0][c]=h[c])}return arguments[0]}var Wo=function(){function o(h){r(this,o);for(var c in $e)if($e.hasOwnProperty(c)){var g=$e[c],_=g._driver;this[c]=_,Ye[_]||this.defineDriver(g)}this._defaultConfig=Mt({},Fo),this._config=Mt({},this._defaultConfig,h),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch(function(){})}return o.prototype.config=function(c){if((typeof c=="undefined"?"undefined":a(c))==="object"){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var g in c){if(g==="storeName"&&(c[g]=c[g].replace(/\W/g,"_")),g==="version"&&typeof c[g]!="number")return new Error("Database version must be a number.");this._config[g]=c[g]}return"driver"in c&&c.driver?this.setDriver(this._config.driver):!0}else return typeof c=="string"?this._config[c]:this._config},o.prototype.defineDriver=function(c,g,_){var d=new f(function(b,E){try{var I=c._driver,P=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!c._driver){E(P);return}for(var x=Bt.concat("_initStorage"),D=0,U=x.length;D<U;D++){var H=x[D],G=!$o(dt,H);if((G||c[H])&&typeof c[H]!="function"){E(P);return}}var ie=function(){for(var Xe=function(zo){return function(){var Yo=new Error("Method "+zo+" is not implemented by the current driver"),Xn=f.reject(Yo);return m(Xn,arguments[arguments.length-1]),Xn}},jt=0,Ko=dt.length;jt<Ko;jt++){var qt=dt[jt];c[qt]||(c[qt]=Xe(qt))}};ie();var te=function(Xe){Ye[I]&&console.info("Redefining LocalForage driver: "+I),Ye[I]=c,Yn[I]=Xe,b()};"_support"in c?c._support&&typeof c._support=="function"?c._support().then(te,E):te(!!c._support):te(!0)}catch(me){E(me)}});return w(d,g,_),d},o.prototype.driver=function(){return this._driver||null},o.prototype.getDriver=function(c,g,_){var d=Ye[c]?f.resolve(Ye[c]):f.reject(new Error("Driver not found."));return w(d,g,_),d},o.prototype.getSerializer=function(c){var g=f.resolve(Rt);return w(g,c),g},o.prototype.ready=function(c){var g=this,_=g._driverSet.then(function(){return g._ready===null&&(g._ready=g._initDriver()),g._ready});return w(_,c,c),_},o.prototype.setDriver=function(c,g,_){var d=this;zn(c)||(c=[c]);var b=this._getSupportedDrivers(c);function E(){d._config.driver=d.driver()}function I(D){return d._extend(D),E(),d._ready=d._initStorage(d._config),d._ready}function P(D){return function(){var U=0;function H(){for(;U<D.length;){var G=D[U];return U++,d._dbInfo=null,d._ready=null,d.getDriver(G).then(I).catch(H)}E();var ie=new Error("No available storage method found.");return d._driverSet=f.reject(ie),d._driverSet}return H()}}var x=this._driverSet!==null?this._driverSet.catch(function(){return f.resolve()}):f.resolve();return this._driverSet=x.then(function(){var D=b[0];return d._dbInfo=null,d._ready=null,d.getDriver(D).then(function(U){d._driver=U._driver,E(),d._wrapLibraryMethodsWithReady(),d._initDriver=P(b)})}).catch(function(){E();var D=new Error("No available storage method found.");return d._driverSet=f.reject(D),d._driverSet}),w(this._driverSet,g,_),this._driverSet},o.prototype.supports=function(c){return!!Yn[c]},o.prototype._extend=function(c){Mt(this,c)},o.prototype._getSupportedDrivers=function(c){for(var g=[],_=0,d=c.length;_<d;_++){var b=c[_];this.supports(b)&&g.push(b)}return g},o.prototype._wrapLibraryMethodsWithReady=function(){for(var c=0,g=Bt.length;c<g;c++)Go(this,Bt[c])},o.prototype.createInstance=function(c){return new o(c)},o}(),Qo=new Wo;i.exports=Qo},{3:3}]},{},[4])(4)})})(Dn);var Ln=Dn.exports;const Ya=z({__proto__:null,default:za(Ln)},[Ln])});
