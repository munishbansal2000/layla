!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.klk_common=t():e.klk_common=t()}(self,()=>(()=>{var e={"./node_modules/js-cookie/dist/js.cookie.js":function(e){e.exports=function(){"use strict";function e(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)e[r]=n[r]}return e}return function t(n,r){function o(t,o,i){if("undefined"!=typeof document){"number"==typeof(i=e({},r,i)).expires&&(i.expires=new Date(Date.now()+864e5*i.expires)),i.expires&&(i.expires=i.expires.toUTCString()),t=encodeURIComponent(t).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var a="";for(var s in i)i[s]&&(a+="; "+s,!0!==i[s]&&(a+="="+i[s].split(";")[0]));return document.cookie=t+"="+n.write(o,t)+a}}return Object.create({set:o,get:function(e){if("undefined"!=typeof document&&(!arguments.length||e)){for(var t=document.cookie?document.cookie.split("; "):[],r={},o=0;o<t.length;o++){var i=t[o].split("="),a=i.slice(1).join("=");try{var s=decodeURIComponent(i[0]);if(r[s]=n.read(a,s),e===s)break}catch(e){}}return e?r[e]:r}},remove:function(t,n){o(t,"",e({},n,{expires:-1}))},withAttributes:function(n){return t(this.converter,e({},this.attributes,n))},withConverter:function(n){return t(e({},this.converter,n),this.attributes)}},{attributes:{value:Object.freeze(r)},converter:{value:Object.freeze(n)}})}({read:function(e){return'"'===e[0]&&(e=e.slice(1,-1)),e.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(e){return encodeURIComponent(e).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}},{path:"/"})}()}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var i=t[r]={exports:{}};return e[r].call(i.exports,i,i.exports,n),i.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var r={};return(()=>{"use strict";n.r(r),n.d(r,{jsCookie:()=>a(),constant:()=>t,getFbParams:()=>W,event:()=>e,detectSpm:()=>G,clearFacebookTracking:()=>X,getFbp:()=>Q,getFbc:()=>V,session:()=>o});var e={};n.r(e),n.d(e,{PopStateChange:()=>d,PushStateChange:()=>f,ReplaceStateChange:()=>p,ael:()=>c,initHistoryChange:()=>g});var t={};n.r(t),n.d(t,{DefaultOpt:()=>h,GaDefaultOpt:()=>m,IhtDefaultOpt:()=>w,SessionChange:()=>_});var o={};n.r(o),n.d(o,{DefaultOpt:()=>h,GaDefaultOpt:()=>m,IhtDefaultOpt:()=>w,generateSessionId:()=>j,getCurrentSession:()=>M,getCurrentSessionInfo:()=>K,getGaSession:()=>L,getSessionInfo:()=>x,historyChangeEvent:()=>$,initGaSession:()=>U,initIhtSession:()=>F,initSession:()=>R,isValid:()=>D,setSessionInfo:()=>C,updateGaSession:()=>A,updateIhtSession:()=>T});var i=n("./node_modules/js-cookie/dist/js.cookie.js"),a=n.n(i);let s=e=>{try{return e()}catch(e){}},c=window.addEventListener.bind(window),l=!1,u=(e,t)=>{let n=new Event(e);n.args=t,window.dispatchEvent(n)},f="PushStateChange",p="ReplaceStateChange",d="PopStateChange",g=()=>{if(l)return;l=!0;let e=history.pushState,t=history.replaceState;history.pushState=function(...t){return s(()=>u(f,t)),e.call(history,...t)},history.replaceState=function(...e){return s(()=>u(p,e)),t.call(history,...e)},c("popstate",e=>{u(d,[e])})};function y(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){var r;r=n[t],t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r})}return e}function b(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):(function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n})(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}),e}let h={ais:"_auto_init_session",_inner_init:!0,key:"klk_i_sn",renew:!1,cacheTime:18e5},w=b(y({},h),{type:0,ais:"_auto_init_session",key:"klk_i_sn",gaKey:"iht_fe_session_id"}),m=b(y({},h),{type:1,force:!1,ais:"_ga_auto_init_session",key:"klk_ga_sn",gaKey:"fe_session_id"}),_="sessionchange";function v(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){var r;r=n[t],t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r})}return e}let S={},O={renew:!0},k={},j=()=>Math.random().toString().slice(-10),P=(e,t=1)=>{let n=1===t?a().get(e):s(()=>localStorage.getItem(e)),r=n?n.split(".."):["",""];return{session_id:r[0],iht_last_event_time:parseInt(r[1])}},x=e=>{let t=P(e);return D(t)?t:P(e,2)},C=(e,t)=>{let n=[t.session_id,t.iht_last_event_time].join("..");a().set(e,n,{expires:new Date(Date.now()+h.cacheTime)}),s(()=>localStorage.setItem(e,n))},D=(e={})=>{if(!e)return!1;let t=parseInt(e.iht_last_event_time||0),n=Date.now()-t;return e.session_id&&n&&n<=h.cacheTime},I=(e,t)=>{let n=new Event(_);n.args=e,n.changetype=t,window.dispatchEvent(n)},E=e=>{let t=e.key,n=e.renew;try{let r=x(t),o=Date.now();if(D(r)){if(n){let n=r.iht_last_event_time;r.iht_last_event_time=o,o-n>6e4?C(t,r):k[t]||(k[t]=!0,C(t,r),setTimeout(()=>{k[t]=!1},3e3)),I(r,e.type)}}else r={iht_last_event_time:o,session_id:j()},C(t,r),I(r,e.type);return r}catch(e){}},F=(e={})=>{let t=Object.assign({},w,e);if(!1===window[h.ais])return;let n=E(t);return S.iht=n,n},U=(e={})=>{let t=Object.assign({},m,e);if(!1===window[m.ais])return;let n=E(t);return S.ga=n,n},T=(e={})=>F(v({},O,e)),A=(e={})=>U(v({},O,e)),L=(e={})=>{let t=S.ga;return!e.force&&t&&t.session_id?t:U(v({},O,e))},R=()=>{T(O),A(O)},$=()=>{c(f,()=>A()),c(p,()=>A())},K=()=>({ga:L(),iht:F()}),M=()=>({[m.gaKey]:(L()||{}).session_id,[w.gaKey]:(F()||{}).session_id});function G(e){if(e||!G.ok){var t=window,n=document,r="dataLayer",o=console,i="data-spm-page";try{var a=n.querySelector("["+i+"]"),s=t[r]||[];a&&(a=a.dataset.spmPage||"")&&(a=a.split("?")[0])&&s.push({spm:a})&&(t[r]=s)&&(G.ok=!0)}catch(e){o.info(e)}}}let B="klk_fbcp",H={fbc:null,fbp:null};function z(){return"undefined"!=typeof window}function J(){if(!z())return"1";let e=window.location.hostname;if("localhost"===e||/^\d+\.\d+\.\d+\.\d+$/.test(e))return"1";let t=e.split(".");return t.length<=1?"1":String(t.length-1)}function N(){return Date.now()}function q(e){let t=window.dataLayer||[];window.dataLayer=t,t.push(e)}function V(){return W().klk_fbc||null}function Q(){return W().klk_fbp||null}function W(){if(!z())return{};if(!H.fbc||!H.fbp){var e,t;let n=function(e){if(!z()||!window.localStorage)return null;try{let t=localStorage.getItem(e);if(!t)return null;let n=JSON.parse(t);if(Date.now()>n.expiry)return localStorage.removeItem(e),null;return n.value}catch(t){return console.error(`Failed to read ${e} from localStorage:`,t),null}}(B);H.fbc=null!=(e=null==n?void 0:n.fbc)?e:null,H.fbp=null!=(t=null==n?void 0:n.fbp)?t:null}return{klk_fbc:H.fbc,klk_fbp:H.fbp}}function X(){if(z()&&window.localStorage)try{localStorage.removeItem(B)}catch(e){console.error("Failed to clear Facebook tracking data:",e)}}s(()=>{let e,t;e=window.dataLayer||[],window.dataLayer=e,e.push({site_name:location.host,user_agent:navigator.userAgent}),t={},window.addEventListener(_,e=>{let n=e.args,r=e.changetype==m.type?m.gaKey:w.gaKey,o=n&&n.session_id;o&&t[r]!==o&&(window.dataLayer.push({[r]:o}),t[r]=o)}),R(),g(),$()});try{!function(){let e,t,n,r,o,i,s,c;if(!z())return;let l=z()?new URLSearchParams(window.location.search).get("fbclid"):null;l&&(e=N(),t=J(),n=e||N(),r=`fb.${t}.${n}.${l}`,o=J(),i=e||N(),s=Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15),c=`fb.${o}.${i}.${s}`,function(e,t,n){if(!z()||!window.localStorage)return;let r=Date.now();try{localStorage.setItem(e,JSON.stringify({value:t,expiry:r+7776e6}))}catch(t){console.error(`Failed to save ${e} to localStorage:`,t)}}(B,{fbc:r,fbp:c},0),H.fbc=r,H.fbp=c),q(W()),function(){try{let e=a().get("user_id");if(!e)return"";(function(e,t){if(!window.crypto||!window.crypto.subtle||"undefined"==typeof TextEncoder)return Promise.resolve("");let n=new TextEncoder().encode(e);return crypto.subtle.digest("SHA-256",n).then(e=>Uint8Array.prototype.toHex?new Uint8Array(e).toHex():Array.from(new Uint8Array(e)).map(e=>e.toString(16).padStart(2,"0")).join(""))})(e).then(e=>{q({encoded_user_id:e})})}catch(e){console.error("Failed to hash user ID:",e)}}()}()}catch(e){console.error("Failed to initialize Facebook tracking:",e)}})(),r})());