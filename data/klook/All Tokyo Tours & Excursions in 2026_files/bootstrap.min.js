var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(f,k,p){if(f==Array.prototype||f==Object.prototype)return f;f[k]=p.value;return f};
$jscomp.getGlobal=function(f){f=["object"==typeof globalThis&&globalThis,f,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var k=0;k<f.length;++k){var p=f[k];if(p&&p.Math==Math)return p}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};
$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(f,k){var p=$jscomp.propertyToPolyfillSymbol[k];if(null==p)return f[k];p=f[p];return void 0!==p?p:f[k]};$jscomp.polyfill=function(f,k,p,q){k&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(f,k,p,q):$jscomp.polyfillUnisolated(f,k,p,q))};
$jscomp.polyfillUnisolated=function(f,k,p,q){p=$jscomp.global;f=f.split(".");for(q=0;q<f.length-1;q++){var r=f[q];if(!(r in p))return;p=p[r]}f=f[f.length-1];q=p[f];k=k(q);k!=q&&null!=k&&$jscomp.defineProperty(p,f,{configurable:!0,writable:!0,value:k})};
$jscomp.polyfillIsolated=function(f,k,p,q){var r=f.split(".");f=1===r.length;q=r[0];q=!f&&q in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var K=0;K<r.length-1;K++){var E=r[K];if(!(E in q))return;q=q[E]}r=r[r.length-1];p=$jscomp.IS_SYMBOL_NATIVE&&"es6"===p?q[r]:null;k=k(p);null!=k&&(f?$jscomp.defineProperty($jscomp.polyfills,r,{configurable:!0,writable:!0,value:k}):k!==p&&(void 0===$jscomp.propertyToPolyfillSymbol[r]&&(p=1E9*Math.random()>>>0,$jscomp.propertyToPolyfillSymbol[r]=$jscomp.IS_SYMBOL_NATIVE?
$jscomp.global.Symbol(r):$jscomp.POLYFILL_PREFIX+p+"$"+r),$jscomp.defineProperty(q,$jscomp.propertyToPolyfillSymbol[r],{configurable:!0,writable:!0,value:k})))};$jscomp.underscoreProtoCanBeSet=function(){var f={a:!0},k={};try{return k.__proto__=f,k.a}catch(p){}return!1};
$jscomp.setPrototypeOf=$jscomp.TRUST_ES6_POLYFILLS&&"function"==typeof Object.setPrototypeOf?Object.setPrototypeOf:$jscomp.underscoreProtoCanBeSet()?function(f,k){f.__proto__=k;if(f.__proto__!==k)throw new TypeError(f+" is not extensible");return f}:null;$jscomp.arrayIteratorImpl=function(f){var k=0;return function(){return k<f.length?{done:!1,value:f[k++]}:{done:!0}}};$jscomp.arrayIterator=function(f){return{next:$jscomp.arrayIteratorImpl(f)}};
$jscomp.makeIterator=function(f){var k="undefined"!=typeof Symbol&&Symbol.iterator&&f[Symbol.iterator];return k?k.call(f):$jscomp.arrayIterator(f)};$jscomp.generator={};$jscomp.generator.ensureIteratorResultIsObject_=function(f){if(!(f instanceof Object))throw new TypeError("Iterator result "+f+" is not an object");};
$jscomp.generator.Context=function(){this.isRunning_=!1;this.yieldAllIterator_=null;this.yieldResult=void 0;this.nextAddress=1;this.finallyAddress_=this.catchAddress_=0;this.finallyContexts_=this.abruptCompletion_=null};$jscomp.generator.Context.prototype.start_=function(){if(this.isRunning_)throw new TypeError("Generator is already running");this.isRunning_=!0};$jscomp.generator.Context.prototype.stop_=function(){this.isRunning_=!1};
$jscomp.generator.Context.prototype.jumpToErrorHandler_=function(){this.nextAddress=this.catchAddress_||this.finallyAddress_};$jscomp.generator.Context.prototype.next_=function(f){this.yieldResult=f};$jscomp.generator.Context.prototype.throw_=function(f){this.abruptCompletion_={exception:f,isException:!0};this.jumpToErrorHandler_()};$jscomp.generator.Context.prototype.return=function(f){this.abruptCompletion_={return:f};this.nextAddress=this.finallyAddress_};
$jscomp.generator.Context.prototype.jumpThroughFinallyBlocks=function(f){this.abruptCompletion_={jumpTo:f};this.nextAddress=this.finallyAddress_};$jscomp.generator.Context.prototype.yield=function(f,k){this.nextAddress=k;return{value:f}};$jscomp.generator.Context.prototype.yieldAll=function(f,k){f=$jscomp.makeIterator(f);var p=f.next();$jscomp.generator.ensureIteratorResultIsObject_(p);if(p.done)this.yieldResult=p.value,this.nextAddress=k;else return this.yieldAllIterator_=f,this.yield(p.value,k)};
$jscomp.generator.Context.prototype.jumpTo=function(f){this.nextAddress=f};$jscomp.generator.Context.prototype.jumpToEnd=function(){this.nextAddress=0};$jscomp.generator.Context.prototype.setCatchFinallyBlocks=function(f,k){this.catchAddress_=f;void 0!=k&&(this.finallyAddress_=k)};$jscomp.generator.Context.prototype.setFinallyBlock=function(f){this.catchAddress_=0;this.finallyAddress_=f||0};$jscomp.generator.Context.prototype.leaveTryBlock=function(f,k){this.nextAddress=f;this.catchAddress_=k||0};
$jscomp.generator.Context.prototype.enterCatchBlock=function(f){this.catchAddress_=f||0;f=this.abruptCompletion_.exception;this.abruptCompletion_=null;return f};$jscomp.generator.Context.prototype.enterFinallyBlock=function(f,k,p){p?this.finallyContexts_[p]=this.abruptCompletion_:this.finallyContexts_=[this.abruptCompletion_];this.catchAddress_=f||0;this.finallyAddress_=k||0};
$jscomp.generator.Context.prototype.leaveFinallyBlock=function(f,k){k=this.finallyContexts_.splice(k||0)[0];if(k=this.abruptCompletion_=this.abruptCompletion_||k){if(k.isException)return this.jumpToErrorHandler_();void 0!=k.jumpTo&&this.finallyAddress_<k.jumpTo?(this.nextAddress=k.jumpTo,this.abruptCompletion_=null):this.nextAddress=this.finallyAddress_}else this.nextAddress=f};$jscomp.generator.Context.prototype.forIn=function(f){return new $jscomp.generator.Context.PropertyIterator(f)};
$jscomp.generator.Context.PropertyIterator=function(f){this.object_=f;this.properties_=[];for(var k in f)this.properties_.push(k);this.properties_.reverse()};$jscomp.generator.Context.PropertyIterator.prototype.getNext=function(){for(;0<this.properties_.length;){var f=this.properties_.pop();if(f in this.object_)return f}return null};$jscomp.generator.Engine_=function(f){this.context_=new $jscomp.generator.Context;this.program_=f};
$jscomp.generator.Engine_.prototype.next_=function(f){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_.next,f,this.context_.next_);this.context_.next_(f);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.return_=function(f){this.context_.start_();var k=this.context_.yieldAllIterator_;if(k)return this.yieldAllStep_("return"in k?k["return"]:function(p){return{value:p,done:!0}},f,this.context_.return);this.context_.return(f);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.throw_=function(f){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_["throw"],f,this.context_.next_);this.context_.throw_(f);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.yieldAllStep_=function(f,k,p){try{var q=f.call(this.context_.yieldAllIterator_,k);$jscomp.generator.ensureIteratorResultIsObject_(q);if(!q.done)return this.context_.stop_(),q;var r=q.value}catch(K){return this.context_.yieldAllIterator_=null,this.context_.throw_(K),this.nextStep_()}this.context_.yieldAllIterator_=null;p.call(this.context_,r);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.nextStep_=function(){for(;this.context_.nextAddress;)try{var f=this.program_(this.context_);if(f)return this.context_.stop_(),{value:f.value,done:!1}}catch(k){this.context_.yieldResult=void 0,this.context_.throw_(k)}this.context_.stop_();if(this.context_.abruptCompletion_){f=this.context_.abruptCompletion_;this.context_.abruptCompletion_=null;if(f.isException)throw f.exception;return{value:f.return,done:!0}}return{value:void 0,done:!0}};
$jscomp.generator.Generator_=function(f){this.next=function(k){return f.next_(k)};this.throw=function(k){return f.throw_(k)};this.return=function(k){return f.return_(k)};this[Symbol.iterator]=function(){return this}};$jscomp.generator.createGenerator=function(f,k){k=new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(k));$jscomp.setPrototypeOf&&f.prototype&&$jscomp.setPrototypeOf(k,f.prototype);return k};
$jscomp.asyncExecutePromiseGenerator=function(f){function k(q){return f.next(q)}function p(q){return f.throw(q)}return new Promise(function(q,r){function K(E){E.done?q(E.value):Promise.resolve(E.value).then(k,p).then(K,r)}K(f.next())})};$jscomp.asyncExecutePromiseGeneratorFunction=function(f){return $jscomp.asyncExecutePromiseGenerator(f())};$jscomp.asyncExecutePromiseGeneratorProgram=function(f){return $jscomp.asyncExecutePromiseGenerator(new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(f)))};
(()=>{function f(){return Ma.isValidContrastRatio("#FFFFFF",O("chatButton"))}function k(a){try{var b=new URL(a);return!!b&&"https:"===b.protocol}catch(c){return!1}}function p(a=!1){return embeddedservice_bootstrap.isLocalStorageAvailable&&a?localStorage:embeddedservice_bootstrap.isSessionStorageAvailable?sessionStorage:void 0}function q(){let a,b;const c=JSON.stringify({});embeddedservice_bootstrap.isLocalStorageAvailable&&!localStorage.getItem(u)&&(a=c,localStorage.setItem(u,a));embeddedservice_bootstrap.isSessionStorageAvailable&&
!sessionStorage.getItem(u)&&(b=c,sessionStorage.setItem(u,b));(a||b)&&ja("ESW_3RDPARTY_STORAGE_SET_OBJECTS",{orgId:embeddedservice_bootstrap.settings.orgId,localStorageObj:a,sessionStorageObj:b});m("initializeWebStorage","web storage initialized")}function r(a,b=!0){let c;(b=p(b))&&(c=(b.getItem(u)&&JSON.parse(b.getItem(u))||{})[a]);return c}function K(a,b){if(b&&a){const c=b.getItem(u)&&JSON.parse(b.getItem(u))||{};Object.keys(a).forEach(d=>{c[d]=a[d]});0!==Object.keys(c).length&&b.setItem(u,JSON.stringify(c))}}
function E(a,b,c=!0,d=!1){const e=p(c);if(e){const g=e.getItem(u)&&JSON.parse(e.getItem(u))||{};g[a]=b;e.setItem(u,JSON.stringify(g));m("setItemInWebStorage",`${a} set in ${c?"localStorage":"sessionStorage"}`);d&&ja("ESW_3RDPARTY_STORAGE_SET_ITEMS",{orgId:embeddedservice_bootstrap.settings.orgId,key:a,value:b,inLocalStorage:c})}}function Na(a){if(embeddedservice_bootstrap.isLocalStorageAvailable&&localStorage.getItem(u)){var b=JSON.parse(localStorage.getItem(u))||{};delete b[a];localStorage.setItem(u,
JSON.stringify(b))}embeddedservice_bootstrap.isSessionStorageAvailable&&sessionStorage.getItem(u)&&(b=JSON.parse(sessionStorage.getItem(u))||{},delete b[a],sessionStorage.setItem(u,JSON.stringify(b)));m("removeItemInWebStorage",`${a} removed from web storage`)}function lc(){const a=[z.INVITATION_ACCEPTED,z.INVITATION_REJECTED];let b={};const c=localStorage.getItem(u);if(c)try{const d=JSON.parse(c);a.forEach(e=>{void 0!==d[e]&&(b[e]=d[e])})}catch(d){console.warn("Failed to parse localStorage data:",
d)}localStorage.removeItem(u);0<Object.keys(b).length&&localStorage.setItem(u,JSON.stringify(b))}function Oa(a){embeddedservice_bootstrap.isLocalStorageAvailable&&!a&&(ba()?lc():localStorage.removeItem(u));embeddedservice_bootstrap.isSessionStorageAvailable&&sessionStorage.removeItem(u);ja("ESW_3RDPARTY_STORAGE_CLEAR",embeddedservice_bootstrap.settings.orgId);m("clearWebStorage","web storage cleared")}function mc(){L=void 0;Pa=new Promise(b=>{Qa=b});S={};ka={};G=void 0;Ra=Sa=la=ca=M=!1;ma=na=void 0;
sb();tb();nc();m("clearInMemoryData","Cleared in-memory data.");const a=ub();m("clearInMemoryData",`Reset conversationId. Old conversationId: ${C} & New conversationId: ${a}`);C=a}function vb(a){const b=(c,d)=>{Object.keys(d).forEach(e=>{"object"===typeof c[e]&&typeof("object"===d[e])?b(c[e],d[e]):void 0===c[e]&&(c[e]=d[e])})};a&&"object"===typeof a&&b(embeddedservice_bootstrap.settings,a)}function oa(a,b,c){if((c||embeddedservice_bootstrap.settings.devMode)&&console&&console[a])console[a]("[EmbeddedServiceBootstrap] "+
(Array.isArray(b)?b.join(", "):b))}function m(a,b,c){oa("log",b,c);c={};Object.assign(c,{configDev:embeddedservice_bootstrap.settings.eswConfigDevName,method:a?a:"",stateMessage:b?`[bootstrap][timestamp: ${Date.now()}] ${b}`:"",convId:C,convType:v(),hostUrl:window.location.href});Aa(c)}function t(a,b,c){b?oa("warn","Warning: "+b,c):oa("warn","EmbeddedServiceBootstrap sent an anonymous warning.",c);c={};Object.assign(c,{configDev:embeddedservice_bootstrap.settings.eswConfigDevName,method:a?a:"",stateMessage:b?
`[bootstrap][timestamp: ${Date.now()}] ${b}`:"",convId:C,convType:v(),hostUrl:window.location.href});Aa(c)}function h(a,b,c,d){b?oa("error",b,d):oa("error","EmbeddedServiceBootstrap responded with an unspecified error.",d);d={};Object.assign(d,Object.assign({},{configDev:embeddedservice_bootstrap.settings.eswConfigDevName,method:a?a:"",errMessage:b?`[bootstrap][timestamp: ${Date.now()}] ${b}`:""},c&&{errCode:c},{convId:C,convType:v(),hostUrl:window.location.href}));Aa(null,d)}function ub(){const a=
new Uint32Array(32);crypto.getRandomValues(a);let b="";for(let c=0;32>c;c++){if(8===c||12===c||16===c||20===c)b+="-";b=12===c?b+"4":16===c?b+"0123456789abcdef".charAt(a[c]&3|8):b+"0123456789abcdef".charAt(a[c]&15)}return b}function oc(){try{const a=new Uint8Array(16);crypto.getRandomValues(a);return Array.from(a,b=>b.toString(16).padStart(2,"0")).join("")}catch(a){return h("generateTraceId",`Error generating a x-b3-traceId: ${a}`),""}}function pc(){try{const a=new Uint8Array(8);crypto.getRandomValues(a);
return Array.from(a,b=>b.toString(16).padStart(2,"0")).join("")}catch(a){return h("generateSpanId",`Error generating a x-b3-spanId: ${a}`),""}}function Ta(a,b,c){const d=document.createElementNS("http://www.w3.org/2000/svg",b);Object.getOwnPropertyNames(c).forEach(e=>{"children"===e?c.children.forEach(g=>{Ta(d,g.type,g)}):d.setAttribute(e,c[e])});a.appendChild(document.createTextNode("\n"));a.appendChild(d);a.appendChild(document.createTextNode("\n"))}function da(a){const b=document.createElementNS("http://www.w3.org/2000/svg",
"svg");if(a)return b.setAttribute("focusable","false"),b.setAttribute("aria-hidden","true"),b.setAttribute("viewBox","0 0 100 100"),Array.isArray(a)?a.forEach(c=>{Ta(b,c.type,c)}):Ta(b,"path",{d:a}),b;h("renderSVG","Invalid icon data.")}function qc(){[{name:"document",object:document,functions:"addEventListener createAttribute createComment createDocumentFragment createElementNS createTextNode createRange getElementById getElementsByTagName getElementsByClassName querySelector querySelectorAll removeEventListener".split(" ")},
{name:"window",object:window,functions:"addEventListener clearTimeout dispatchEvent open removeEventListener requestAnimationFrame setInterval setTimeout fetch".split(" ")}].forEach(a=>{a.functions.forEach(b=>{b in a.object&&!Function.prototype.toString.call(a.object[b]).match(/\[native code\]/)&&t("checkForNativeFunctionOverrides","EmbeddedService Messaging Bootstrap may not function correctly with this native JS function modified: "+a.name+"."+b,!0)})})}function Ba(a){"string"!==typeof a?h("setAndStoreJwt",
`Expected to receive string, instead received: ${a}.`):(L=a,E(z.JWT,L))}function rc(){window.addEventListener("message",wb);embeddedservice_bootstrap.isLocalStorageAvailable&&window.addEventListener("storage",xb);document.addEventListener("visibilitychange",function(){Ua="visible"===document.visibilityState});try{(new PerformanceObserver(a=>{a.getEntries().forEach(b=>{"reload"===b.type&&w("EMBEDDED_MESSAGING_APP_AFTER_REFRESH")})})).observe({type:"navigation",buffered:!0})}catch(a){h("addEventHandlers",
`Unable to initialize PerformanceObserver ${a}.`)}}function wb(a){if(a&&a.data&&a.origin)if(embeddedservice_bootstrap.filePreviewFrame&&embeddedservice_bootstrap.filePreviewFrame.contentWindow===a.source)switch(a.data.method){case "ESW_APP_SHOW_FILE_PREVIEW_FRAME":yb(!0);break;case "ESW_APP_HIDE_FILE_PREVIEW_FRAME":yb(!1);break;default:t("handleMessageEvent","Unrecognized event name: "+a.data.method)}else if(embeddedservice_bootstrap.siteContextFrame&&embeddedservice_bootstrap.siteContextFrame.contentWindow===
a.source)switch(a.data.method){case "ESW_3RDPARTY_STORAGE_READY":zb();break;case "ESW_3RDPARTY_STORAGE_RESPONSE":a.data.data&&a.data.data.localStorage&&K(a.data.data.localStorage,localStorage);a.data.data&&a.data.data.sessionStorage&&K(a.data.data.sessionStorage,sessionStorage);Ab();break;default:t("handleMessageEvent","Unrecognized event name: "+a.data.method)}else if(0===H().indexOf(a.origin)&&embeddedservice_bootstrap.utilAPI.getEmbeddedMessagingFrame()&&embeddedservice_bootstrap.utilAPI.getEmbeddedMessagingFrame().contentWindow===
a.source&&embeddedservice_bootstrap.isMessageFromSalesforceDomain(a.origin)||embeddedservice_bootstrap.settings.customDomain&&embeddedservice_bootstrap.isMessageFromCustomDomain(a.origin)){var b=embeddedservice_bootstrap.utilAPI.getEmbeddedMessagingFrame();switch(a.data.method){case "ESW_APP_READY_EVENT":Qa();break;case "ESW_APP_LOADED":a=B();b=document.getElementById("embeddedMessagingIconContainer");var c=document.getElementById("embeddedMessagingIconChat"),d=document.getElementById("embeddedMessagingIconProgressIndicator");
embeddedservice_bootstrap.utilAPI.getEmbeddedMessagingFrame()||t("handleAfterAppLoad","Embedded Messaging iframe not available for post-app-load updates.");a?(b&&d&&b.removeChild(d),c&&(c.style.display="none"),a.disabled=!1,a.classList.remove("embeddedMessagingConversationButtonLoading"),a.classList.add("embeddedMessagingConversationButtonLoaded"),a.classList.add("no-hover")):t("handleAfterAppLoad","Embedded Messaging static button not available for post-app-load updates.");Bb();ca=!0;try{A("onEmbeddedMessagingInitSuccess")}catch(e){ca=
!1,h("emitEmbeddedMessagingInitSuccessEvent",`Something went wrong in firing onEmbeddedMessagingInitSuccess event ${e}.`)}break;case "ESW_APP_INITIALIZATION_ERROR":P();break;case "ESW_APP_MINIMIZE":embeddedservice_bootstrap.minimizeIframe(b,a.data.data);break;case "ESW_APP_MAXIMIZE":embeddedservice_bootstrap.maximizeIframe(b,a.data.data);break;case "ESW_APP_RESET_INITIAL_STATE":X();break;case "ESW_SET_JWT_EVENT":Ba(a.data.data);break;case "ESW_CLEAR_WEBSTORAGE_EVENT":Oa();break;case "ESW_DOWNLOAD_FILE":sc(a.data.data);
break;case "ESW_SET_WEBSTORAGE_FAILEDMESSAGES_EVENT":a=a.data.data;"object"!==typeof a?h("storeFailedMessagesInWebStorage",`Expected to receive object, instead received: ${a}.`):E(z.FAILED_OUTBOUND_MESSAGE_ENTRIES,a,!1);break;case "ESW_CLEAN_UP_WEBSTORAGE_FAILEDMESSAGES_EVENT":Na(z.FAILED_OUTBOUND_MESSAGE_ENTRIES);break;case "ESW_APP_UPDATE_TITLE_NOTIFICATION":sb(a.data.data);break;case "ESW_APP_SEND_HIDDEN_PRECHAT_FIELDS":w("ESW_APP_RECEIVE_HIDDEN_PRECHAT_FIELDS",S);break;case "ESW_APP_SEND_AUTORESPONSE_PARAMETERS":w("ESW_APP_RECEIVE_AUTORESPONSE_PARAMETERS",
ka);break;case "EMBEDDED_MESSAGING_IDENTITY_TOKEN_EXPIRED_EVENT":v()!==x.AUTH?t("handleIdentityTokenExpiredEvent","handleIdentityTokenExpiredEvent method called but User Verification isn\u2019t enabled in Messaging Settings."):A("onEmbeddedMessagingIdentityTokenExpired");break;case "EMBEDDED_MESSAGING_JWT_RETRIEVAL_FAILURE_EVENT":Cb();break;case "ESW_APP_PRECHAT_SUBMIT":tc(a.data.data);break;case "ESW_APP_SHOW_MINIMIZED_STATE_NOTIFICATION":(a=embeddedservice_bootstrap.utilAPI.getEmbeddedMessagingFrame())&&
a.classList.add("hasMinimizedNotification");break;case "EMBEDDED_MESSAGING_REQUEST_TRANSCRIPT_EVENT":uc();break;case "EMBEDDED_MESSAGING_DISPATCH_EVENT_TO_HOST":A(a.data.data&&a.data.data.eventName,{detail:a.data.data.eventDetails||{}});break;case "EMBEDDED_MESSAGING_PUBLIC_SEND_TEXT_MESSAGE_API_RESPONSE":a=a.data.data;a.success?na():ma(a.error);ma=na=void 0;break;case "EMBEDDED_MESSAGING_TEXT_MESSAGE_LINK_CLICK":try{a&&a.data&&a.data.data&&(c=a.data.data,A("onEmbeddedMessageLinkClicked",{detail:Object.assign({},
JSON.parse(c.conversationEntry),{link:c.link})}),c.link&&(d=document.createElement("a"),d.setAttribute("href",c.link),d.setAttribute("rel","noopener noreferrer"),!Db()&&embeddedservice_bootstrap.settings.shouldOpenLinksInSameTab||d.setAttribute("target","_blank"),d.click()))}catch(e){h("handleLinkClick",`Something went wrong in handling a link click: ${e}`)}break;case "EMBEDDED_MESSAGING_SCREENREADER_ANNOUNCEMENT":vc(a.data.data);break;case "ESW_APP_RESET_AND_RELAUNCH":wc();break;default:t("handleMessageEvent",
"Unrecognized event name: "+a.data.method)}}else if(a.origin===window.location.origin&&a.source===window)switch(a.data.method){case "EMBEDDED_MESSAGING_INVITATIONS_RULE_TREE_CREATED":m("handleMessageEvent",`Invitations rule tree created from formula: ${a.data.data.formula}`);break;case "EMBEDDED_MESSAGING_INVITATIONS_RULE_TREE_EVALUATED":m("handleMessageEvent",`Invitations rule tree evaluated with result: ${a.data.data.result}`);break;case "EMBEDDED_MESSAGING_INVITATIONS_CONDITIONS_MET":if(Eb())if((embeddedservice_bootstrap.settings.embeddedServiceConfig.invitation||
{}).isChatInvitationCustomizable)A("onEmbeddedMessagingInvitationShown"),m("handleInvitationConditionsMet","Default invitation skipped to allow custom invitation"),embeddedservice_bootstrap.invitations.reset();else{if(a=B())"none"===a.style.display?Q()&&!pa()&&embeddedservice_bootstrap.utilAPI.showChatButton():(minimizedNotification=Va(I("EmbeddedMessagingInvitationWindow","InvitationBodyText")||"Have questions? Let\u2019s chat",!0),a.parentNode.insertBefore(minimizedNotification,a),A("onEmbeddedMessagingInvitationShown"),
m("handleInvitationConditionsMet","Invitation shown"),embeddedservice_bootstrap.invitations.reset())}else m("handleInvitationConditionsMet","Invitation conditions met but should not show invitation based on settings/previous actions"),embeddedservice_bootstrap.invitations.reset();break;case "EMBEDDED_MESSAGING_INVITATIONS_RULE_TREE_CREATION_ERROR":h("handleMessageEvent",`Failed to create invitations rule tree with formula "${a.data.data.formula}": ${a.data.data.error}`);break;case "EMBEDDED_MESSAGING_INVITATIONS_RULE_TREE_EVALUATION_ERROR":h("handleMessageEvent",
`Failed to evaluate invitations rule tree: ${a.data.data.error}`);break;default:t("handleMessageEvent","Unrecognized event name: "+a.data.method)}else h("handleMessageEvent",`Unexpected message origin: ${a.origin}`)}function wc(){R()||embeddedservice_bootstrap.userVerificationAPI.clearSession().then(()=>{embeddedservice_bootstrap.utilAPI.launchChat().then(()=>{m("handleAppResetAndRelaunch","Reset and Relaunched the client.")}).catch(a=>{h("handleAppResetAndRelaunch",`Failed to Reset and Relaunch the client: ${a}`)})}).catch(a=>
{h("handleAppResetAndRelaunch",`Failed to Reset and Relaunch the client: ${a}`)})}function Fb(){const a=document.getElementById("embeddedMessagingMinimizedNotification");a&&"true"===a.getAttribute("is-invitation")&&Wa(!0);A("onEmbeddedMessagingButtonClicked");return Xa()}function xb(a){a&&a.key&&a.key===u&&null===a.newValue&&R()&&Ya(!1,!0)}function P(){la=!0;try{Aa(),A("onEmbeddedMessagingInitError")}catch(a){la=!1,h("emitEmbeddedMessagingInitErrorEvent",`Something went wrong in firing onEmbeddedMessagingInitError event ${a}.`)}}
function Ca(a){let b=Q()&&!embeddedservice_bootstrap.settings.hideChatButtonOnLoad;b=void 0!==a&&null!==a?a:b;v()===x.AUTH&&(b=b&&Da(G));try{A("onEmbeddedMessagingChannelMenuVisibilityChanged",{detail:{devName:embeddedservice_bootstrap.settings.eswConfigDevName,isVisible:b}})}catch(c){h("emitEmbeddedMessagingChannelMenuVisibilityChangeEvent",`Something went wrong in firing emitEmbeddedMessagingChannelMenuVisibilityChange event ${c}.`)}}function A(a,b={detail:{}}){if(!a)throw Error(`Expected an eventName parameter with a string value. Instead received ${a}.`);
if(b&&!("detail"in b))throw Error(`The options parameter of the event is malformed: ${b}.`);try{"onEmbeddedMessagingConversationOpened"===a&&(Sa=!0),window.dispatchEvent(new CustomEvent(a,b))}catch(c){throw Error("Something went wrong while dispatching the event "+a+":"+c);}}function sb(a){if(a){const b=JSON.parse(a)[0],c=Gb;qa&&window.clearInterval(qa);qa=window.setInterval(()=>{document.title=document.title===b?c:b},1E3)}else window.clearInterval(qa),qa=void 0,document.title=Gb}function Y(){return document.getElementById("embedded-messaging")}
function B(){return document.getElementById("embeddedMessagingConversationButton")}function yb(a){var b=embeddedservice_bootstrap.utilAPI.getEmbeddedMessagingFrame();if(embeddedservice_bootstrap.filePreviewFrame&&b){if(a){if(embeddedservice_bootstrap.filePreviewFrame.classList.add("show"),embeddedservice_bootstrap.filePreviewFrame.contentWindow.focus(),embeddedservice_bootstrap.filePreviewFrame.setAttribute("aria-hidden","false"),b.tabIndex="-1",b.setAttribute("aria-hidden","true"),b=Y())b.inert=
!0}else if(embeddedservice_bootstrap.filePreviewFrame.classList.remove("show"),embeddedservice_bootstrap.filePreviewFrame.setAttribute("aria-hidden","true"),b.tabIndex="0",b.setAttribute("aria-hidden","false"),b=Y())b.inert=!1;m("setFilePreviewFrameVisibility",`Full size file preview ${a?"shown":"hidden"}`)}}function sc(a){let b;if(!k(a.attachmentDownloadURL))throw Error(`Invalid attachmentDownloadURL : ${a.attachmentDownloadURL}.`);b=document.createElement("iframe");b.style.display="none";b.src=
a.attachmentDownloadURL||"";document.body.appendChild(b);a.shouldOpenFileInNewTab&&window.open(b.src,"_blank","noreferrer noopener");setTimeout(()=>{document.body.removeChild(b)},1E3)}function Hb(a){return new Promise((b,c)=>{let d=H(),e=document.createElement("link");e.id="embeddedMessagingBootstrapStyles";e.class="embeddedMessagingBootstrapStyles";e.href=d+"/assets/styles/bootstrap"+(embeddedservice_bootstrap.settings.devMode?"":".min")+".css";e.type="text/css";e.rel="stylesheet";e.onerror=c;e.onload=
b;document.getElementsByTagName("head")[0].appendChild(e)})}function Ib(){return Ea(embeddedservice_bootstrap.settings.scrt2URL+"/embeddedservice/v1/embedded-service-config?orgId="+embeddedservice_bootstrap.settings.orgId+"&esConfigName="+embeddedservice_bootstrap.settings.eswConfigDevName+"&language="+embeddedservice_bootstrap.settings.language,"GET","getConfigurationData")}function Za(){return Ea(embeddedservice_bootstrap.settings.scrt2URL+"/embeddedservice/v2/agent-availability?orgId="+embeddedservice_bootstrap.settings.orgId+
"&esConfigName="+embeddedservice_bootstrap.settings.eswConfigDevName,"GET","getAgentAvailabilityData").then(a=>{if(a.success)return!!a.response.agentAvailable||!1;h("getAgentAvailabilityData",`Failed to retrieve Agent Availability data. Returning the default value as False. Error : ${a.error.message}`,a.error.errorCode);return!1}).catch(a=>{h("getAgentAvailabilityData",`Failed to retrieve Agent Availability data. Returning the default value as False ${a}`);return!1})}function $a(){return Ea(embeddedservice_bootstrap.settings.scrt2URL+
"/embeddedservice/v1/businesshours?orgId="+embeddedservice_bootstrap.settings.orgId+"&esConfigName="+embeddedservice_bootstrap.settings.eswConfigDevName,"GET","getBusinessHoursInterval").then(a=>{a=a&&a.businessHoursInfo;m("getBusinessHoursInterval","Successfully retrieved Business Hours data");a&&Array.isArray(a.businessHours)&&0<a.businessHours.length&&(T={startTime:a.businessHours[0].startTime,endTime:a.businessHours[0].endTime},ab())}).catch(a=>{throw a;})}function Jb(a){h("handleBusinessHoursError",
"Failed to retrieve Business Hours data. Retrying the request.",a);return $a()}function Fa(){if(embeddedservice_bootstrap.settings.snippetConfig.expSiteUrl){var a=embeddedservice_bootstrap.settings.snippetConfig.expSiteUrl===window.location.origin;a=`${embeddedservice_bootstrap.settings.snippetConfig.expSiteUrl}${embeddedservice_bootstrap.settings.snippetConfig.expSiteContext===bb.AURA?"":(a?"/":"")+"vforcesite"}${"/_nc_external/system/security/session/SessionTimeServlet?buster="}${(new Date).getTime()}`;
return Ea(a,"GET","getExpSiteSessionTimeout").then(b=>{try{b=JSON.parse(b.substring(b.indexOf("{"),b.indexOf("}")+1))}catch(c){h("getExpSiteSessionTimeout","Error parsing response text from server ",c)}"number"===typeof b.sr&&(m("getExpSiteSessionTimeout","Successfully retrieved experience site session timeout"),0<b.sr?(embeddedservice_bootstrap.settings.snippetConfig.isExpSiteGuestUser=!1,cb&&clearTimeout(cb),cb=setTimeout(()=>{Fa()},1E3*b.sr)):(embeddedservice_bootstrap.settings.snippetConfig.isExpSiteGuestUser=
!0,embeddedservice_bootstrap.userVerificationAPI.clearSession()))})}}function Ea(a,b,c){const d=performance.now();return new Promise((e,g)=>{const n=new XMLHttpRequest;n.open(b,a,!0);n.onreadystatechange=l=>{if((l=l.target)&&l.readyState===l.DONE||204===l.status){const F=((performance.now()-d)/1E3).toFixed(3);if(200===l.status||204===l.status)if("getExpSiteSessionTimeout"!==c){const y=l.responseText?JSON.parse(l.responseText):l.responseText;e(y)}else e(l.responseText);else g(l.status);m("sendXhrRequest",
`${c?c:a} took ${F} seconds and returned with the status code ${l.status}`)}};n.send()})}function xc(){return R()?Kb().then(a=>Ga().then(b=>{m("initializeConversationState","finished joining verified user conversation");ra(a,b)}).catch(()=>{P()})):v()===x.UNAUTH?Lb()||(embeddedservice_bootstrap.settings.embeddedServiceConfig.termsAndConditions||{}).isTermsAndConditionsEnabled?(ra(),Promise.resolve()):db().then(a=>sa(S).then(b=>{m("initializeConversationState","finished creating conversation");ra(a,
b)}).catch(()=>{P()})):Promise.reject(Error("Something went wrong initializing conversation state."))}function Mb(a){ra(null,null,a);return Promise.resolve()}function ra(a,b,c,d=!1){var e=r(z.FAILED_OUTBOUND_MESSAGE_ENTRIES,!1);const g=embeddedservice_bootstrap.settings.standardLabels,n=embeddedservice_bootstrap.settings.embeddedServiceConfig.customLabels;if(embeddedservice_bootstrap.settings.imageCompressionOptions){var l=embeddedservice_bootstrap.settings.imageCompressionOptions;l=Object.assign({},
l.quality&&!isNaN(Number(l.quality))&&0<=Number(l.quality)&&1>=Number(l.quality)&&{quality:Number(l.quality)},l.maxHeight&&!isNaN(Number(l.maxHeight))&&0<Number(l.maxHeight)&&{maxHeight:Number(l.maxHeight)},l.maxWidth&&!isNaN(Number(l.maxWidth))&&0<Number(l.maxWidth)&&{maxWidth:Number(l.maxWidth)},l.convertTypes&&("string"===typeof l.convertTypes||Array.isArray(l.convertTypes))&&{convertTypes:l.convertTypes},l.convertSize&&!isNaN(Number(l.convertSize))&&0<=Number(l.convertSize)&&{convertSize:l.convertSize})}l=
Object.assign({},l&&{imageCompressionOptions:l},"boolean"===typeof embeddedservice_bootstrap.settings.enableUserInputForConversationWithBot&&{enableUserInputForConversationWithBot:!!embeddedservice_bootstrap.settings.enableUserInputForConversationWithBot},"boolean"===typeof embeddedservice_bootstrap.settings.shouldShowParticipantChgEvntInConvHist&&{shouldShowParticipantChgEvntInConvHist:!!embeddedservice_bootstrap.settings.shouldShowParticipantChgEvntInConvHist},{shouldMinimizeWindowOnNewTab:embeddedservice_bootstrap.settings.shouldMinimizeWindowOnNewTab},
"boolean"===typeof embeddedservice_bootstrap.settings.disableStreamingResponses&&{disableStreamingResponses:!!embeddedservice_bootstrap.settings.disableStreamingResponses},"boolean"===typeof embeddedservice_bootstrap.settings.sseRetryEnhancement&&{sseRetryEnhancement:!!embeddedservice_bootstrap.settings.sseRetryEnhancement},"boolean"===typeof embeddedservice_bootstrap.settings.showStartNewSessionCTA&&{showStartNewSessionCTA:!!embeddedservice_bootstrap.settings.showStartNewSessionCTA});e=Object.assign({},
embeddedservice_bootstrap.settings.embeddedServiceConfig,Object.assign({},{identityToken:G,failedMessages:e,conversationId:C,devMode:!!embeddedservice_bootstrap.settings.devMode,noSsePatch:!!embeddedservice_bootstrap.settings.noSsePatch,language:embeddedservice_bootstrap.settings.language},g&&{standardLabels:g},n&&{customLabels:n},{hasConversationButtonColorContrastMetA11yThreshold:f(),hostUrl:window.location.href},v()===x.EXP_SITE_AUTH&&{expSiteUrl:embeddedservice_bootstrap.settings.snippetConfig.expSiteUrl},
embeddedservice_bootstrap.settings.displayMode&&{displayMode:embeddedservice_bootstrap.settings.displayMode},{snippetSettings:l,capabilitiesVersion:"258",traceHeaders:ta}))||{};a&&(e=Object.assign(e,{jwtData:a}));b&&(e=Object.assign(e,{conversationData:b}));c&&(e=Object.assign(e,{errorData:c}));e.isExistingSessionOnPageLoad=d;w("ESW_SET_CONFIG_EVENT",e)}function tc(a){const b=Object.assign(a,S);A("onEmbeddedMessagingPreChatSubmitted",{detail:{prechatDisplay:yc.CONVERSATION,prechatSubmitFields:b}});
R()?Ga().then(c=>{c&&c.isExistingConversation?(m("handlePrechatSubmit","Pre-chat submitted but a conversation already exits for the verified user. Joining the existing conversation."),w("EMBEDDED_MESSAGING_SET_CONVERSATION_DATA_EVENT",c)):(m("handlePrechatSubmit","Pre-chat submitted. Creating a new conversation."),sa(b).then(d=>{w("EMBEDDED_MESSAGING_SET_CONVERSATION_DATA_EVENT",d)}))}):v()===x.UNAUTH&&(N()?(m("handlePrechatSubmit","Pre-chat submitted but a JWT exists in web storage. Fetching existing conversations."),
L=r(z.JWT),Nb().then(c=>{w("ESW_SET_JWT_EVENT",c);Ga().then(d=>{d&&d.isExistingConversation?(m("handlePrechatSubmit","Pre-chat submitted but a conversation already exits for the unverified user. Joining the existing conversation."),w("EMBEDDED_MESSAGING_SET_CONVERSATION_DATA_EVENT",d)):(m("handlePrechatSubmit","Pre-chat submitted and no existing conversations found. Creating a new conversation."),sa(b).then(e=>{w("EMBEDDED_MESSAGING_SET_CONVERSATION_DATA_EVENT",e)}))})})):(m("handlePrechatSubmit",
"Pre-chat submitted. Fetching a JWT and starting a new conversation."),db().then(c=>{w("ESW_SET_JWT_EVENT",c);sa(b).then(d=>{w("EMBEDDED_MESSAGING_SET_CONVERSATION_DATA_EVENT",d)})})))}function Ob(){return new Promise(a=>{embeddedservice_bootstrap.createFilePreviewFrame();embeddedservice_bootstrap.createIframe().then(()=>{a("Created Embedded Messaging frame.")})})}function Nb(){return r(z.JWT)?zc().then(a=>{Ba(a.accessToken);m("handleGetContinuityJwt","Sucessfully retreived a Continuity JWT");return a}).catch(a=>
{h("handleGetContinuityJwt",`Failed to get Continuity JWT: ${a&&a.message?a.message:a}.`);X()}):Promise.reject(void 0)}function zc(){const a=embeddedservice_bootstrap.settings.scrt2URL.concat("/iamessage/v1/authorization/continuityAccessToken");return ea(a,"GET","cors",null,null,"getContinuityJwt").then(b=>{if(!b.ok)throw b;return b.json()})}function db(){return Ac().then(a=>{Ba(a.accessToken);m("handleGetUnauthenticatedJwt","Successfully retreived an Unauthenticated JWT");return a}).catch(a=>Bc(a))}
function Pb(a){var b=Qb();b=b?embeddedservice_bootstrap.settings.scrt2URL.concat("/iamessage/v1/authorization/unauthenticated/accessToken","?",b):embeddedservice_bootstrap.settings.scrt2URL.concat("/iamessage/v1/authorization/unauthenticated/accessToken");return ea(b,"POST","cors",{"Content-Type":"application/json"},a,"sendUnauthenticatedJwtRequest").then(c=>{J()&&U();if(!c.ok)throw c;return c.json()})}function Ac(){let a={orgId:embeddedservice_bootstrap.settings.orgId,developerName:embeddedservice_bootstrap.settings.eswConfigDevName,
capabilitiesVersion:"258"};return J()?Rb().then(b=>{if(!b)throw Error("ReCaptcha token generation failed at client.");a.captchaToken=b;return Pb(a)}):Pb(a)}function Kb(){return(v()===x.EXP_SITE_AUTH?Cc():Dc()).then(a=>{a=v()===x.EXP_SITE_AUTH?a.data:a;Ba(a.accessToken);m("handleGetAuthenticatedJwt","Successfully retreived an Authenticated JWT");return a}).catch(a=>{J()&&U();a=(null==a?void 0:a.message)||a;h("handleGetAuthenticatedJwt",`Error retrieving authenticated token: ${a}.`);Cb();throw a;})}
function Cc(){const a=embeddedservice_bootstrap.settings.snippetConfig.expSiteUrl+"/miaw/auth/accesstoken"+`?platformType=${"Web"}&developerName=${embeddedservice_bootstrap.settings.eswConfigDevName}&capabilitiesVersion=${"258"}`,b={Cos:"0x0204","Content-Type":"application/json"};return ua(a,"GET","cors",b,null,"getExpSiteAuthenticatedJwt").then(c=>{if(!c.ok)throw c;return c.json()}).catch(c=>Ha(c,a,"GET","cors",b,null,"getExpSiteAuthenticatedJwt"))}function Sb(a){const b=G,c=Qb(),d=c?embeddedservice_bootstrap.settings.scrt2URL.concat("/iamessage/v1/authorization/authenticated/accessToken",
"?",c):embeddedservice_bootstrap.settings.scrt2URL.concat("/iamessage/v1/authorization/authenticated/accessToken"),e={"Content-Type":"application/json"};return b&&Da(b)?ua(d,"POST","cors",e,a,"sendAuthenticatedJwtRequest").then(g=>{J()&&U();if(!g.ok)throw g;return g.json()}).catch(g=>{J()&&U();return Ha(g,d,"POST","cors",e,a,"sendAuthenticatedJwtRequest")}):(new Promise(g=>{Tb({apiPath:d,method:"POST",mode:"cors",requestHeaders:e,requestBody:a,resolve:g})})).then(g=>{J()&&U();if(!g.ok)throw g;return g.json()})}
function Dc(){let a={orgId:embeddedservice_bootstrap.settings.orgId,developerName:embeddedservice_bootstrap.settings.eswConfigDevName,capabilitiesVersion:"258",authorizationType:eb.JWT,customerIdentityToken:G};return J()?Rb().then(b=>{if(!b)throw Error("ReCaptcha token generation failed at client.");a.captchaToken=b;return Sb(a)}):Sb(a)}function Ec(){Fc().then(()=>{m("handleRegisterDeviceCapabilities","Successfully Registered Device Capabilities.")})}function Fc(){const a=embeddedservice_bootstrap.settings.scrt2URL.concat("/iamessage/v1/device/registerDeviceCapabilities");
return ea(a,"POST","cors",null,{},"registerDeviceCapabilities")}function Ga(a){return Gc(!1,embeddedservice_bootstrap.settings.restrictSessionOnMessagingChannel?embeddedservice_bootstrap.settings.embeddedServiceConfig.embeddedServiceMessagingChannel.channelAddressIdentifier:null).then(b=>{let c=[];if(!b.conversations||!Array.isArray(b.conversations))throw Error(`Invalid conversation list: ${b.conversations}.`);c=b.conversations.filter(d=>0===d.endTimestamp);if(0===c.length){if(a)throw t("handleListConversation",
"No open conversation found, deleting stale data from web storage.",!0),X(),!ba()||V()||fa()||Ub(Date.now()),Error("No open conversation found for JWT in web storage.");return Lb()||(embeddedservice_bootstrap.settings.embeddedServiceConfig.termsAndConditions||{}).isTermsAndConditionsEnabled?null:(t("handleListConversation","No existing conversation found and pre-chat is not enabled. Will start a new conversation."),sa(S).then(d=>d))}1<c.length&&(t("handleListConversation",`Expected the user to be participating in 1 open conversation but instead found ${c.length}. Loading the conversation with latest startTimestamp.`),
c.sort((d,e)=>e.startTimestamp-d.startTimestamp));b=c[0];if(!Hc(b.conversationId))throw Error(`Invalid conversation identifier: ${b.conversationId}.`);m("handleListConversation","Successfully retrieved existing conversation");C!==b.conversationId&&(m("handleListConversation",`ConversationId change detected. Old conversation-id: ${C} & New conversation-id: ${b.conversationId}`),C=b.conversationId);b.isExistingConversation=!0;return b}).catch(b=>{h("handleListConversation",`Failed to list conversation entries: ${b&&
b.message?b.message:b}.`);throw Error(`Failed to list conversation entries: ${b&&b.message?b.message:b}.`);})}function Gc(a,b){const c=embeddedservice_bootstrap.settings.scrt2URL.concat("/iamessage/v1/queries/conversation/list");return ea(c,"POST","cors",null,Object.assign({},{includeClosedConversations:a},b&&{channelAddressIdentifier:b}),"listConversation").then(d=>d.json())}function Bc(a){if(a&&a.status&&401===a.status)return h("handleGetJwtError","Unauthorized error caused by JWT expiration. Attempt to get another JWT",
a.status),db().catch(b=>{throw Error(b);});J()&&U();throw Error(`Error retrieving unauthenticated token: ${(null==a?void 0:a.message)||a}.`);}function Lb(){return(embeddedservice_bootstrap.settings.embeddedServiceConfig.forms||[]).some(a=>{a.formFields=a.formFields||[];return"PreChat"===a.formType&&0<a.formFields.length})}function sa(a){if(Ra)return h("handleCreateNewConversation","Attempting to create new conversation multiple times!",null,!0),Promise.resolve();if(a)if("object"===typeof a)for(const [b,
c]of Object.entries(a))m("handleCreateNewConversation",`Pre-chat field: ${b} ${c&&0<c.trim().length?`is set with a value of ${c.length} characters.`:"is not set."}`);else h("handleCreateNewConversation",`Expected to receive a valid object for Pre-Chat fields, instead received ${typeof a}`);Ra=!0;return Ic(a).then(b=>{A("onEmbeddedMessagingConversationStarted",{detail:{conversationId:C}});Ec();b.esDeveloperName=embeddedservice_bootstrap.settings.eswConfigDevName;m("handleCreateNewConversation",`Initialized the esDeveloperName associated with current conversation to: ${embeddedservice_bootstrap.settings.eswConfigDevName}`);
return b})}function Ic(a){const b=embeddedservice_bootstrap.settings.scrt2URL.concat("/iamessage/v1/conversation"),c=embeddedservice_bootstrap.settings.language;ta["x-b3-traceId"]=oc();ta["x-b3-spanId"]=pc();return ea(b,"POST","cors",Object.assign({},{"Content-Type":"application/json"},L&&{Authorization:"Bearer "+L},{"x-b3-traceId":ta["x-b3-traceId"],"x-b3-spanId":ta["x-b3-spanId"]}),Object.assign({},a&&{routingAttributes:a},{conversationId:C,language:c}),"createNewConversation").then(d=>d.json())}
function Jc(){const a=embeddedservice_bootstrap.settings.scrt2URL.concat("/iamessage/v1/conversation","/",C,"/transcript");return ea(a,"GET","cors",null,null,"getTranscript").then(b=>b.arrayBuffer())}function uc(){A("onEmbeddedMessagingTranscriptRequested",{detail:{conversationId:C}});Jc().then(a=>{a=new Blob([a],{type:"octet/stream"});a=window.URL.createObjectURL(a);const b=document.createElement("a");b.href=a;b.download="ConversationTranscript.pdf";b.click();window.URL.revokeObjectURL(a);w("EMBEDDED_MESSAGING_REQUEST_TRANSCRIPT_SUCCESS_EVENT");
A("onEmbeddedMessagingTranscriptDownloadSuccessful",{detail:{conversationId:C}})}).catch(a=>{if(a){const b=a.status;a=a.message||void 0;w("EMBEDDED_MESSAGING_REQUEST_TRANSCRIPT_ERROR_EVENT",{detail:{errorCode:b,errorMessage:a}});h("handleRequestTranscript",`Transcript request failed with status code: ${b} & message: ${a}`,b)}else w("EMBEDDED_MESSAGING_REQUEST_TRANSCRIPT_ERROR_EVENT");A("onEmbeddedMessagingTranscriptRequestFailed",{detail:{conversationId:C}})})}function ua(a,b,c,d,e,g=a){d=d?d:Object.assign({},
{"Content-Type":"application/json"},L&&{Authorization:"Bearer "+L});e=e?JSON.stringify(e):void 0;const n=performance.now();return fetch(a,Object.assign({},{method:b,mode:c,headers:d},e&&{body:e})).then(l=>$jscomp.asyncExecutePromiseGeneratorFunction(function*(){const F=((performance.now()-n)/1E3).toFixed(3);m("sendFetchRequest",`${g} took ${F} seconds and returned with the status code ${l.status}`);if(!l.ok){let y;try{y=Object.assign(l,yield l.json())}catch(Z){y=Object.assign(l,{message:`Error reading the body stream of error object: ${l}`})}throw y;
}return l}))}function Ha(a,b,c,d,e,g,n=b){if(!a||!a.status||500<=a.status&&599>=a.status)return h("handleSendFetchRequestError",`Something went wrong in ${n}: ${a&&a.message?a.message:JSON.stringify(Object.assign({},a,{status:a.status,statusText:a.statusText,type:a.type}))}. Re-trying the request.`,a&&a.status),ua(b,c,d,e,g,n).catch(l=>{h("handleSendFetchRequestError",`${n} request failed again: ${l&&l.message?l.message:JSON.stringify(Object.assign({},l,{status:l.status,statusText:l.statusText,type:l.type}))}.`,
l&&l.status);throw l;});if(401===a.status){h("handleSendFetchRequestError",`${n}: ${a&&a.message?a.message:JSON.stringify(Object.assign({},a,{status:a.status,statusText:a.statusText,type:a.type}))}.`,a&&a.status);if(v()===x.UNAUTH)throw Oa(),a;if(R())return G&&Da(G)||v()===x.EXP_SITE_AUTH?new Promise(l=>{Vb({apiPath:b,method:c,mode:d,requestHeaders:e,requestBody:g,resolve:l})}):new Promise(l=>{Tb({apiPath:b,method:c,mode:d,requestHeaders:e,requestBody:g,resolve:l})})}else if(423===a.status){const l=
{};Object.assign(l,{errorStatus:a.status,errorCode:a.errorCode});if(a.errorCode&&"ORG_UNDER_MAINTENANCE"===a.errorCode||"ORG_NOT_SUPPORTED"===a.errorCode)h("handleSendFetchRequestError",`Received a ${a.status} in ${n}: ${a&&a.message?a.message:JSON.stringify(Object.assign({},a,{status:a.status,statusText:a.statusText,type:a.type}))}`,a&&a.status),ca?w("EMBEDDED_MESSAGING_CONVO_ERROR_DATA_RECEIVED",l):Mb(l)}else throw h("handleSendFetchRequestError",`Something went wrong in ${n}: ${a&&a.message?a.message:
JSON.stringify(Object.assign({},a,{status:a.status,statusText:a.statusText,type:a.type}))}`,a&&a.status),a;}function ea(a,b,c,d,e,g){return ua(a,b,c,d,e,g).catch(n=>Ha(n,a,b,c,d,e,g))}function Qb(){let a="";const b=fb();b&&(a=(new URLSearchParams({os:b.os.name,osVersion:b.os.version,browser:b.browser.name,browserVersion:b.browser.version})).toString());return a}function fb(){var a=[navigator.platform,navigator.userAgent,navigator.appVersion,navigator.vendor,window.opera].join(" ");const b=Wb(a,[{name:"Windows Phone",
value:"Windows Phone",version:"OS"},{name:"Windows",value:"Win",version:"NT"},{name:"iPhone",value:"iPhone",version:"OS"},{name:"iPad",value:"iPad",version:"OS"},{name:"Kindle",value:"Silk",version:"Silk"},{name:"Android",value:"Android",version:"Android"},{name:"PlayBook",value:"PlayBook",version:"OS"},{name:"BlackBerry",value:"BlackBerry",version:"/"},{name:"Macintosh",value:"Mac",version:"OS X"},{name:"Linux",value:"Linux",version:"rv"},{name:"Palm",value:"Palm",version:"PalmOS"}]);a=Wb(a,[{name:"Edge",
value:"Edg",version:"Edg"},{name:"Chrome",value:"Chrome",version:"Chrome"},{name:"Firefox",value:"Firefox",version:"Firefox"},{name:"Safari",value:"Safari",version:"Version"},{name:"Internet Explorer",value:"MSIE",version:"MSIE"},{name:"Opera",value:"Opera",version:"Opera"},{name:"BlackBerry",value:"CLDC",version:"CLDC"},{name:"Mozilla",value:"Mozilla",version:"Mozilla"}]);return{os:b,browser:a}}function Wb(a,b){let c;let d;for(c=0;c<b.length;c+=1){var e=new RegExp(b[c].value,"i");if(e=e.test(a)){e=
new RegExp(b[c].version+"[- /:;]([\\d._]+)","i");e=a.match(e);d="";e&&e[1]&&(e=e[1]);if(e)for(e=e.split(/[._]+/),a=0;a<e.length;a+=1)d=0===a?d+(e[a]+"."):d+e[a];else d="0";return{name:b[c].name,version:parseFloat(d)}}}return{name:"unknown",version:0}}function H(){try{return embeddedservice_bootstrap.settings.siteURL}catch(a){h("getSiteURL",`Error getting Site URL: ${a}`)}}function I(a,b){for(const c of embeddedservice_bootstrap.settings.embeddedServiceConfig.customLabels)if(c.sectionName===a&&c.labelName===
b)return c.labelValue||"";for(const c of embeddedservice_bootstrap.settings.standardLabels)if(c.sectionName===a&&c.labelName===b)return c.labelValue||"";return""}function O(a){for(const b of embeddedservice_bootstrap.brandingData)if(b.n&&b.n===a)return b.v}function Kc(){const a=embeddedservice_bootstrap.settings.chatButtonPosition;if("string"===typeof a&&0<a.length){const b=a.split(",");2!==b.length?h("setButtonPositionStyles",`Invalid embeddedservice_bootstrap.settings.chatButtonPosition value specified: ${a}. Valid format is "25px, 30px".`):
(document.documentElement.style.setProperty("--eswButtonBottom",b[0].trim()),document.documentElement.style.setProperty("--eswButtonRight",b[1].trim()))}}function Xb(){let a=B(),b=document.getElementById("embeddedMessagingIconContainer"),c=document.getElementById("embeddedMessagingIconChat"),d=document.createElement("div"),e=document.createElement("span");if(a){c.style.display="none";d.setAttribute("class","embeddedMessagingIconProgressIndicator");d.setAttribute("id","embeddedMessagingIconProgressIndicator");
let g=da(aa.OUTER_ARC);g.setAttribute("class","embeddedMessagingIconOuterArc");let n=da(aa.INNER_ARC);n.setAttribute("class","embeddedMessagingIconInnerArc");d.appendChild(g);d.appendChild(n);a.classList.add("embeddedMessagingConversationButtonLoading");b.insertBefore(d,c);a.disabled=!0;e.className="slds-assistive-text";e.setAttribute("role","alert");e.innerHTML=I("EmbeddedMessagingPrechat","PrechatSubmitButtonLoading")||"Loading";d.appendChild(e)}}function gb(){return-1===navigator.userAgent.indexOf("Mobi")}
function Q(){if(!T)return!0;const a=Number(T.startTime),b=Number(T.endTime),c=Date.now();return c>=a&&c<b?!0:!1}function ab(){let a;if(T){var b=Q();b?a=Number(T.endTime):(a=Number(T.startTime),A("onEmbeddedMessagingBusinessHoursEnded"));isNaN(a)||(va&&clearTimeout(va),va=setTimeout(()=>{clearTimeout(va);va=void 0;Lc(b);b?A("onEmbeddedMessagingBusinessHoursEnded"):A("onEmbeddedMessagingBusinessHoursStarted")},a-Date.now()))}}function Lc(a){Ia();a?(T=void 0,embeddedservice_bootstrap.utilAPI.hideChatButton(),
$a().then(ab()).catch(b=>Jb(b))):(V()||(pa()?hb():Promise.resolve(!0)).then(()=>{Q()&&embeddedservice_bootstrap.utilAPI.showChatButton()}),ab())}function Mc(){const a=!!navigator.userAgent.match(/iP(hone|ad|od)/i);var b=navigator.userAgent.match(/(?!=OS)(([0-9]){2})/i);b=b&&0<b.length?Number(b[0]):-1;const c=!!navigator.userAgent.match(/WebKit/i)&&!navigator.userAgent.match(/CriOS/i);return a&&c&&15<=b}function V(){try{return embedded_svc&&embedded_svc.menu?!0:!1}catch(a){return!1}}function Db(){return navigator.userAgent.includes("CommunityHybridContainer")||
navigator.userAgent.includes("playgroundcommunity")}function Ja(){return embeddedservice_bootstrap.settings.snippetConfig.expSiteContext===bb.LWR||embeddedservice_bootstrap.settings.snippetConfig.expSiteContext===bb.AURA}function fa(){return embeddedservice_bootstrap.settings.displayMode===Yb.INLINE}function ba(){return embeddedservice_bootstrap.settings.embeddedServiceConfig.invitation}function Ub(a){if(Eb()){if(document.getElementById("invitation-script"))embeddedservice_bootstrap.invitations.initialize(a);
else{var b=document.createElement("script");const c=`${H()}/assets/js/invitation${embeddedservice_bootstrap.settings.devMode?"":".min"}.js`;b.id="invitation-script";b.type="text/javascript";b.src=c;b.onload=()=>{embeddedservice_bootstrap.invitations=window.embeddedservice_invitations;embeddedservice_bootstrap.invitations.initialize(a)};embeddedservice_bootstrap.settings.targetElement.appendChild(b)}(b=r(z.PAGE_COUNT))?E(z.PAGE_COUNT,parseInt(b)+1,!0):E(z.PAGE_COUNT,1,!0);r(z.SITE_TIME)||E(z.SITE_TIME,
Date.now(),!0)}else m("initializeInvitations","Skipping invitation initialization due to previous actions and settings")}function Eb(){var a;if(a=ba())a=!!embeddedservice_bootstrap.settings.embeddedServiceConfig.invitation.isSendInvtAllowedAfterAccept||!r(z.INVITATION_ACCEPTED,!0);a&&(a=!!embeddedservice_bootstrap.settings.embeddedServiceConfig.invitation.isSendInvtAllowedAfterReject||!r(z.INVITATION_REJECTED,!0));return a}function Wa(a){a=a?{storageKey:z.INVITATION_ACCEPTED,eventName:"onEmbeddedMessagingInvitationAccepted",
logMessage:"Invitation accepted"}:{storageKey:z.INVITATION_REJECTED,eventName:"onEmbeddedMessagingInvitationRejected",logMessage:"Invitation rejected"};E(a.storageKey,Date.now(),!0);Na(z.PAGE_COUNT);Na(z.SITE_TIME);A(a.eventName);m("handleInvitationNotificationAction",a.logMessage)}function ib(a){const b=embeddedservice_bootstrap.settings.targetElement.children;let c;for(const d in b)c=b[d],c!==Y()&&c!==embeddedservice_bootstrap.filePreviewFrame&&(c.inert=a)}function vc(a){const b=document.getElementById("embeddedMessagingLiveRegion");
b.textContent=a.text;jb&&clearTimeout(jb);jb=setTimeout(()=>{b.textContent=""},3E3)}function Zb(){const a=document.querySelector('meta[name="viewport"]');a&&(a.setAttribute("content",ha),ha=void 0)}function w(a,b){Pa.then(()=>{const c=embeddedservice_bootstrap.utilAPI.getEmbeddedMessagingFrame();if("string"!==typeof a)throw Error(`Expected a string to use as message param in post message, instead received ${a}.`);c&&c.contentWindow?c.contentWindow.postMessage(Object.assign({},{method:a},b&&{data:b}),
H()):t("sendPostMessageToAppIframe",`Embedded Messaging iframe not available for post message with method ${a}.`)})}function ja(a,b){Nc.then(()=>{const c=embeddedservice_bootstrap.siteContextFrame;if("string"!==typeof a)throw Error(`Expected a string to use as message param in post message, instead received ${a}.`);c&&c.contentWindow?c.contentWindow.postMessage(Object.assign({},{method:a},b&&{data:b}),H()):t("sendPostMessageToSiteContextIframe",`Embedded Messaging site context iframe not available for post message with method ${a}.`)})}
function $b(){ja("ESW_PREFETCH_LWR_RESOURCES")}function Oc(a){a||h("handleAuraSite","Failed to load aura app. Iframe is undefined.");a.src=H()+"/embeddedService/embeddedService.app"}function Pc(a){let b=H();a||h("handleLWRSite","Failed to load LWR site. Iframe is undefined.");b.endsWith("/")||(b+="/");a.src=b+"?lwc.mode="+(embeddedservice_bootstrap.settings.devMode?"dev":"prod")}function Xa(){return new Promise((a,b)=>{try{let c=B(),d=embeddedservice_bootstrap.utilAPI.getEmbeddedMessagingFrame();
kb();if(c&&!c.classList.contains("embeddedMessagingConversationButtonLoaded")){if(N())return m("handleClick","Conversation button clicked but a JWT exists in web storage. Joining the existing conversation."),L=r(z.JWT),ac(!1).then(()=>{a()}).catch(e=>{P();h("handleClick",e.message);b(e)});E(z.CONVERSATION_BUTTON_CLICK_TIME,Date.now(),!0,!0);Xb();m("handleClick","Conversation button clicked");Ia();(pa()&&!V()?Za():Promise.resolve(!0)).then(e=>{m("handleClick",`Received getAgentAvailability API response after button click: ${e}`);
!1===e?(Qc(),b("Agent Unavailable")):(Ob().then(()=>{a()}).catch(g=>{h("handleClick",g.message);b(g)}),(embeddedservice_bootstrap.settings.embeddedServiceConfig.fallbackMessage||{}).isFallbackMessageEnabled?Mb():xc().catch(g=>{P();h("handleClick",g.message);b(g)}),ba()&&embeddedservice_bootstrap.invitations.reset())}).catch(e=>{h("handleClick",`Failed to retrieve Agent Availability data. Returning with the default value as agentAvailable : false ${e}`);b(e)})}else c&&c.classList.contains("embeddedMessagingConversationButtonLoaded")&&
d&&d.classList&&d.classList.contains("isMaximized")?w("ESW_APP_MINIMIZE"):h("handleClick","Something went wrong handling button click event.")}catch(c){b(c)}})}function Qc(){var a;X(!1,!1);embeddedservice_bootstrap.generateMarkup();if(a=B())a.style.display="block",J()&&U(),a=Va(I("EmbeddedMessagingMinimizedState","AgentUnavailableText")||"Service reps are not available right now. Try again later."),embeddedservice_bootstrap.settings.targetElement.appendChild(a)}function Rc(a){let b=embeddedservice_bootstrap.utilAPI.getEmbeddedMessagingFrame();
a&&a.key&&(a.key===wa.SPACE||a.key===wa.ENTER?(a.preventDefault(),Fb()):a.key===wa.TAB&&a.shiftKey&&b&&b.classList&&b.classList.contains("isMaximized")&&(a.preventDefault(),w("trapfocustolast")))}function kb(a=!1){const b=document.getElementById("embeddedMessagingMinimizedNotification"),c=B();b&&(a&&"true"===b.getAttribute("is-invitation")&&Wa(!1),b.parentNode.removeChild(b));c&&c.focus()}function Sc(a){if(a.key===wa.ENTER||a.key===wa.SPACE)a.preventDefault(),kb(!0)}function N(){return!!r(z.JWT)}
function ac(a){if(r(z.JWT))return Xb(),Ob().catch(h),Nb().then(b=>{Ga(a).then(c=>{ra(b,c,null,a)})}).catch(h)}function X(a,b=!0){m("resetClientToInitialState","Resetting client to initial state.");try{Oa(a),mc(),q()}catch(c){h("resetClientToInitialState",`Error on clearing web storage for the previously ended conversation: ${c}`)}ha&&Zb();lb.test(navigator.userAgent)&&ib(!1);embeddedservice_bootstrap.removeMarkup();(pa()&&b?hb():Promise.resolve(!0)).then(()=>{bc()?cc().then(()=>dc()):dc()})}function dc(){if(v()===
x.UNAUTH||v()===x.EXP_SITE_AUTH&&!embeddedservice_bootstrap.settings.snippetConfig.isExpSiteGuestUser)v()===x.EXP_SITE_AUTH&&Fa(),embeddedservice_bootstrap.generateMarkup(),B()&&B().focus();m("resetClientToInitialState","Successfully reset client to initial state.");xa&&"function"===typeof xa&&(xa(),m("resolveClearSessionPromise","Resolved Clear Session promise."),xa=void 0)}function Tc(){const a=document.createElement("div");a.id="embeddedMessagingModalOverlay";return a}function Va(a,b=!1){const c=
document.createElement("div"),d=document.createElement("div"),e=document.createElement("span"),g=document.createElement("span"),n=Uc();c.id="embeddedMessagingMinimizedNotification";c.className="embeddedMessagingMinimizedNotification";c.style.setProperty("--eswNotificationBackgroundColor",O("chatButton"));embeddedservice_bootstrap.settings.embeddedServiceConfig.htmlDirection&&"string"===typeof embeddedservice_bootstrap.settings.embeddedServiceConfig.htmlDirection&&c.setAttribute("dir",embeddedservice_bootstrap.settings.embeddedServiceConfig.htmlDirection.toLowerCase());
b&&(c.setAttribute("is-invitation","true"),c.style.cursor="pointer",c.addEventListener("click",function(F){F&&F.target&&!F.target.closest(".embeddedMessagingMinimizedNotificationDismissButton")&&(Wa(!0),Xa())}));d.className="embeddedMessagingMinimizedNotificationTextWrapper";embeddedservice_bootstrap.settings.embeddedServiceConfig.htmlDirection&&"string"===typeof embeddedservice_bootstrap.settings.embeddedServiceConfig.htmlDirection&&d.setAttribute("dir",embeddedservice_bootstrap.settings.embeddedServiceConfig.htmlDirection.toLowerCase());
e.className="embeddedMessagingMinimizedNotificationText";embeddedservice_bootstrap.settings.embeddedServiceConfig.htmlDirection&&"string"===typeof embeddedservice_bootstrap.settings.embeddedServiceConfig.htmlDirection&&e.setAttribute("dir",embeddedservice_bootstrap.settings.embeddedServiceConfig.htmlDirection.toLowerCase());e.role="status";e.title=a;if(a)try{var l=a.replace(/<br>/gi,"<br/>")}catch(F){h("parseInvitationMarkdown","Failed to parse invitation markdown."),l=""}else l="";e.innerHTML=l;
e.style.setProperty("font-family",O("font"));e.style.setProperty("--eswNotificationTextColor",O("invitationText"));g.className="slds-assistive-text";g.innerHTML=I("EmbeddedMessagingMinimizedState","MinimizedNotificationAssistiveText")||"Expand the text.";d.appendChild(e);d.appendChild(g);c.appendChild(d);c.appendChild(n);return c}function Uc(){const a=document.createElement("button"),b=document.createElement("span"),c=document.createElement("span");a.className="embeddedMessagingMinimizedNotificationDismissButton";
a.addEventListener("click",d=>{d.stopPropagation();kb(!0)});a.addEventListener("keydown",Sc);a.setAttribute("aria-describedby","dismissButton-help");a.style.setProperty("--eswNotificationButtonColor",O("invitationDismissalButton"));a.style.setProperty("--eswNotificationButtonHoverColor",Ma.getHoverBackgroundColor(O("chatButton")));b.className="embeddedMessagingMinimizedNotificationDismissButtonText";b.appendChild(da(aa.DISMISS));b.setAttribute("aria-hidden","true");c.className="slds-assistive-text";
c.id="dismissButton-help";c.innerHTML=I("EmbeddedMessagingMinimizedState","MinimizedNotificationDismissButtonAssistiveText")||"Close the chat notification";a.appendChild(b);a.appendChild(c);return a}function Aa(a,b){a&&Ka.currentStateLogs.push(a);b&&Ka.errorLogs.push(b);Pa.then(()=>{w("EMBEDDED_MESSAGING_PUSH_PARENT_FRAME_LOGS",{pendingLogs:Ka});tb()})}function tb(){Ka={currentStateLogs:[],errorLogs:[]}}function mb(){}function Ya(a,b,c=!1){embeddedservice_bootstrap.utilAPI.getEmbeddedMessagingFrame()?
w("EMBEDDED_MESSAGING_CLEAR_USER_SESSION_EVENT",{shouldRevokeJwt:a,shouldEndSession:c}):X(b)}function Vb(a){return new Promise(b=>{m("renewAuthenticatedJwt","Renewing Authenticated JWT");Kb().then(()=>{ec(a);b()})})}function ec(a){a&&ua(a.apiPath,a.method,a.mode,a.requestHeaders,a.requestBody).then(b=>{a.resolve&&"function"===typeof a.resolve&&a.resolve(b)}).catch(b=>Ha(b,a.apiPath,a.method,a.mode,a.requestHeaders,a.requestBody))}function Tb(a){if(a){A("onEmbeddedMessagingIdentityTokenExpired");var b=
new Promise(d=>{ya=d}),c=new Promise((d,e)=>{setTimeout(()=>{e()},3E4)});Promise.race([b,c]).then(()=>{m("handleIdentityTokenExpiry","Valid identity token found. Fetch authenticated JWT.");a.apiPath.includes("/accessToken")?(a.requestBody.customerIdentityToken=G,ec(a)):Vb(a)}).catch(()=>{h("handleIdentityTokenExpiry","Failed to fetch authenticated JWT due to setIdentityToken timeout or other error. Clearing the messaging session on all tabs.");Ya(!1,!1)})}}function Cb(){let a;X(!1);embeddedservice_bootstrap.generateMarkup();
a=B();var b=document.getElementById("embeddedMessagingIconChat");var c=document.getElementById("embeddedMessagingIconContainer");a&&(a.style.display="block",a.setAttribute("tabindex",-1),a.style.setProperty("cursor","default"),a.classList.add("no-hover"),c&&b&&c.removeChild(b),J()&&U(),b=da(aa.ERROR),b.setAttribute("id","embeddedMessagingIconError"),b.setAttribute("class","embeddedMessagingIconError"),c.appendChild(b),c=Va(I("EmbeddedMessagingMinimizedState","JWTRetrievalFailureText")||"Something went wrong. Log in again to continue your messaging conversation."),
a.disabled=!0,embeddedservice_bootstrap.settings.targetElement.appendChild(c))}function fc(a){a=a.split(".")[1].replace(/-/g,"+").replace(/_/g,"/");a=decodeURIComponent(window.atob(a).split("").map(function(b){return"%"+("00"+b.charCodeAt(0).toString(16)).slice(-2)}).join(""));return JSON.parse(a)}function Da(a){let b,c;if(!a)return embeddedservice_bootstrap.settings.devMode&&m("validateJwt","Empty jwt parameter passed in - skipping validation."),!1;try{return b=fc(a),c=Math.floor(Date.now()/1E3)<
b.exp,embeddedservice_bootstrap.settings.devMode&&!c&&m("validateJwt",`JWT has expired at ${(new Date(1E3*b.exp)).toString()}`),c}catch(d){return embeddedservice_bootstrap.settings.devMode&&h("validateJwt",`JWT validation failed: ${d.message}`),!1}}function v(){let a=null;try{a=embeddedservice_bootstrap.settings.embeddedServiceConfig&&embeddedservice_bootstrap.settings.embeddedServiceConfig.embeddedServiceMessagingChannel&&embeddedservice_bootstrap.settings.embeddedServiceConfig.embeddedServiceMessagingChannel.authMode}catch(b){h("getAuthMode",
`Failed to retrieve auth mode flag: ${b.message}`)}return a}function R(){return v()===x.AUTH||v()===x.EXP_SITE_AUTH}function za(){}function gc(a,b,c,d){const e="setHiddenPrechatFields"===a;var g=e?Vc():ia();const n=g.map(({name:l})=>l);g=g.find(l=>l.name===b);return n.includes(b)?"string"===typeof c&&(c.toLowerCase().includes("javascript:")||c.toLowerCase().includes("<script>"))?(h("validatePrechatField",`JavaScript isn't allowed in the value for the ${b} field when calling ${a}.`),!1):c&&String(c).length>
g.maxLength?(h("validatePrechatField",`Value for the ${b} field in ${a} exceeds the maximum length restriction of ${g.maxLength} characters.`),!1):e&&"string"!==typeof c?(h("validatePrechatField",`You must specify a string for the ${b} field in ${a} instead of a ${typeof c} value.`),!1):d&&"boolean"!==typeof d?(h("validatePrechatField","setVisiblePrechatFields was called with isEditableByEndUser set to a value that\u2019s not boolean. Enter a boolean value."),!1):!0:(h("validatePrechatField",`${a} called with an invalid field name ${b}.`),
!1)}function Vc(){let a=[];var b=Array.isArray(embeddedservice_bootstrap.settings.embeddedServiceConfig.forms)&&embeddedservice_bootstrap.settings.embeddedServiceConfig.forms.length&&Array.isArray(embeddedservice_bootstrap.settings.embeddedServiceConfig.forms[0].hiddenFormFields)?!0:!1;b&&(a=embeddedservice_bootstrap.settings.embeddedServiceConfig.forms[0].hiddenFormFields);return a}function ia(){return Array.isArray(embeddedservice_bootstrap.settings.embeddedServiceConfig.forms)&&embeddedservice_bootstrap.settings.embeddedServiceConfig.forms.length&&
Array.isArray(embeddedservice_bootstrap.settings.embeddedServiceConfig.forms[0].formFields)&&embeddedservice_bootstrap.settings.embeddedServiceConfig.forms[0].formFields.length?embeddedservice_bootstrap.settings.embeddedServiceConfig.forms[0].formFields:[]}function La(a){return M?!0:(h("shouldProcessPrechatFieldsFromHost",`Can't call ${a} before the onEmbeddedMessagingReady event is fired.`),!1)}function Hc(a){return"string"===typeof a&&0<a.trim().length?!0:!1}function nc(){ia().forEach(a=>{delete a.value;
delete a.isEditableByEndUser})}function nb(){}function hc(a){return M?!0:(h("shouldProcessAutoResponseParametersFromHost",`[${a}] Cannot invoke Auto-Response API before the onEmbeddedMessagingReady event is fired.`),!1)}function W(){}function ob(){}function D(){this.settings={devMode:!1,targetElement:document.body};this.isSessionStorageAvailable=this.isLocalStorageAvailable=!0;Object.defineProperties(aa,{CHAT:{value:"M50 0c27.614 0 50 20.52 50 45.833S77.614 91.667 50 91.667c-8.458 0-16.425-1.925-23.409-5.323-13.33 6.973-21.083 9.839-23.258 8.595-2.064-1.18.114-8.436 6.534-21.767C3.667 65.54 0 56.08 0 45.833 0 20.52 22.386 0 50 0zm4.583 61.667H22.917a2.917 2.917 0 000 5.833h31.666a2.917 2.917 0 000-5.833zm12.5-15.834H22.917a2.917 2.917 0 000 5.834h44.166a2.917 2.917 0 000-5.834zM79.583 30H22.917a2.917 2.917 0 000 5.833h56.666a2.917 2.917 0 000-5.833z"},
MINIMIZE_MODAL:{value:"M47.6,17.8L27.1,38.5c-0.6,0.6-1.6,0.6-2.2,0L4.4,17.8c-0.6-0.6-0.6-1.6,0-2.2l2.2-2.2 c0.6-0.6,1.6-0.6,2.2,0l16.1,16.3c0.6,0.6,1.6,0.6,2.2,0l16.1-16.2c0.6-0.6,1.6-0.6,2.2,0l2.2,2.2C48.1,16.3,48.1,17.2,47.6,17.8z"},DISMISS:{value:"M75.129 24.871a6.25 6.25 0 010 8.839L58.839 50l16.29 16.29a6.25 6.25 0 01-8.839 8.839L50 58.839 33.71 75.129a6.25 6.25 0 01-8.839-8.839L41.161 50 24.871 33.71a6.25 6.25 0 018.839-8.839L50 41.161l16.29-16.29a6.25 6.25 0 018.839 0z"},ERROR:{value:"M15.9997 1.23096C7.87662 1.23096 1.23047 7.87711 1.23047 16.0002C1.23047 24.1233 7.87662 30.7694 15.9997 30.7694C24.1228 30.7694 30.7689 24.1233 30.7689 16.0002C30.7689 7.87711 24.1228 1.23096 15.9997 1.23096ZM4.92282 16.0001C4.92282 9.90783 9.90744 4.92321 15.9997 4.92321C18.3997 4.92321 20.6151 5.66167 22.3997 6.95398L6.95359 22.4001C5.66128 20.6155 4.92282 18.4001 4.92282 16.0001V16.0001ZM15.9995 27.0772C13.5995 27.0772 11.3841 26.3387 9.59946 25.0464L25.0456 9.60024C26.3379 11.3849 27.0764 13.6002 27.0764 16.0002C27.0764 22.0926 22.0918 27.0772 15.9995 27.0772Z"},
INNER_ARC:{value:"M35.526 48.684A35.526 35.526 0 0 0 0 13.158V0a48.684 48.684 0 0 1 0 97.368V84.211a35.526 35.526 0 0 0 35.526-35.527Z"},OUTER_ARC:{value:"M50 8.333C26.987 8.333 8.333 26.987 8.333 50S26.987 91.667 50 91.667V100C22.387 100 0 77.613 0 50S22.387 0 50 0s50 22.387 50 50h-8.333C91.667 26.987 73.013 8.333 50 8.333Z"}});this.brandingData=[]}function Wc(){const a=document.createElement("iframe"),b=new URL(`${H()}/assets/htdocs/sitecontext${embeddedservice_bootstrap.settings.devMode?"":".min"}.html`);
b.searchParams.set("parent_domain",window.location.origin);embeddedservice_bootstrap.settings.devMode&&b.searchParams.set("dev_mode",!0);a.classList.add("embeddedMessagingSiteContextFrame");a.id="embeddedMessagingSiteContextFrame";a.name="embeddedMessagingSiteContextFrame";a.src=b.href;a.onload=()=>{m("createSiteContextFrame","Created an iframe for siteContext.")};embeddedservice_bootstrap.siteContextFrame=a;document.body.appendChild(a)}function U(){let a=document.querySelector(".embeddedMessagingGRecaptchaBanner .grecaptcha-badge");
a&&(a.style.visibility="hidden")}function J(){const a=embeddedservice_bootstrap.settings.embeddedServiceConfig.messagingChannel;return null!=a&&null!=a.captchaInfo&&a.captchaInfo.siteKey}function bc(){const a=v()!==x.EXP_SITE_AUTH,b="undefined"===typeof pb||"undefined"===typeof grecaptcha;return J()&&!N()&&a&&b}function cc(){return new Promise((a,b)=>{var c=document.getElementById("embeddedMessagingRecaptchaBanner");c&&c.parentNode&&c.parentNode.removeChild(c);const d=embeddedservice_bootstrap.settings.embeddedServiceConfig.messagingChannel.captchaInfo.siteKey;
c=document.createElement("script");c.src="https://www.google.com/recaptcha/api.js?render=explicit";const e=document.createElement("div");e.id="embeddedMessagingRecaptchaBanner";e.classList.add("embeddedMessagingGRecaptchaBanner");let g="bottomright";g=embeddedservice_bootstrap.settings.embeddedServiceConfig.htmlDirection&&"string"===typeof embeddedservice_bootstrap.settings.embeddedServiceConfig.htmlDirection&&"rtl"===embeddedservice_bootstrap.settings.embeddedServiceConfig.htmlDirection.toLowerCase()?
"bottomleft":g;embeddedservice_bootstrap.settings.targetElement.appendChild(e);c.onload=function(){grecaptcha.ready(function(){pb=grecaptcha.render("embeddedMessagingRecaptchaBanner",{sitekey:d,size:"invisible",badge:g});a("ReCaptcha script loaded")})};c.onerror=function(n){n=(null==n?void 0:n.message)||n;t("loadReCaptchaScript",n);b(n)};embeddedservice_bootstrap.settings.targetElement.appendChild(c)})}function Rb(){return new Promise((a,b)=>{try{grecaptcha.ready(function(){grecaptcha.execute(pb,
{action:"AccessTokenRequest"}).then(function(c){a(c)}).catch(function(c){c=(null==c?void 0:c.message)||c;m("handleReCaptchaTokenGeneration",c);b(c)})})}catch(c){const d=(null==c?void 0:c.message)||c;t("handleReCaptchaTokenGeneration",d);b(d)}})}function pa(){const a=embeddedservice_bootstrap.settings.embeddedServiceConfig.messagingChannel;return!embeddedservice_bootstrap.settings.hideChatButtonOnLoad&&null!=a&&!!a.isAgentAvailabilityCheckEnabled}function hb(){return new Promise((a,b)=>{const c=()=>
{N()?a(!0):Ua?Za().then(d=>{m("getAgentAvailability",`Received getAgentAvailability API response: ${d}`);!0===d?(Ia(),Xc(),a(!0)):setTimeout(c,6E4)}).catch(d=>{d("getAgentAvailability",`getAgentAvailability API call failed, retrying in ${6E4} milliseconds: ${d}`);setTimeout(c,6E4)}):setTimeout(c,6E4)};c()})}function Xc(){qb=setInterval(()=>{N()?(embeddedservice_bootstrap.utilAPI.showChatButton(),Ia()):Ua&&Za().then(a=>{m("setupAgentAvailabilityTimer",`Received getAgentAvailability API response: ${a}`);
!0===a?Q()&&(v()===x.UNAUTH||v()===x.EXP_SITE_AUTH&&!embeddedservice_bootstrap.settings.snippetConfig.isExpSiteGuestUser)&&embeddedservice_bootstrap.utilAPI.showChatButton():embeddedservice_bootstrap.utilAPI.hideChatButton()}).catch(a=>{a("setupAgentAvailabilityTimer",`getAgentAvailability API call failed, hiding chat button and retrying in ${6E4} milliseconds: ${a}`);embeddedservice_bootstrap.utilAPI.hideChatButton()})},6E4)}function Ia(){clearInterval(qb);qb=void 0}const aa={},x={AUTH:"Auth",UNAUTH:"UnAuth",
EXP_SITE_AUTH:"ExperienceSiteAuth"},yc={CONVERSATION:"Conversation",SESSION:"Session"},Yb={INLINE:"inline",POPUP:"default"};class Ma{static isValidContrastRatio(a,b,c=3){return this.getContrastRatio(a,b)>=c}static getContrastRatio(a,b){a=this.convertHexToRGB(a);b=this.convertHexToRGB(b);a=this.getRelativeLuminance(a);b=this.getRelativeLuminance(b);return((Math.max(a,b)+.05)/(Math.min(a,b)+.05)).toFixed(2)}static getRelativeLuminance(a){const [b,c,d]=Object.values(a).map(e=>this.getSRGB(e));return.2126*
b+.7152*c+.0722*d}static getSRGB(a){a/=255;return.03928>=a?a/12.92:Math.pow((a+.055)/1.055,2.4)}static convertHexToRGB(a){const b=parseInt(a.slice(1,3),16),c=parseInt(a.slice(3,5),16);a=parseInt(a.slice(5,7),16);return{r:b,g:c,b:a}}static convertRGBToHex(a,b,c){return"#"+(16777216+(a<<16)+(b<<8)+c).toString(16).slice(1)}static getHoverBackgroundColor(a){a=this.convertHexToRGB(a);const b=.027321<=this.getRelativeLuminance(a).toFixed(6)?-22:22;return this.convertRGBToHex(Math.max(0,a.r+b),Math.max(0,
a.g+b),Math.max(0,a.b+b))}}const Yc=".salesforce.com .force.com .sfdc.net .site.com .salesforce-sites.com .crm.dev .crmforce.mil .salesforce.mil".split(" "),eb={JWT:"JWT"},Gb=document.title;let pb,qa,ic=!1,M=!1,ca=!1,la=!1,Sa=!1,Ra=!1,S={},ka={},L,G,u,C,Qa,Pa=new Promise(a=>{Qa=a}),zb;const Nc=new Promise(a=>{zb=a});let Ab,jc=new Promise(a=>{Ab=a}),ha,T,va,cb,jb;const z={JWT:"JWT",FAILED_OUTBOUND_MESSAGE_ENTRIES:"FAILED_MESSAGES",CONVERSATION_BUTTON_CLICK_TIME:"CONVERSATION_BUTTON_CLICK_TIME",PAGE_COUNT:"PAGE_COUNT",
SITE_TIME:"SITE_TIME",INVITATION_ACCEPTED:"INVITATION_ACCEPTED",INVITATION_REJECTED:"INVITATION_REJECTED"},wa={ENTER:"Enter",TAB:"Tab",SPACE:" "},lb=/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i,bb={AURA:"AURA",LWR:"LWR"};let xa,na,
ma,ya,Ka={currentStateLogs:[],errorLogs:[]},Bb,kc=new Promise(a=>{Bb=a}),qb,Ua=!0;const ta={"x-b3-traceId":void 0,"x-b3-spanId":void 0};D.prototype.removeEventHandlers=function(){window.removeEventListener("message",wb);window.removeEventListener("storage",xb)};D.prototype.emitEmbeddedMessagingReadyEvent=function(){M=!0;try{A("onEmbeddedMessagingReady")}catch(a){M=!1,h("emitEmbeddedMessagingReadyEvent",`Something went wrong in firing onEmbeddedMessagingReady event ${a}.`)}};D.prototype.removeMarkup=
function(a){const b=embeddedservice_bootstrap.utilAPI.getEmbeddedMessagingFrame(),c=B(),d=document.getElementById("embeddedMessagingModalOverlay"),e=document.getElementById("embeddedMessagingMinimizedNotification"),g=Y(),n=document.getElementById("inert-script");b?b.parentNode.removeChild(b):t("removeMarkup","Embedded Messaging iframe not available for resetting the client to initial state.");embeddedservice_bootstrap.filePreviewFrame&&embeddedservice_bootstrap.filePreviewFrame.parentNode?embeddedservice_bootstrap.filePreviewFrame.parentNode.removeChild(embeddedservice_bootstrap.filePreviewFrame):
t("removeMarkup","Embedded Messaging file preview iframe not available for resetting the client to initial state.");a&&embeddedservice_bootstrap.siteContextFrame&&embeddedservice_bootstrap.siteContextFrame.parentNode?embeddedservice_bootstrap.siteContextFrame.parentNode.removeChild(embeddedservice_bootstrap.siteContextFrame):t("removeMarkup","Embedded Messaging site context iframe not available for resetting the client to initial state.");d&&d.parentNode.removeChild(d);document.body.classList.contains("embeddedMessagingPreventScrolling")&&
(document.body.classList.remove("embeddedMessagingPreventScrolling"),embeddedservice_bootstrap.documentScrollPosition&&window.scrollTo(0,embeddedservice_bootstrap.documentScrollPosition));c?c.parentNode.removeChild(c):t("removeMarkup","Embedded Messaging static button not available for resetting the client to initial state.");e&&e.parentNode.removeChild(e);g&&g.parentNode.removeChild(g);n&&n.parentNode.removeChild(n);embeddedservice_bootstrap.emitEmbeddedMessagingReadyEvent();Ca()};mb.prototype.setIdentityToken=
function(a){let b;if(!M)return h("setIdentityToken","Method can\u2019t be invoked before the onEmbeddedMessagingReady event is fired."),!1;if(v()!==x.AUTH)return h("setIdentityToken","User Verification isn\u2019t enabled in Messaging Settings."),!1;if(!a||null===a||"object"!==typeof a)return h("setIdentityToken","Invalid identity token parameter passed into the setIdentityToken method. Specify a valid object containing the token data."),!1;b=a.identityTokenType;a=a.identityToken;if("string"!==typeof b||
b.trim().toUpperCase()!==eb.JWT)return h("setIdentityToken","Unsupported identity token. Only JWT-based identity tokens are supported."),!1;let c=!1;switch(b){case eb.JWT:c=Da(a)}if(!c)return h("setIdentityToken","Invalid identity token passed into the setIdentityToken method."),!1;G=a;ya&&"function"===typeof ya&&(ya(),ya=void 0);m("setIdentityToken","Successfully set the customer identity token.");embeddedservice_bootstrap.utilAPI.getEmbeddedMessagingFrame()?w("EMBEDDED_MESSAGING_SET_IDENTITY_TOKEN_EVENT",
G):B()?B()&&document.getElementById("embeddedMessagingIconError")&&(embeddedservice_bootstrap.removeMarkup(),embeddedservice_bootstrap.generateMarkup()):embeddedservice_bootstrap.generateMarkup();return!0};mb.prototype.clearSession=function(a){return new Promise((b,c)=>{xa=b;M?Ya(R(),!1,a):(c("Method can't be invoked before the onEmbeddedMessagingReady event is fired."),h("clearSession","Method cannot be invoked before the onEmbeddedMessagingReady event is fired."))})};za.prototype.setHiddenPrechatFields=
function(a){if(La("setHiddenPrechatFields"))if(a&&"object"===typeof a)for(const [b,c]of Object.entries(a))gc("setHiddenPrechatFields",b,c)&&(S[b]=c,m("setHiddenPrechatFields",`[setHiddenPrechatFields] Successfully updated Hidden Pre-Chat field ${b}.`));else h("setHiddenPrechatFields","When calling setHiddenPrechatFields, you must pass in an object with key-value pairs.")};za.prototype.removeHiddenPrechatFields=function(a){La("removeHiddenPrechatFields")&&(a&&Array.isArray(a)?a.forEach(function(b){S.hasOwnProperty(b)?
(delete S[b],m("removeHiddenPrechatFields",`[removeHiddenPrechatFields] Successfully removed Hidden Pre-Chat field ${b}.`)):h("removeHiddenPrechatFields",`removeHiddenPrechatFields called with an invalid field name ${b}.`)}):h("removeHiddenPrechatFields","When calling removeHiddenPrechatFields, you must pass in an array of fields."))};za.prototype.setVisiblePrechatFields=function(a){if(La("setVisiblePrechatFields")){var b=ia();if(a&&"object"===typeof a&&!Array.isArray(a)){a=Object.entries(a);for(const [c,
d]of a)if(gc("setVisiblePrechatFields",c,d.value,d.isEditableByEndUser)){const e=b.find(g=>g.name===c);e.value=d.value;"boolean"===typeof d.isEditableByEndUser&&(e.isEditableByEndUser=d.isEditableByEndUser);m("setVisiblePrechatFields",`[setVisiblePrechatFields] Successfully updated Visible Pre-Chat field ${c}.`)}a.length&&kc.then(()=>{w("EMBEDDED_MESSAGING_PUSH_VISIBLE_PRECHAT_FIELDS",ia())})}else h("setVisiblePrechatFields","setVisiblePrechatFields was called with an invalid object. Pass in an object with key-value pairs.")}};
za.prototype.unsetVisiblePrechatFields=function(a){if(La("unsetVisiblePrechatFields")){var b=ia();a&&Array.isArray(a)&&a.length?(a.forEach(c=>{const d=b.find(e=>e.name===c);d?(delete d.value,delete d.isEditableByEndUser,m("unsetVisiblePrechatFields",`[unsetVisiblePrechatFields] Successfully unset Visible Pre-Chat field ${c}.`)):h("unsetVisiblePrechatFields",`unsetVisiblePrechatFields was called with an invalid field name: ${c}. Enter a valid field name to remove.`)}),kc.then(()=>{w("EMBEDDED_MESSAGING_PUSH_VISIBLE_PRECHAT_FIELDS",
ia())})):h("unsetVisiblePrechatFields","When calling unsetVisiblePrechatFields, you must pass in an array of fields.")}};nb.prototype.setAutoResponseParameters=function(a){if(hc("setAutoResponseParameters"))if(a&&"object"===typeof a)for(const [c,d]of Object.entries(a)){a=c;var b=d;"string"!==typeof a||1>a.trim().length?(h("validateAutoResponseParameter",`Expected a non-empty string for the parameter name, but received ${typeof a}`),a=!1):"string"!==typeof b||1>b.trim().length?(h("validateAutoResponseParameter",
`Expected a non-empty string for the parameter value, but received ${typeof b}`),a=!1):a=!0;a?(ka[c]=d,m("setAutoResponseParameters",`[setAutoResponseParameters] Successfully updated auto-response parameter ${c}`)):t("setAutoResponseParameters",`[setAutoResponseParameters] Failed to validate auto-response parameter ${c}`)}else h("setAutoResponseParameters","[setAutoResponseParameters] Must pass in an object of parameters as key-value pairs.")};nb.prototype.removeAutoResponseParameters=function(a){hc("removeAutoResponseParameters")&&
(a&&Array.isArray(a)?a.forEach(function(b){ka.hasOwnProperty(b)?(delete ka[b],m("removeAutoResponseParameters",`[removeAutoResponseParameters] Successfully removed auto-response parameter ${b}`)):t("removeAutoResponseParameters",`[removeAutoResponseParameters] Failed to validate auto-response parameter ${b}`)}):h("removeAutoResponseParameters","[removeAutoResponseParameters] Must pass in an array of parameter names."))};W.prototype.getEmbeddedMessagingFrame=function(){return document.getElementById("embeddedMessagingFrame")};
W.prototype.prefetchResources=$b;W.prototype.showChatButton=function(){var a=v();if(!M)return h("showChatButton","Method can't be invoked before the onEmbeddedMessagingReady event is fired."),!1;if(a===x.UNAUTH||G){if(a=B())return a.style.display="block",ba()&&embeddedservice_bootstrap.invitations.evaluate(),!0;V()&&Ca(!0)}else h("showChatButton","Can't call showChatButton for a verified user before calling the setIdentity method with a valid token.");return!1};W.prototype.hideChatButton=function(){if(!M)return h("hideChatButton",
"Method can't be invoked before the onEmbeddedMessagingReady event is fired."),!1;if(embeddedservice_bootstrap.utilAPI.getEmbeddedMessagingFrame())h("hideChatButton","Can\u2019t call hideChatButton once the messaging window is showing.");else{var a=document.getElementById("embeddedMessagingMinimizedNotification");a&&a.parentNode.removeChild(a);if(a=B())return a.style.display="none",!0;V()&&Ca(!1)}return!1};W.prototype.launchChat=function(){return new Promise((a,b)=>{let c;const d=()=>{let g;ca||la?
(g="[Launch Chat API] Successfully initialized the messaging client.",m("launchChat",g),a(g),window.removeEventListener("onEmbeddedMessagingInitSuccess",d),window.removeEventListener("onEmbeddedMessagingInitError",e)):(g="[Launch Chat API] The messaging client initialized successfully or failed event isn\u2019t fired.",t("launchChat",g),b(g))},e=()=>{let g;ca||la?(g="[Launch Chat API] Error launching the messaging client.",h("handleBootstrapError",g),b(g),window.removeEventListener("onEmbeddedMessagingInitSuccess",
d),window.removeEventListener("onEmbeddedMessagingInitError",e),X()):(g="[Launch Chat API] The messaging client initialized successfully or failed event isn\u2019t fired.",t("launchChat",g),b(g))};try{if(M){if(!B())if(V()&&(!R()||R()&&G))embeddedservice_bootstrap.generateMarkup(!0);else{c="[Launch Chat API] Default chat button isn\u2019t present. Check if the messaging client initialized successfully.";t("launchChat",c);b(c);return}if(embeddedservice_bootstrap.utilAPI.getEmbeddedMessagingFrame()){let g=
embeddedservice_bootstrap.utilAPI.getEmbeddedMessagingFrame();g&&g.classList&&g.classList.contains("isMinimized")?(w("ESW_APP_MAXIMIZE"),m("launchChat","[Launch Chat API] Successfully maximized the messaging client."),a("[Launch Chat API] Successfully maximized the messaging client.")):(c="[Launch Chat API] The messaging client window is already present and maximized.",t("launchChat",c),a(c))}else window.addEventListener("onEmbeddedMessagingInitSuccess",d),window.addEventListener("onEmbeddedMessagingInitError",
e),Xa().catch(g=>{c=`[Launch Chat API] Error when API simulates clicking the custom messaging client button: ${g}`;h("launchChat",c);b(c)})}else c="[Launch Chat API] Can\u2019t invoke API before the onEmbeddedMessagingReady event is fired.",t("launchChat",c),b(c)}catch(g){c=`[Launch Chat API] Something went wrong launching the API: ${g}`,h("launchChat",c),b(c)}})};W.prototype.sendTextMessage=function(a){return new Promise((b,c)=>{try{Sa?(na=b,ma=c,w("EMBEDDED_MESSAGING_PUBLIC_SEND_TEXT_MESSAGE_API_REQUEST",
a)):(h("sendTextMessage","[Send Text Message API] Can\u2019t invoke API before the onEmbeddedMessagingConversationOpened event is fired."),c("[Send Text Message API] Can\u2019t invoke API before the onEmbeddedMessagingConversationOpened event is fired."))}catch(d){ma=na=void 0,b=`[Send Text Message API] Something went wrong sending text message: ${d}`,h("sendTextMessage",b),c(b)}})};W.prototype.removeAllComponents=function(){return new Promise(a=>{embeddedservice_bootstrap.removeMarkup(!0);embeddedservice_bootstrap.removeEventHandlers();
document.querySelector("#embeddedMessagingBootstrapStyles")&&document.querySelector("#embeddedMessagingBootstrapStyles").remove();const b=`${H()}/assets/js/bootstrap`+(embeddedservice_bootstrap.settings.devMode?"":".min")+".js";document.body.querySelector(`script[src="${b}"]`)&&document.body.querySelector(`script[src="${b}"]`).remove();m("removeAllComponents","Successfully removed all components.");delete window.embeddedservice_bootstrap;a()})};ob.prototype.setCustomVariables=function(a){embeddedservice_bootstrap.invitations.setCustomVariable(a)};
ob.prototype.removeCustomVariables=function(a){embeddedservice_bootstrap.invitations.removeCustomVariables(a)};D.prototype.isValidEntityId=function(a){return"string"===typeof a&&(18===a.length||15===a.length)};D.prototype.getKeyPrefix=function(a){if(embeddedservice_bootstrap.isValidEntityId(a))return a.substr(0,3)};D.prototype.isOrganizationId=function(a){return"00D"===embeddedservice_bootstrap.getKeyPrefix(a)};D.prototype.isMessageFromSalesforceDomain=function(a){var b=a.split(":")[1].replace("//",
"");if(Ja()&&b===document.domain)return!0;var c=function(d,e){return-1!==d.indexOf(e,d.length-e.length)};return Yc.some(function(d){return c(b,d)})};D.prototype.isMessageFromCustomDomain=function(a){a=a.split(":")[1].replace("//","");return"string"===typeof embeddedservice_bootstrap.settings.customDomain&&a===embeddedservice_bootstrap.settings.customDomain};D.prototype.generateMarkup=function(a=!1){var b=document.createDocumentFragment(),c=Y(),d=B();if(J()){var e=document.querySelector(".embeddedMessagingGRecaptchaBanner .grecaptcha-badge");
e&&(e.classList.remove("isMaximized"),"hidden"===e.style.visibility&&(e.style.visibility="visible"))}if(V()&&!a)Ca();else if(!c||!d){c=document.createElement("div");c.id="embedded-messaging";c.className="embedded-messaging"+(fa()?`-${Yb.INLINE}`:"");a=document.createElement("div");d=document.createElement("button");f()||document.documentElement.style.setProperty("--eswIconFillColor","#1A1B1E");e=document.createElement("div");const g=O("fabImage");let n;g&&0<g.length?(n=document.createElement("img"),
n.src=g,n.setAttribute("alt",""),n.setAttribute("aria-hidden","true")):n=da(aa.CHAT);n.setAttribute("id","embeddedMessagingIconChat");n.setAttribute("class","embeddedMessagingIconChat");e.id="embeddedMessagingIconContainer";e.className="embeddedMessagingIconContainer";e.appendChild(n);a.className="embeddedMessagingConversationButtonWrapper";d.classList.add("embeddedMessagingConversationButton");d.id="embeddedMessagingConversationButton";d.href="javascript:void(0)";d.addEventListener("click",Fb);d.addEventListener("keydown",
Rc);d.setAttribute("tabindex",0);d.setAttribute("role","button");d.setAttribute("aria-label",I("EmbeddedMessagingMinimizedState","DefaultMinimizedText")||"Hello, have a question? Let\u2019s chat.");d.setAttribute("title",I("EmbeddedMessagingMinimizedState","DefaultMinimizedText")||"Hello, have a question? Let\u2019s chat.");d.style.setProperty("--eswButtonColor",O("chatButton"));d.style.setProperty("--eswButtonHoverColor",Ma.getHoverBackgroundColor(O("chatButton")));embeddedservice_bootstrap.settings.hasBottomTabBar&&
d.classList.add("embeddedMessagingBottomTabBar");if((!Q()||embeddedservice_bootstrap.settings.hideChatButtonOnLoad)&&!N()||fa())d.style.display="none";embeddedservice_bootstrap.settings.embeddedServiceConfig.htmlDirection&&"string"===typeof embeddedservice_bootstrap.settings.embeddedServiceConfig.htmlDirection&&d.setAttribute("dir",embeddedservice_bootstrap.settings.embeddedServiceConfig.htmlDirection.toLowerCase());Ja()&&d.classList.add("eswExperienceSite");d.appendChild(e);a.appendChild(d);d=a;
b.appendChild(c);c.appendChild(d);embeddedservice_bootstrap.settings.targetElement.appendChild(b);try{A("onEmbeddedMessagingButtonCreated",{detail:{buttonVisibility:Q()&&!embeddedservice_bootstrap.settings.hideChatButtonOnLoad||N()?"Show":"Hide"}})}catch(l){h("onEmbeddedMessagingButtonCreated",`Something went wrong in firing onEmbeddedMessagingButtonCreated event ${l}.`)}document.getElementById("inert-script")||(b=document.createElement("script"),c=`${H()}/assets/js/inert${embeddedservice_bootstrap.settings.devMode?
"":".min"}.js`,b.id="inert-script",b.type="text/javascript",b.src=c,embeddedservice_bootstrap.settings.targetElement.appendChild(b));b=document.createElement("div");b.id="embeddedMessagingLiveRegion";b.setAttribute("aria-live","assertive");b.setAttribute("aria-atomic","true");b.classList.add("embeddedMessagingLiveRegion");Y().appendChild(b)}};D.prototype.createFilePreviewFrame=function(){const a=document.createElement("iframe"),b=new URL(`${H()}/assets/htdocs/filepreview${embeddedservice_bootstrap.settings.devMode?
"":".min"}.html`);b.searchParams.set("parent_domain",window.location.origin);a.classList.add("embeddedMessagingFilePreviewFrame");a.id="embeddedMessagingFilePreviewFrame";a.name="embeddedMessagingFilePreviewFrame";a.src=b.href;a.title=I("EmbeddedMessagingIframesAndContents","FilePreviewIframeTitle")||"Enlarged image preview";a.onload=()=>{m("createFilePreviewFrame","Created an iframe for file preview.")};embeddedservice_bootstrap.filePreviewFrame=a;document.body.appendChild(a)};D.prototype.createIframe=
function(){return new Promise((a,b)=>{try{const c=Y(),d=document.createElement("iframe"),e=Tc();d.className="embeddedMessagingFrame";d.id="embeddedMessagingFrame";d.onload=a;d.onerror=b;d.style.backgroundColor="transparent";"string"===typeof embeddedservice_bootstrap.settings.iframeAllow&&(d.allow=embeddedservice_bootstrap.settings.iframeAllow);d.allowTransparency="true";d.setAttribute("aria-label",I("EmbeddedMessagingChatHeader","ChatWindowAssistiveText")||"Chat Window");d.setAttribute("role","dialog");
d.setAttribute("aria-modal","true");d.setAttribute("data-f6-region","");fa()&&d.classList.add("embeddedMessagingFrameInline");embeddedservice_bootstrap.settings.omitSandbox||(d.sandbox="allow-scripts allow-same-origin allow-modals allow-downloads allow-popups allow-popups-to-escape-sandbox");embeddedservice_bootstrap.settings.isAuraSite?Oc(d):Pc(d);embeddedservice_bootstrap.settings.hasBottomTabBar&&(d.classList.remove("embeddedMessagingFrameMinimizedBottomTabBar"),d.classList.add("embeddedMessagingFrameMaximizedBottomTabBar"));
Db()?d.classList.add("eswMobilePublisher"):Ja()?d.classList.add("eswExperienceSite"):gb()&&d.classList.add("eswIsDesktop");embeddedservice_bootstrap.settings.embeddedServiceConfig.htmlDirection&&"string"===typeof embeddedservice_bootstrap.settings.embeddedServiceConfig.htmlDirection&&d.setAttribute("dir",embeddedservice_bootstrap.settings.embeddedServiceConfig.htmlDirection.toLowerCase());d.onload=()=>{m("createIframe","Created Embedded Messaging frame.")};c.appendChild(e);c.appendChild(d)}catch(c){b(c)}})};
D.prototype.bootstrapEmbeddedMessaging=function(){try{return embeddedservice_bootstrap.utilAPI.launchChat()}catch(a){throw Error("[Bootstrap API] Something went wrong bootstrapping Embedded Messaging: "+a);}};D.prototype.maximizeIframe=function(a,b){const c=B();var d=document.getElementById("embeddedMessagingModalOverlay");const e=document.getElementById("embeddedMessagingIconChat"),g=document.getElementById("embeddedMessagingIconContainer"),n=document.querySelector('meta[name="viewport"]'),l=!!navigator.userAgent.match(/iP(hone|ad|od)/i),
F=document.querySelector(".embeddedMessagingGRecaptchaBanner .grecaptcha-badge");a&&(a.classList.add("isMaximized"),a.classList.remove("isMinimized"),a.classList.remove("hasMinimizedNotification"),embeddedservice_bootstrap.settings.hasBottomTabBar&&(a.classList.remove("embeddedMessagingFrameMinimizedBottomTabBar"),a.classList.add("embeddedMessagingFrameMaximizedBottomTabBar")),a=b&&b.height?`${b.height}px`:"480px",document.documentElement.style.setProperty("--eswWidth",b&&b.width?`${b.width}px`:"320px"),
document.documentElement.style.setProperty("--eswHeight",a));c&&(c.style.display="none",c.setAttribute("tabindex",-1),c.setAttribute("aria-label",I("EmbeddedMessagingChatHeader","MinimizeButtonAssistiveText")||"Minimize the chat window"),c.setAttribute("title",I("EmbeddedMessagingChatHeader","MinimizeButtonAssistiveText")||"Minimize the chat window"),e.style.display="none",document.getElementById("embeddedMessagingIconMinimize")||(b=da(aa.MINIMIZE_MODAL),b.setAttribute("id","embeddedMessagingIconMinimize"),
b.setAttribute("class","embeddedMessagingIconMinimize"),g.insertBefore(b,e)));d&&!d.classList.contains("isMaximized")&&d.classList.add("isMaximized");gb()||document.body.classList.contains("embeddedMessagingPreventScrolling")||(document.scrollingElement?embeddedservice_bootstrap.documentScrollPosition=document.scrollingElement.scrollTop:(d=document.documentElement.getBoundingClientRect(),embeddedservice_bootstrap.documentScrollPosition=Math.abs(d.top)),document.body.classList.add("embeddedMessagingPreventScrolling"));
l&&n?(ha=n.content,n.setAttribute("content","width=device-width, initial-scale=1, maximum-scale=1")):"Android"===fb().os.name&&"Chrome"===fb().browser.name&&n&&(ha=n.content,n.setAttribute("content","width=device-width, initial-scale=1, minimum-scale=1, interactive-widget=resizes-content"));lb.test(navigator.userAgent)&&ib(!0);F&&F.classList.add("isMaximized");w("ESW_APP_MAXIMIZATION_RESIZING_COMPLETED");m("maximizeIframe","Maximized the app");A("onEmbeddedMessagingWindowMaximized")};D.prototype.minimizeIframe=
function(a,b){const c=B(),d=document.getElementById("embeddedMessagingModalOverlay"),e=document.getElementById("embeddedMessagingIconMinimize");b=b.hasMinimizedNotification;const g=document.querySelector(".embeddedMessagingGRecaptchaBanner .grecaptcha-badge");a&&(a.classList.remove("isMaximized"),a.classList.add("isMinimized"),b?a.classList.add("hasMinimizedNotification"):a.classList.remove("hasMinimizedNotification"),embeddedservice_bootstrap.settings.hasBottomTabBar&&(a.classList.remove("embeddedMessagingFrameMaximizedBottomTabBar"),
a.classList.add("embeddedMessagingFrameMinimizedBottomTabBar")));e&&e.remove();c&&(c.style.display="none",c.setAttribute("tabindex",-1),c.removeAttribute("title"),c.removeAttribute("aria-label"));d&&d.classList.contains("isMaximized")&&d.classList.remove("isMaximized");gb()||(document.body.classList.remove("embeddedMessagingPreventScrolling"),embeddedservice_bootstrap.documentScrollPosition&&window.scrollTo(0,embeddedservice_bootstrap.documentScrollPosition));ha&&Zb();lb.test(navigator.userAgent)&&
ib(!1);g&&g.classList.remove("isMaximized");w("ESW_APP_MINIMIZATION_RESIZING_COMPLETED");m("minimizeIframe","Minimized the app");A("onEmbeddedMessagingWindowMinimized")};D.prototype.initializeFeatureObjects=function(){embeddedservice_bootstrap.prechatAPI=new za;embeddedservice_bootstrap.autoResponseAPI=new nb;embeddedservice_bootstrap.userVerificationAPI=new mb;embeddedservice_bootstrap.utilAPI=new W;embeddedservice_bootstrap.invitationAPI=new ob};D.prototype.init=function(a,b,c,d){if(ic)h("init",
"Attempted to initialize bootstrap multiple times",null,!0);else{ic=!0;try{embeddedservice_bootstrap.settings.orgId=a;embeddedservice_bootstrap.settings.eswConfigDevName=b;embeddedservice_bootstrap.settings.siteURL=c;embeddedservice_bootstrap.settings.snippetConfig=d;C=ub();m("init",`Initialized a new conversationId: ${C}`);vb(d||{});if("string"!==typeof embeddedservice_bootstrap.settings.siteURL||!embeddedservice_bootstrap.settings.siteURL.length)throw Error(`Expected a valid Site URL value to be a string but received: ${embeddedservice_bootstrap.settings.siteURL}.`);
if("string"!==typeof embeddedservice_bootstrap.settings.scrt2URL||!embeddedservice_bootstrap.settings.scrt2URL.length)throw Error(`Expected a valid SCRT 2.0 URL value to be a string but received: ${embeddedservice_bootstrap.settings.scrt2URL}.`);if(!embeddedservice_bootstrap.settings.orgId||!embeddedservice_bootstrap.isOrganizationId(embeddedservice_bootstrap.settings.orgId))throw Error("Invalid OrganizationId Parameter Value: "+embeddedservice_bootstrap.settings.orgId);if("string"!==typeof embeddedservice_bootstrap.settings.eswConfigDevName||
!embeddedservice_bootstrap.settings.eswConfigDevName.length)throw Error(`Expected a valid ESW Config Dev Name value to be a string but received: ${embeddedservice_bootstrap.settings.eswConfigDevName}.`);try{window.localStorage}catch(y){t("detectWebStorageAvailability","localStorage is not available. User chat sessions continue only in a single-page view and not across multiple pages."),embeddedservice_bootstrap.isLocalStorageAvailable=!1}try{window.sessionStorage}catch(y){t("detectWebStorageAvailability",
"sessionStorage is not available. User chat sessions end after a web page refresh or across browser tabs and windows."),embeddedservice_bootstrap.isSessionStorageAvailable=!1}qc();if(!embeddedservice_bootstrap.settings.targetElement)throw Error("No targetElement specified.");rc();Kc();embeddedservice_bootstrap.settings.hasBottomTabBar=Mc();embeddedservice_bootstrap.settings.isAuraSite=!!embeddedservice_bootstrap.settings.isAuraSite;embeddedservice_bootstrap.settings.omitSandbox=!!embeddedservice_bootstrap.settings.omitSandbox;
embeddedservice_bootstrap.settings.restrictSessionOnMessagingChannel=!!embeddedservice_bootstrap.settings.restrictSessionOnMessagingChannel;embeddedservice_bootstrap.settings.shouldMinimizeWindowOnNewTab=!!embeddedservice_bootstrap.settings.shouldMinimizeWindowOnNewTab;embeddedservice_bootstrap.settings.disableLaunchChatOnInit=!!embeddedservice_bootstrap.settings.disableLaunchChatOnInit;const e=Hb().then(Promise.resolve.bind(Promise),()=>Hb(H())).catch(()=>{P();throw Error("Error loading CSS.");}),
g=Ib().then(y=>{m("init","Successfully retrieved configuration settings");vb(y);y=embeddedservice_bootstrap.settings.embeddedServiceConfig;embeddedservice_bootstrap.brandingData=y&&y.branding?y.branding:[];embeddedservice_bootstrap.settings.embeddedServiceConfig.scrt2URL=embeddedservice_bootstrap.settings.scrt2URL;embeddedservice_bootstrap.settings.embeddedServiceConfig.orgId=embeddedservice_bootstrap.settings.orgId;if(!embeddedservice_bootstrap.settings.embeddedServiceConfig)throw Error("Embedded Service Config settings not present in configuration response.");
if(!embeddedservice_bootstrap.settings.embeddedServiceConfig.name)throw Error("Embedded Service Config developer name not present in configuration response.");if(!embeddedservice_bootstrap.settings.embeddedServiceConfig.embeddedServiceMessagingChannel)throw Error("Embedded Service Messaging Channel settings not present in configuration response.");if(!embeddedservice_bootstrap.settings.embeddedServiceConfig.embeddedServiceMessagingChannel.authMode)throw Error("Auth mode setting not present in configuration response.");
if(!Object.values(x).includes(embeddedservice_bootstrap.settings.embeddedServiceConfig.embeddedServiceMessagingChannel.authMode))throw Error("Auth mode in configuration response is invalid.");if(Ja()){if(m("init",`Messaging for Web used in ${embeddedservice_bootstrap.settings.snippetConfig.expSiteContext} Experience Site context.`),embeddedservice_bootstrap.settings.expSiteAuthMode)if(R())embeddedservice_bootstrap.settings.embeddedServiceConfig.embeddedServiceMessagingChannel.authMode=x.EXP_SITE_AUTH;
else throw h("init","User verification is not enabled in messaging channel."),Error("User verification is not enabled in messaging channel.");}else m("init","Messaging for Web used in External Site context.");u=`${embeddedservice_bootstrap.settings.orgId}_WEB_STORAGE`;Wc()},y=>{h("init","Failed to retrieve configuration settings. Retrying the request");return new Promise((Z,rb)=>{Ib().then(Z,rb)})}).catch(()=>{P();throw Error("Unable to load Embedded Messaging configuration.");});let n=g.then(()=>
bc()?cc():Promise.resolve("ReCaptcha is not enabled or session exists"));g.then(()=>{ja("ESW_3RDPARTY_STORAGE_REQUEST",{orgId:embeddedservice_bootstrap.settings.orgId});embeddedservice_bootstrap.settings.disablePrefetch||$b()});const l=$a().then(y=>{Q()&&A("onEmbeddedMessagingWithinBusinessHours");return Promise.resolve(y)},y=>Jb(y)).catch(y=>{h("init","Failed to retrieve Business Hours data.",y);P();throw Error("Failed to retrieve Business Hours data.");}),F=Promise.all([g,l,jc]).then(()=>pa()&&
Q()&&!N()?hb():Promise.resolve(!0));Promise.all([e,g,l,jc,n,F]).then(()=>{q();if(embeddedservice_bootstrap.isLocalStorageAvailable){var y=Object.keys(JSON.parse(localStorage.getItem(u)));m("logWebStorageItemsOnInit",`Local storage items on init: ${y}`)}embeddedservice_bootstrap.isSessionStorageAvailable&&(y=Object.keys(JSON.parse(sessionStorage.getItem(u))),m("logWebStorageItemsOnInit",`Session storage items on init: ${y}`));embeddedservice_bootstrap.initializeFeatureObjects();embeddedservice_bootstrap.emitEmbeddedMessagingReadyEvent();
if(N()){{L=r(z.JWT);y=embeddedservice_bootstrap.settings.embeddedServiceConfig.embeddedServiceMessagingChannel.channelAddressIdentifier||"";var Z=fc(L)||{};const rb=Z.channelAddId||"";Z=Z.coreRefId||"";embeddedservice_bootstrap.settings.restrictSessionOnMessagingChannel&&y!==rb||v()===x.EXP_SITE_AUTH&&Z!==embeddedservice_bootstrap.settings.snippetConfig.userId?embeddedservice_bootstrap.userVerificationAPI.clearSession():(v()===x.EXP_SITE_AUTH&&Fa(),embeddedservice_bootstrap.generateMarkup(!0),ac(!0))}}else if(v()===
x.UNAUTH||v()===x.EXP_SITE_AUTH&&!embeddedservice_bootstrap.settings.snippetConfig.isExpSiteGuestUser)v()===x.EXP_SITE_AUTH&&Fa(),embeddedservice_bootstrap.generateMarkup();!ba()||N()||V()||fa()||Ub(Date.now());fa()&&!embeddedservice_bootstrap.settings.disableLaunchChatOnInit&&embeddedservice_bootstrap.utilAPI.launchChat()})}catch(e){P(),h("init",`Error: ${e}`)}}};window.embeddedservice_bootstrap?h("bootstrap load","attempting to load MIAW script when one is already loaded",null,!0):window.embeddedservice_bootstrap=
new D})();
